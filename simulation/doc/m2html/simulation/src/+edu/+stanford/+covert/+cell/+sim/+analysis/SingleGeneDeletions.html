<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of SingleGeneDeletions</title>
  <meta name="keywords" content="SingleGeneDeletions">
  <meta name="description" content="SingleGeneDeletions">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../../../../index.html">Home</a> &gt;  <a href="../../../../../../../index.html">simulation</a> &gt; <a href="#">src</a> &gt; <a href="#">+edu</a> &gt; <a href="#">+stanford</a> &gt; <a href="#">+covert</a> &gt; <a href="#">+cell</a> &gt; <a href="../index.html">+sim</a> &gt; <a href="index.html">+analysis</a> &gt; SingleGeneDeletions.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../../../../index.html"><img alt="<" border="0" src="../../../../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for simulation/src/+edu/+stanford/+covert/+cell/+sim/+analysis&nbsp;<img alt=">" border="0" src="../../../../../../../../right.png"></a></td></tr></table>-->

<h1>SingleGeneDeletions
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../../../../up.png"></a></h2>
<div class="box"><strong>SingleGeneDeletions</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">SingleGeneDeletions

 Author: Jonathan Karr, jkarr@stanford.edu
 Affiliation: Covert Lab, Department of Bioengineering, Stanford University
 Last Updated: 3/23/2011</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../../../../matlabicon.gif)">
<li><a href="SingleGeneDeletions.html" class="code" title="">SingleGeneDeletions</a>	SingleGeneDeletions</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../../../../../matlabicon.gif)">
<li><a href="SingleGeneDeletions.html" class="code" title="">SingleGeneDeletions</a>	SingleGeneDeletions</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function run(simBatchDir, useCachedData, iJob, nJobs)</a></li><li><a href="#_sub2" class="code">function plotIndividualDeletionStrains(simBatchDir, useCachedData, iJob, nJobs)</a></li><li><a href="#_sub3" class="code">function [deletionStats, wtStats] = calcGeneDeletionStrainStats(useCachedData, iJob, nJobs)</a></li><li><a href="#_sub4" class="code">function stats = calcStrainStats(geneID)</a></li><li><a href="#_sub5" class="code">function geneClasses = classifyIndividualDeletionStrains(useCachedData)</a></li><li><a href="#_sub6" class="code">function analyzeSpecificDeletionStrains(useCachedData)</a></li><li><a href="#_sub7" class="code">function plotAllDeletionStrains(iJob, nJobs)</a></li><li><a href="#_sub8" class="code">function plotDeletionStrainClasses(classIdxs)</a></li><li><a href="#_sub9" class="code">function plotDeletionStrainClassification()</a></li><li><a href="#_sub10" class="code">function plotDeletionGrowthRateDistribution(wtGrowth, koGrowth, geneClasses, outputFile)</a></li><li><a href="#_sub11" class="code">function plotDeletionStrainClassificationHelper(xdata, ydata, xlabelStr, ylabelStr, geneClasses, classIdxs, plotIdx, legendLocation)</a></li><li><a href="#_sub12" class="code">function plotOverview(outFileName_Figure, outFileName_Table,</a></li><li><a href="#_sub13" class="code">function plotGeneDeletionPrediction(sim, geneClasses, position)</a></li><li><a href="#_sub14" class="code">function [gridData, gridMetaData] = calcOverviewData(iJob, nJobs)</a></li><li><a href="#_sub15" class="code">function [deletionMetabolicOutputs, wtMetabolicOutput] = calculateSingleGeneDeletionMetabolicOutputs(sim)</a></li><li><a href="#_sub16" class="code">function [content, colLabels] = printSingleGeneDeletionStrains(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses)</a></li><li><a href="#_sub17" class="code">function [content, colLabels] = printSingleGeneDeletionStrainClasses(sim, geneClasses)</a></li><li><a href="#_sub18" class="code">function plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)</a></li><li><a href="#_sub19" class="code">function svg = plotGrid(categories, cellIDs, cellCats, width, height, gridFontSize, legendFontSize, colors)</a></li><li><a href="#_sub20" class="code">function [data, simMetaData, validSims] = getSimulationData(sim, simMetaData)</a></li><li><a href="#_sub21" class="code">function nPlots = plotSingleGeneDeletion(data, classes, classLabels, plotRepresentativeCell, figHandle, plotIdx, colors)</a></li><li><a href="#_sub22" class="code">function plotSingleGeneDeletionTemporalDynamics(dynamicsAxesHandle, histogramAxesHandle, data, classes, classLabels, plotRepresentativeCell, dataField, dataLabel, colors)</a></li><li><a href="#_sub23" class="code">function plotSingleGeneDeletionCellCyclePhaseHistogram(axesHandle, data, classes, classLabels, dataField, dataLabel, colors)</a></li><li><a href="#_sub24" class="code">function plotSingleGeneDeletionCallback(hObject, ~)</a></li><li><a href="#_sub25" class="code">function [class, classLabel] = classifyDeletionStrain(geneID, wtData)</a></li><li><a href="#_sub26" class="code">function figData = analyzeSingleGeneDeletionStrain_MG_210(figHandle, geneID, deletionData, wtData, figData)</a></li><li><a href="#_sub27" class="code">function figData = analyzeSingleGeneDeletionStrain_MG_172(figHandle, geneID, deletionData, wtData, figData)</a></li><li><a href="#_sub28" class="code">function [deletionDoublingTimes, wtDoublingTime] = getExperimentalDoublingTimes(sim)</a></li><li><a href="#_sub29" class="code">function [tfs, molecules, processes] = getGeneImplementations(sim)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%SingleGeneDeletions</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Author: Jonathan Karr, jkarr@stanford.edu</span>
0004 <span class="comment">% Affiliation: Covert Lab, Department of Bioengineering, Stanford University</span>
0005 <span class="comment">% Last Updated: 3/23/2011</span>
0006 classdef <a href="SingleGeneDeletions.html" class="code" title="">SingleGeneDeletions</a>
0007     properties (Constant = true)
0008         <span class="comment">%A. Non-essential (NON_ESSENTIAL)</span>
0009         <span class="comment">%B. Semi-essential</span>
0010         <span class="comment">%   1. Slow growing (SLOW_GROWING)</span>
0011         <span class="comment">%C. Essential</span>
0012         <span class="comment">%   1. No growth</span>
0013         <span class="comment">%      a. Macromolecule maintenance (NON_GROWING)</span>
0014         <span class="comment">%      b. No macromolecule maintenance, toxic metabolite levels (DECOMPOSING)</span>
0015         <span class="comment">%   2. Decaying growth</span>
0016         <span class="comment">%      a. Non-RNA, Non-protein synthesizing (DECAYING_GROWTH_NON_RNA_PROTEIN)</span>
0017         <span class="comment">%         i.  Non-transcribing</span>
0018         <span class="comment">%         ii. Non-maturing</span>
0019         <span class="comment">%      b. Non-protein synthesizing (DECAYING_GROWTH_NON_PROTEIN)</span>
0020         <span class="comment">%   3. Non-dividing</span>
0021         <span class="comment">%      a. Non-replicative (NON_REPLICATIVE)</span>
0022         <span class="comment">%      b. Non-fissive (NON_FISSIVE)</span>
0023         <span class="comment">%   4. Unable to sustain division over many generations (NON_PERPETUATING)</span>
0024         <span class="comment">%   5. No terminal organelle (NO_TERMINAL_ORGANELLE)</span>
0025         <span class="comment">%   6. Toxin accumulation (TOXIN_ACCUMULATION)</span>
0026         DELETION_STRAIN_CLASSES = {
0027             <span class="string">'Non-essential'</span>             <span class="string">'Doesn''t meet criterion of any of the other categories'</span>
0028             <span class="string">'Decomposing'</span>               <span class="string">'No growth, no energy production, no macromolecule maintenance, toxic metabolite levels'</span>
0029             <span class="string">'Non-growing'</span>               <span class="string">'No growth, energy production, macromolecule maintenance'</span>
0030             <span class="string">'Non-RNA synthesizing'</span>      <span class="string">'Derivative of growth is negative, time to mass doubling is long, time to end of replication is long, cell cycle is elongated'</span>
0031             <span class="string">'Non-protein synthesizing'</span>  <span class="string">'Derivative of growth is negative, time to mass doubling is long, time to end of replication is long, cell cycle is elongated'</span>
0032             <span class="string">'Non-replicative'</span>           <span class="string">'End ploidy = 1, high dNTPs, no simulation finishes replication (rep end time = NaN)'</span>
0033             <span class="string">'Non-fissive'</span>               <span class="string">'End ploidy = 2, but pinchedDiamter = diameter'</span>
0034             <span class="string">'Slow growing'</span>              <span class="string">'Grows and divides, but slower than wild-type'</span>
0035             <span class="string">'Toxin accumulation'</span>        <span class="string">'Accumulates toxic concentrations of metabolites'</span>
0036             <span class="string">'Non-perpetuating'</span>          <span class="string">'Gene is essential, but cells will survive for several generations until gene products are sufficiently diluted among progeny'</span>
0037             <span class="string">'No terminal organelle'</span>     <span class="string">'Lack terminal organelle'</span>
0038             <span class="string">'Unobserved'</span>                <span class="string">'Simulation not yet run'</span>
0039             <span class="string">'Wild-type'</span>                 <span class="string">'Wild-type simulation'</span>
0040             };
0041         NON_ESSENTIAL                   = 1
0042         DECOMPOSING                     = 2
0043         NON_GROWING                     = 3
0044         DECAYING_GROWTH_NON_RNA_PROTEIN = 4
0045         DECAYING_GROWTH_NON_PROTEIN     = 5
0046         NON_REPLICATIVE                 = 6
0047         NON_FISSIVE                     = 7
0048         SLOW_GROWING                    = 8
0049         TOXIN_ACCUMULATION              = 9
0050         NON_PERPETUATING                = 10
0051         NO_TERMINAL_ORGANELLE           = 11
0052         UNOBSERVED                      = 12
0053         WILD_TYPE                       = 13
0054         
0055         COLORS = [
0056             0 0 1 <span class="comment">%blue</span>
0057             1 0 0 <span class="comment">%red</span>
0058             0 1 0 <span class="comment">%green</span>
0059             0 1 1 <span class="comment">%cyan</span>
0060             1 0.5 0 <span class="comment">%orange</span>
0061             0.5 0 0.5 <span class="comment">%purple</span>
0062             1 0.84 0 <span class="comment">%gold</span>
0063             0.25 0 0.5 <span class="comment">%indigo</span>
0064             0 1 1 <span class="comment">%aqua</span>
0065             0.5 1 0.8314 <span class="comment">%aquamarine</span>
0066             0.329 0.525 0.043 <span class="comment">%dark gold</span>
0067             1 0.753 0.795 <span class="comment">%pink</span>
0068             0.25 0.25 0.25 <span class="comment">%dark grey</span>
0069             ];
0070         
0071         nonPerpetuatingEssentialGenes = {
0072             <span class="string">'MG_0001'</span>
0073             <span class="string">'MG_012'</span>
0074             <span class="string">'MG_019'</span>
0075             <span class="string">'MG_048'</span>
0076             <span class="string">'MG_072'</span>
0077             <span class="string">'MG_106'</span>
0078             <span class="string">'MG_109'</span>
0079             <span class="string">'MG_110'</span>
0080             <span class="string">'MG_139'</span>
0081             <span class="string">'MG_143'</span>
0082             <span class="string">'MG_170'</span>
0083             <span class="string">'MG_172'</span>
0084             <span class="string">'MG_184'</span>
0085             <span class="string">'MG_210'</span>
0086             <span class="string">'MG_277'</span>
0087             <span class="string">'MG_297'</span>
0088             <span class="string">'MG_305'</span>
0089             <span class="string">'MG_329'</span>
0090             <span class="string">'MG_335'</span>
0091             <span class="string">'MG_384'</span>
0092             <span class="string">'MG_387'</span>
0093             <span class="string">'MG_392'</span>
0094             <span class="string">'MG_393'</span>
0095             <span class="string">'MG_425'</span>
0096             <span class="string">'MG_442'</span>
0097             <span class="string">'MG_464'</span>
0098             <span class="string">'MG_476'</span>
0099             };
0100     <span class="keyword">end</span>
0101     
0102     <span class="comment">%printing</span>
0103     methods (Static)
0104         <a name="_sub0" href="#_subfunctions" class="code">function run(simBatchDir, useCachedData, iJob, nJobs)</a>
0105             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0106             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0107             import edu.stanford.covert.cell.sim.util.PrintUtil;
0108             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0109             
0110             <span class="keyword">if</span> nargin &lt; 2
0111                 useCachedData = false;
0112             <span class="keyword">end</span>
0113             <span class="keyword">if</span> nargin &lt; 4
0114                 iJob = 1;
0115                 nJobs = 1;
0116             <span class="keyword">end</span>
0117             
0118             <span class="comment">%% constants</span>
0119             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0120             sim = CachedSimulationObjectUtil.load();
0121             
0122             <span class="comment">%% plot overview of each single gene deletion strain</span>
0123             SingleGeneDeletions.plotIndividualDeletionStrains(simBatchDir, useCachedData, iJob, nJobs);
0124             
0125             <span class="comment">%% analyze specific single gene deletion strains</span>
0126             SingleGeneDeletions.analyzeSpecificDeletionStrains(useCachedData);
0127             
0128             <span class="comment">%% calculate strain statistics and classify strains</span>
0129             SingleGeneDeletions.calcGeneDeletionStrainStats(useCachedData);
0130             SingleGeneDeletions.classifyIndividualDeletionStrains(useCachedData);
0131             
0132             <span class="comment">%% plot overview of all single gene deletion strains</span>
0133             SingleGeneDeletions.plotOverview();
0134             SingleGeneDeletions.plotAllDeletionStrains();
0135             
0136             <span class="comment">%% plot signature of each deletion strain class</span>
0137             SingleGeneDeletions.plotDeletionStrainClasses();
0138             SingleGeneDeletions.plotDeletionStrainClassification();
0139             SingleGeneDeletions.plotDeletionGrowthRateDistribution();
0140             
0141             <span class="comment">%% Metabolic essentiality</span>
0142             [deletionMetabolicOutputs, wtMetabolicOutput] = SingleGeneDeletions.calculateSingleGeneDeletionMetabolicOutputs(sim);
0143             
0144             <span class="comment">%% plot summary of model accuracy</span>
0145             load([baseDir <span class="string">'wtStats.mat'</span>]);
0146             load([baseDir <span class="string">'deletionStats.mat'</span>]);
0147             load([baseDir <span class="string">'geneClasses.mat'</span>]);
0148             
0149             SingleGeneDeletions.plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, [baseDir <span class="string">'summaryGrid.svg'</span>]);
0150             [~, ~] = system(sprintf(<span class="string">'inkscape &quot;%ssummaryGrid.svg&quot; --export-pdf=&quot;%ssummaryGrid.pdf&quot; --export-area-page'</span>, baseDir, baseDir));
0151             
0152             <span class="comment">%% tables</span>
0153             <span class="keyword">if</span> ispc &amp;&amp; exist([baseDir <span class="string">'summary.xls'</span>], <span class="string">'file'</span>)
0154                 delete([baseDir <span class="string">'summary.xls'</span>]);
0155             <span class="keyword">end</span>
0156             
0157             <span class="comment">%classes</span>
0158             [classContent, classColLabels] = SingleGeneDeletions.printSingleGeneDeletionStrainClasses(sim, geneClasses);
0159             PrintUtil.printToFile(classContent, classColLabels, [baseDir <span class="string">'summary.xls'</span>], <span class="string">'Strains Classes'</span>);
0160             
0161             <span class="comment">%strains</span>
0162             [strainContent, strainColLabels] = SingleGeneDeletions.printSingleGeneDeletionStrains(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses);
0163             PrintUtil.printToFile(strainContent, strainColLabels, [baseDir <span class="string">'summary.xls'</span>], <span class="string">'Strains'</span>);
0164         <span class="keyword">end</span>
0165         
0166         <a name="_sub1" href="#_subfunctions" class="code">function plotIndividualDeletionStrains(simBatchDir, useCachedData, iJob, nJobs)</a>
0167             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0168             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0169             import edu.stanford.covert.cell.sim.util.PlotUtil;
0170             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0171             import edu.stanford.covert.util.PdfUtil;
0172             
0173             <span class="keyword">if</span> nargin &lt; 4
0174                 iJob = 1;
0175                 nJobs = 1;
0176             <span class="keyword">end</span>
0177             
0178             <span class="comment">%% constants</span>
0179             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0180             
0181             simDir = SimulationDiskUtil.getSimulation([simBatchDir filesep <span class="string">'1'</span>]);
0182             idxs = find(simDir == <span class="string">'/'</span> | simDir == <span class="string">'\'</span>);
0183             simBatch = simDir(idxs(end-1)+1:idxs(end)-1);
0184             
0185             sim = CachedSimulationObjectUtil.load();
0186             g = sim.gene;
0187             
0188             <span class="comment">%% overview of each single gene deletion strain</span>
0189             
0190             <span class="comment">%find simulation with single gene deletion data</span>
0191             [metaDataAll, options] = SimulationDiskUtil.getSimulations();
0192             
0193             tfKO = false(size(options));
0194             geneticKnockouts = zeros(size(options));
0195             <span class="keyword">for</span> i = 1:numel(options)
0196                 tfKO(i) = <span class="keyword">...</span>
0197                     ~isempty(options(i).geneticKnockouts) &amp;&amp; <span class="keyword">...</span>
0198                     isscalar(options(i).geneticKnockouts) &amp;&amp; <span class="keyword">...</span>
0199                     isempty(options(i).media) &amp;&amp; <span class="keyword">...</span>
0200                     isempty(options(i).stimulus);
0201                 <span class="keyword">if</span> tfKO(i)
0202                     geneticKnockouts(i) = find(strcmp(options(i).geneticKnockouts{1}, g.wholeCellModelIDs), 1);
0203                 <span class="keyword">end</span>
0204             <span class="keyword">end</span>
0205             
0206             <span class="comment">%find simulations with wild-type data and get data</span>
0207             tfWt = ~tfKO;
0208             metaData = metaDataAll(tfWt);
0209             
0210             <span class="comment">%get wild-type data</span>
0211             <span class="keyword">if</span> (nargin &gt;= 2 &amp;&amp; useCachedData) || ~any(strcmp({metaData.simGroup}, simBatch))
0212                 <span class="comment">%load cached data</span>
0213                 <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0214                     wtData = load([baseDir <span class="string">'WT.mat'</span>]);
0215                     metaData = wtData.metaData;
0216                 <span class="keyword">end</span>
0217             <span class="keyword">end</span>
0218             
0219             <span class="keyword">if</span> ~exist(<span class="string">'wtData'</span>, <span class="string">'var'</span>)
0220                 <span class="comment">%get wild-type data</span>
0221                 [wtData, metaData] = SingleGeneDeletions.getSimulationData(sim, metaData);
0222                 <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0223                     save([baseDir <span class="string">'WT.mat'</span>], <span class="string">'-struct'</span>, <span class="string">'wtData'</span>);
0224                     save([baseDir <span class="string">'WT.mat'</span>], <span class="string">'-append'</span>, <span class="string">'metaData'</span>);
0225                 <span class="keyword">end</span>
0226             <span class="keyword">end</span>
0227             
0228             <span class="comment">%plot wild-type data</span>
0229             <span class="keyword">if</span> any(strcmp({metaData.simGroup}, simBatch)) || ~exist([baseDir <span class="string">'WT.pdf'</span>], <span class="string">'file'</span>)
0230                 [~, figHandle] = PlotUtil.newAxesHandle();
0231                 SingleGeneDeletions.plotSingleGeneDeletion({wtData}, 1, {<span class="string">'Wild-type'</span>}, false, figHandle);
0232                 <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0233                     saveas(figHandle, [baseDir <span class="string">'WT.pdf'</span>]);
0234                 <span class="keyword">end</span>
0235                 close(figHandle);
0236                 PdfUtil.rotatePages([baseDir <span class="string">'WT.pdf'</span>]);
0237             <span class="keyword">end</span>
0238             
0239             <span class="comment">%get and plot single-gene deletion data</span>
0240             geneIdxs = setdiff(unique(geneticKnockouts), 0);
0241             <span class="keyword">for</span> i = iJob:nJobs:numel(geneIdxs)
0242                 geneIdx = geneIdxs(i);
0243                 geneID = g.wholeCellModelIDs{geneIdx};
0244                 
0245                 <span class="keyword">if</span> nargin &gt;= 2 &amp;&amp; useCachedData
0246                     <span class="comment">%load cached data</span>
0247                     <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0248                         deletionData = load([baseDir geneID <span class="string">'.mat'</span>]);
0249                         metaData = deletionData.metaData;
0250                         <span class="keyword">if</span> ~any(strcmp({metaData.simGroup}, simBatch))
0251                             <span class="keyword">continue</span>;
0252                         <span class="keyword">end</span>
0253                     <span class="keyword">end</span>
0254                 <span class="keyword">end</span>
0255                 <span class="keyword">if</span> ~exist(<span class="string">'deletionData'</span>, <span class="string">'var'</span>)
0256                     <span class="comment">%find simulations</span>
0257                     simTfs = geneticKnockouts == geneIdx;
0258                     metaData = metaDataAll(simTfs);
0259                     <span class="keyword">if</span> ~any(strcmp({metaData.simGroup}, simBatch))
0260                         <span class="keyword">continue</span>;
0261                     <span class="keyword">end</span>
0262                     
0263                     <span class="comment">%load data</span>
0264                     [deletionData, metaData] = SingleGeneDeletions.getSimulationData(sim, metaData); <span class="comment">%#ok&lt;NASGU&gt;</span>
0265                     <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0266                         save([baseDir geneID <span class="string">'.mat'</span>], <span class="string">'-struct'</span>, <span class="string">'deletionData'</span>);
0267                         save([baseDir geneID <span class="string">'.mat'</span>], <span class="string">'-append'</span>, <span class="string">'metaData'</span>);
0268                     <span class="keyword">end</span>
0269                 <span class="keyword">end</span>
0270                 
0271                 [~, figHandle] = PlotUtil.newAxesHandle();
0272                 SingleGeneDeletions.plotSingleGeneDeletion({deletionData; wtData}, [1; 2], {[<span class="string">'{\Delta}'</span> strrep(geneID, <span class="string">'_'</span>, <span class="string">'\_'</span>)]; <span class="string">'Wild-Type'</span>}, [false; true], figHandle);
0273                 <span class="keyword">try</span>
0274                     saveas(figHandle, [baseDir geneID <span class="string">'.pdf'</span>]);
0275                     PdfUtil.rotatePages([baseDir geneID <span class="string">'.pdf'</span>]);
0276                 <span class="keyword">catch</span> exception
0277                     warning(<span class="string">'WholeCell:warning'</span>, <span class="string">'Unable to save %s plot:\n%s'</span>, geneID, exception.getReport());
0278                 <span class="keyword">end</span>
0279                 close(figHandle);
0280                 
0281                 clear deletionData;
0282             <span class="keyword">end</span>
0283         <span class="keyword">end</span>
0284         
0285         <a name="_sub2" href="#_subfunctions" class="code">function [deletionStats, wtStats] = calcGeneDeletionStrainStats(useCachedData, iJob, nJobs)</a>
0286             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0287             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0288             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0289             
0290             <span class="keyword">if</span> nargin &lt; 3
0291                 iJob = 1;
0292                 nJobs = 1;
0293             <span class="keyword">end</span>
0294             
0295             sim = CachedSimulationObjectUtil.load();
0296             g = sim.gene;
0297             
0298             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0299             
0300             tmp = dir([baseDir filesep <span class="string">'MG*.mat'</span>]);
0301             [~, geneticKnockouts] = ismember(cellfun(@(str) str(1:end-4), {tmp.name}', <span class="string">'UniformOutput'</span>, false), g.wholeCellModelIDs);
0302             geneIdxs = setdiff(unique(geneticKnockouts), 0);
0303             
0304             <span class="keyword">if</span> nargin &gt;= 1 &amp;&amp; useCachedData &amp;&amp; exist([baseDir <span class="string">'deletionStats.mat'</span>], <span class="string">'file'</span>)
0305                 load([baseDir <span class="string">'deletionStats.mat'</span>]);
0306                 geneIdxs = intersect(geneIdxs, find(all(all(isnan(deletionStats), 2), 3))); <span class="comment">%#ok&lt;NODEF&gt;</span>
0307             <span class="keyword">else</span>
0308                 deletionStats = NaN(numel(g.wholeCellModelIDs), 19, 2);
0309             <span class="keyword">end</span>
0310             <span class="keyword">for</span> i = iJob:nJobs:numel(geneIdxs)
0311                 geneID = g.wholeCellModelIDs{geneIdxs(i)};
0312                 <span class="keyword">if</span> useCachedData &amp;&amp; exist([baseDir geneID <span class="string">'-stats.mat'</span>], <span class="string">'file'</span>)
0313                     load([baseDir geneID <span class="string">'-stats.mat'</span>]);
0314                 <span class="keyword">else</span>
0315                     tmp = SingleGeneDeletions.calcStrainStats(geneID);
0316                     save([baseDir geneID <span class="string">'-stats.mat'</span>], <span class="string">'tmp'</span>);
0317                 <span class="keyword">end</span>
0318                 deletionStats(geneIdxs(i), :, :) = tmp;
0319             <span class="keyword">end</span>
0320             save([baseDir <span class="string">'deletionStats.mat'</span>], <span class="string">'deletionStats'</span>);
0321             
0322             <span class="keyword">if</span> nargin &lt; 0 || ~useCachedData || ~exist([baseDir <span class="string">'wtStats.mat'</span>], <span class="string">'file'</span>)
0323                 wtStats = SingleGeneDeletions.calcStrainStats(<span class="string">'WT'</span>);
0324                 save([baseDir <span class="string">'wtStats.mat'</span>], <span class="string">'wtStats'</span>);
0325             <span class="keyword">else</span>
0326                 load([baseDir <span class="string">'wtStats.mat'</span>]);
0327             <span class="keyword">end</span>
0328         <span class="keyword">end</span>
0329         
0330         <a name="_sub3" href="#_subfunctions" class="code">function stats = calcStrainStats(geneID)</a>
0331             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0332             
0333             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0334             data = load([baseDir geneID <span class="string">'.mat'</span>]);
0335             
0336             inds = sub2ind(size(data.growth), data.simEndTimes + 1, (1:numel(data.simEndTimes))');
0337             dt = diff(data.time(find(~isnan(data.growth), 2, <span class="string">'first'</span>)));
0338             
0339             stats = NaN(1, 19, 2);
0340             stats(1,  1, :) = [nanmean(data.growth(inds)) nanstd(data.growth(inds))];
0341             stats(1,  2, :) = [nanmean(data.atpProduction(inds)) nanstd(data.atpProduction(inds))];
0342             stats(1,  3, :) = [nanmean(data.gtpProduction(inds)) nanstd(data.gtpProduction(inds))];
0343             stats(1,  4, :) = [nanmean(data.repInitDuration) nanstd(data.repInitDuration)];
0344             stats(1,  5, :) = [nanmean(data.repDuration) nanstd(data.repDuration)];
0345             stats(1,  6, :) = [nanmean(data.cytokinesisDuration) nanstd(data.cytokinesisDuration)];
0346             stats(1,  7, :) = [nanmean(data.cellCycleDuration) nanstd(data.cellCycleDuration)];
0347             stats(1,  8, :) = [nanmean(data.massDoublingDuration) nanstd(data.massDoublingDuration)];
0348             stats(1,  9, :) = [nanmean(nansum(data.atpUsage, 1) * dt, 2) nanstd(nansum(data.atpUsage, 1) * dt, [], 2)]; <span class="comment">%atp usage</span>
0349             stats(1, 10, :) = [nanmean(nansum(data.gtpUsage, 1) * dt, 2) nanstd(nansum(data.gtpUsage, 1) * dt, [], 2)]; <span class="comment">%gtp usage</span>
0350             stats(1, 11, :) = [nanmean(nanmean(data.dnaWt ./ data.cellWt, 1), 2) nanstd(nanmean(data.dnaWt ./ data.cellWt, 1), [], 2)]; <span class="comment">%DNA content</span>
0351             stats(1, 12, :) = [nanmean(nanmean(data.rnaWt ./ data.cellWt, 1), 2) nanstd(nanmean(data.rnaWt ./ data.cellWt, 1), [], 2)]; <span class="comment">%RNA content</span>
0352             stats(1, 13, :) = [nanmean(nanmean(data.proteinWt ./ data.cellWt, 1), 2) nanstd(nanmean(data.proteinWt ./ data.cellWt, 1), [], 2)]; <span class="comment">%Protein content</span>
0353             stats(1, 14, :) = [nanmean(nanmean(data.superhelicalDensity, 1), 2) nanstd(nanmean(data.superhelicalDensity, 1), [], 2)]; <span class="comment">%superhelicity</span>
0354             
0355             tau_rna = zeros(size(data.simEndTimes));
0356             tau_protein = zeros(size(data.simEndTimes));
0357             tau_damagedRna = zeros(size(data.simEndTimes));
0358             tau_damagedProtein = zeros(size(data.simEndTimes));
0359             adjrsquare_rna = zeros(size(data.simEndTimes));
0360             adjrsquare_protein = zeros(size(data.simEndTimes));
0361             adjrsquare_damagedRna = zeros(size(data.simEndTimes));
0362             adjrsquare_damagedProtein = zeros(size(data.simEndTimes));
0363             expFittype = fittype(<span class="string">'a * exp(log(2) * t / tau)'</span>, <span class="keyword">...</span>
0364                 <span class="string">'independent'</span>, <span class="string">'t'</span>, <span class="keyword">...</span>
0365                 <span class="string">'coefficients'</span>, {<span class="string">'a'</span>, <span class="string">'tau'</span>});
0366             <span class="keyword">for</span> i = 1:numel(data.simEndTimes)
0367                 expFitOptions = fitoptions(<span class="keyword">...</span>
0368                     <span class="string">'Method'</span>, <span class="string">'NonlinearLeastSquares'</span>, <span class="keyword">...</span>
0369                     <span class="string">'Startpoint'</span>, [data.rnaWt(2, i) * 1e15  8.6], <span class="keyword">...</span>
0370                     <span class="string">'Lower'</span>, [0 -1e3 * (diff(data.rnaWt([2 data.simEndTimes(i)+1], i)) &lt; 0)], <span class="keyword">...</span>
0371                     <span class="string">'Upper'</span>, [max(data.rnaWt(:, i)) * 1e15 1e3]);
0372                 [fitResult, gof] = fit(data.time(2:data.simEndTimes(i)+1, 1), data.rnaWt(2:data.simEndTimes(i)+1, i) * 1e15, expFittype, expFitOptions);
0373                 tau_rna(i) = fitResult.tau;
0374                 adjrsquare_rna(i) = gof.adjrsquare;
0375                 <span class="keyword">if</span> gof.adjrsquare &lt; 0.5
0376                     tau_rna(i) = NaN;
0377                 <span class="keyword">end</span>
0378                 
0379                 expFitOptions = fitoptions(<span class="keyword">...</span>
0380                     <span class="string">'Method'</span>, <span class="string">'NonlinearLeastSquares'</span>, <span class="keyword">...</span>
0381                     <span class="string">'Startpoint'</span>, [data.proteinWt(2, i) * 1e15  8.6], <span class="keyword">...</span>
0382                     <span class="string">'Lower'</span>, [0 -1e3 * (diff(data.proteinWt([2 data.simEndTimes(i)+1], i)) &lt; 0)], <span class="keyword">...</span>
0383                     <span class="string">'Upper'</span>, [max(data.proteinWt(:, i)) * 1e15 1e3]);
0384                 [fitResult, gof] = fit(data.time(2:data.simEndTimes(i)+1, 1), data.proteinWt(2:data.simEndTimes(i)+1, i) * 1e15, expFittype, expFitOptions);
0385                 tau_protein(i) = fitResult.tau;
0386                 adjrsquare_protein(i) = gof.adjrsquare;
0387                 <span class="keyword">if</span> gof.adjrsquare &lt; 0.5
0388                     tau_protein(i) = NaN;
0389                 <span class="keyword">end</span>
0390                 
0391                 xdata = data.time(2:data.simEndTimes(i)+1, 1) / 3600;
0392                 ydata = data.damagedRnas(2:data.simEndTimes(i)+1, i);
0393                 xdata = xdata(~isnan(ydata));
0394                 ydata = ydata(~isnan(ydata));
0395                 expFitOptions = fitoptions(<span class="keyword">...</span>
0396                     <span class="string">'Method'</span>, <span class="string">'NonlinearLeastSquares'</span>, <span class="keyword">...</span>
0397                     <span class="string">'Startpoint'</span>, [ydata(2, 1)  8.6], <span class="keyword">...</span>
0398                     <span class="string">'Lower'</span>, [0 -1e3 * (diff(data.damagedRnas([2 data.simEndTimes(i)+1], i)) &lt; 0)], <span class="keyword">...</span>
0399                     <span class="string">'Upper'</span>, [max(max(data.damagedRnas(:, i)), 1) 1e3]);
0400                 [fitResult, gof] = fit(xdata, ydata, expFittype, expFitOptions);
0401                 tau_damagedRna(i) = fitResult.tau;
0402                 adjrsquare_damagedRna(i) = gof.adjrsquare;
0403                 <span class="keyword">if</span> gof.adjrsquare &lt; 0.5
0404                     tau_damagedRna(i) = NaN;
0405                 <span class="keyword">end</span>
0406                 
0407                 xdata = data.time(2:data.simEndTimes(i)+1, 1) / 3600;
0408                 ydata = data.damagedProteins(2:data.simEndTimes(i)+1, i);
0409                 xdata = xdata(~isnan(ydata));
0410                 ydata = ydata(~isnan(ydata));
0411                 expFitOptions = fitoptions(<span class="keyword">...</span>
0412                     <span class="string">'Method'</span>, <span class="string">'NonlinearLeastSquares'</span>, <span class="keyword">...</span>
0413                     <span class="string">'Startpoint'</span>, [ydata(2, 1)  8.6], <span class="keyword">...</span>
0414                     <span class="string">'Lower'</span>, [0 -1e3 * (diff(data.damagedProteins([2 data.simEndTimes(i)+1], i)) &lt; 0)], <span class="keyword">...</span>
0415                     <span class="string">'Upper'</span>, [max(max(data.damagedProteins(:, i)), 1) 1e3]);
0416                 [fitResult, gof] = fit(xdata, ydata, expFittype, expFitOptions);
0417                 tau_damagedProtein(i) = fitResult.tau;
0418                 adjrsquare_damagedProtein(i) = gof.adjrsquare;
0419                 <span class="keyword">if</span> gof.adjrsquare &lt; 0.5
0420                     tau_damagedProtein(i) = NaN;
0421                 <span class="keyword">end</span>
0422             <span class="keyword">end</span>
0423             stats(1, 15, :) = [nanmean(tau_rna) nanstd(tau_rna)]; <span class="comment">%rate of change of RNA content</span>
0424             stats(1, 16, :) = [nanmean(tau_protein) nanstd(tau_protein)]; <span class="comment">%rate of change of protein content</span>
0425             stats(1, 17, :) = [nanmean(tau_damagedRna) nanstd(tau_damagedRna)]; <span class="comment">%rate of change of damaged RNA content</span>
0426             stats(1, 18, :) = [nanmean(tau_damagedProtein) nanstd(tau_damagedProtein)]; <span class="comment">%rate of change of damaged protein content</span>
0427             
0428             stats(1, 19, :) = [nanmean(nanmean(data.antibiotics, 1), 2) nanstd(nanmean(data.antibiotics, 1), [], 2)]; <span class="comment">%antibiotics count</span>
0429         <span class="keyword">end</span>
0430         
0431         <a name="_sub4" href="#_subfunctions" class="code">function geneClasses = classifyIndividualDeletionStrains(useCachedData)</a>
0432             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0433             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0434             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0435             
0436             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0437             sim = CachedSimulationObjectUtil.load();
0438             g = sim.gene;
0439             
0440             wtData = load([baseDir <span class="string">'WT.mat'</span>]);
0441             tmp = dir([baseDir filesep <span class="string">'MG*.mat'</span>]);
0442             [~, geneticKnockouts] = ismember(cellfun(@(str) str(1:end-4), {tmp.name}', <span class="string">'UniformOutput'</span>, false), g.wholeCellModelIDs);
0443             geneIdxs = setdiff(unique(geneticKnockouts), 0);
0444             
0445             <span class="keyword">if</span> nargin &gt;= 1 &amp;&amp; useCachedData &amp;&amp; exist([baseDir <span class="string">'geneClasses.mat'</span>], <span class="string">'file'</span>)
0446                 load([baseDir <span class="string">'geneClasses.mat'</span>]);
0447                 geneIdxs = intersect(geneIdxs, find(geneClasses == SingleGeneDeletions.UNOBSERVED)); <span class="comment">%#ok&lt;NODEF&gt;</span>
0448             <span class="keyword">else</span>
0449                 geneClasses = repmat(SingleGeneDeletions.UNOBSERVED, size(g.wholeCellModelIDs));
0450             <span class="keyword">end</span>
0451             
0452             <span class="keyword">for</span> i = 1:numel(geneIdxs)
0453                 geneIdx = geneIdxs(i);
0454                 geneID = g.wholeCellModelIDs{geneIdx};
0455                 geneClasses(geneIdx) = SingleGeneDeletions.classifyDeletionStrain(geneID, wtData);
0456                 clear deletionData;
0457             <span class="keyword">end</span>
0458             
0459             <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0460                 save([baseDir <span class="string">'geneClasses.mat'</span>], <span class="string">'geneClasses'</span>);
0461             <span class="keyword">end</span>
0462         <span class="keyword">end</span>
0463         
0464         <a name="_sub5" href="#_subfunctions" class="code">function analyzeSpecificDeletionStrains(useCachedData)</a>
0465             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0466             import edu.stanford.covert.cell.sim.util.PlotUtil;
0467             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0468             
0469             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0470             
0471             wtData = load([baseDir <span class="string">'WT.mat'</span>]);
0472             
0473             md = meta.class.fromName(<span class="string">'edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions'</span>);
0474             <span class="keyword">for</span> i = 1:numel(md.Methods)
0475                 <span class="keyword">if</span> length(md.Methods{i}.Name) &gt;= length(<span class="string">'analyzeSingleGeneDeletionStrain_'</span>) &amp;&amp; <span class="keyword">...</span>
0476                         isequal(md.Methods{i}.Name(1:length(<span class="string">'analyzeSingleGeneDeletionStrain_'</span>)), <span class="string">'analyzeSingleGeneDeletionStrain_'</span>) &amp;&amp; <span class="keyword">...</span>
0477                         isequal(md.Methods{i}.InputNames, {<span class="string">'figHandle'</span>; <span class="string">'geneID'</span>; <span class="string">'deletionData'</span>; <span class="string">'wtData'</span>; <span class="string">'figData'</span>})
0478                     geneID = md.Methods{i}.Name(length(<span class="string">'analyzeSingleGeneDeletionStrain_'</span>)+1:end);
0479                     <span class="keyword">if</span> ~exist([baseDir geneID <span class="string">'.mat'</span>], <span class="string">'file'</span>)
0480                         <span class="keyword">continue</span>;
0481                     <span class="keyword">end</span>
0482                     
0483                     deletionData = load([baseDir geneID <span class="string">'.mat'</span>]);
0484                     [~, figHandle] = PlotUtil.newAxesHandle();
0485                     <span class="keyword">if</span> useCachedData &amp;&amp; exist([baseDir geneID <span class="string">'-analysis.mat'</span>], <span class="string">'file'</span>)
0486                         figData = load([baseDir geneID <span class="string">'-analysis.mat'</span>]);
0487                         SingleGeneDeletions.(md.Methods{i}.Name)(figHandle, geneID, deletionData, wtData, figData);
0488                     <span class="keyword">else</span>
0489                         figData = SingleGeneDeletions.(md.Methods{i}.Name)(figHandle, geneID, deletionData, wtData); <span class="comment">%#ok&lt;NASGU&gt;</span>
0490                         <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0491                             save([baseDir geneID <span class="string">'-analysis.mat'</span>], <span class="string">'-struct'</span>, <span class="string">'figData'</span>);
0492                         <span class="keyword">end</span>
0493                     <span class="keyword">end</span>
0494                     clear figData;
0495                     
0496                     <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0497                         saveas(figHandle, [baseDir geneID <span class="string">'-analysis.pdf'</span>]);
0498                     <span class="keyword">end</span>
0499                     close(figHandle);
0500                 <span class="keyword">end</span>
0501             <span class="keyword">end</span>
0502         <span class="keyword">end</span>
0503         
0504         <a name="_sub6" href="#_subfunctions" class="code">function plotAllDeletionStrains(iJob, nJobs)</a>
0505             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0506             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0507             import edu.stanford.covert.cell.sim.util.PlotUtil;
0508             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0509             import edu.stanford.covert.util.PdfUtil;
0510             
0511             <span class="keyword">if</span> nargin &lt; 2
0512                 iJob = 1;
0513                 nJobs = 1;
0514             <span class="keyword">end</span>
0515             
0516             <span class="comment">%% overview of all single gene deletion strains</span>
0517             sim = CachedSimulationObjectUtil.load();
0518             g = sim.gene;
0519             
0520             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0521             
0522             load([baseDir <span class="string">'geneClasses.mat'</span>]);
0523             tmp = dir([baseDir filesep <span class="string">'MG*.mat'</span>]);
0524             [~, geneticKnockouts] = ismember(cellfun(@(str) str(1:end-4), {tmp.name}', <span class="string">'UniformOutput'</span>, false), g.wholeCellModelIDs);
0525             geneIdxs = setdiff(unique(geneticKnockouts), 0);
0526             
0527             data = cell(numel(geneIdxs)+1, 1);
0528             <span class="keyword">for</span> i = 1:numel(geneIdxs)
0529                 geneID = g.wholeCellModelIDs{geneIdxs(i)};
0530                 tmp = load([baseDir geneID <span class="string">'.mat'</span>]);
0531                 <span class="keyword">if</span> numel(tmp.simEndTimes) &gt; 1
0532                     fields = setdiff(fieldnames(tmp), {<span class="string">'metaData'</span>, <span class="string">'time'</span>, <span class="string">'simEndTimes'</span>});
0533                     simIdx = randperm(numel(tmp.simEndTimes));
0534                     simIdx = simIdx(1);
0535                     tmp.metaData = tmp.metaData(simIdx);
0536                     tmp.simEndTimes = tmp.simEndTimes(simIdx);
0537                     <span class="keyword">for</span> k = 1:numel(fields)
0538                         tmp.(fields{k}) = tmp.(fields{k})(:, simIdx);
0539                     <span class="keyword">end</span>
0540                 <span class="keyword">end</span>
0541                 data{i} = tmp;
0542             <span class="keyword">end</span>
0543             data{end} = load([baseDir <span class="string">'WT.mat'</span>]);
0544             
0545             classLabels = [
0546                 [SingleGeneDeletions.DELETION_STRAIN_CLASSES(geneClasses(geneIdxs)) <span class="keyword">...</span>
0547                 cellfun(@(geneIdx) [<span class="string">'{\Delta}'</span> strrep(g.wholeCellModelIDs{geneIdx}, <span class="string">'_'</span>, <span class="string">'\_'</span>)], num2cell(geneIdxs), <span class="string">'UniformOutput'</span>, false)];
0548                 {<span class="string">'Wild-Type'</span> []}];
0549             
0550             [~, figHandle] = PlotUtil.newAxesHandle();
0551             nPlots = SingleGeneDeletions.plotSingleGeneDeletion(<span class="keyword">...</span>
0552                 data, <span class="keyword">...</span>
0553                 [geneClasses(geneIdxs); SingleGeneDeletions.WILD_TYPE], <span class="keyword">...</span>
0554                 classLabels, <span class="keyword">...</span>
0555                 [false(numel(geneIdxs), 1); true], <span class="keyword">...</span>
0556                 figHandle);
0557             
0558             <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0559                 saveas(figHandle, [baseDir <span class="string">'all.pdf'</span>]);
0560                 PdfUtil.rotatePages([baseDir <span class="string">'all.pdf'</span>]);
0561             <span class="keyword">end</span>
0562             close(figHandle);
0563             
0564             <span class="keyword">for</span> i = iJob:nJobs:nPlots
0565                 [~, figHandle] = PlotUtil.newAxesHandle();
0566                 SingleGeneDeletions.plotSingleGeneDeletion(<span class="keyword">...</span>
0567                     data, <span class="keyword">...</span>
0568                     [geneClasses(geneIdxs); SingleGeneDeletions.WILD_TYPE], <span class="keyword">...</span>
0569                     classLabels, <span class="keyword">...</span>
0570                     [false(numel(geneIdxs), 1); true], <span class="keyword">...</span>
0571                     figHandle, i);
0572                 <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0573                     saveas(figHandle, [baseDir sprintf(<span class="string">'all-%02d.pdf'</span>, i)]);
0574                 <span class="keyword">end</span>
0575                 close(figHandle);
0576             <span class="keyword">end</span>
0577         <span class="keyword">end</span>
0578         
0579         <a name="_sub7" href="#_subfunctions" class="code">function plotDeletionStrainClasses(classIdxs)</a>
0580             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0581             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0582             import edu.stanford.covert.cell.sim.util.PlotUtil;
0583             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0584             import edu.stanford.covert.util.PdfUtil;
0585             
0586             <span class="keyword">if</span> nargin &lt; 1
0587                 classIdxs = 1:size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1) - 2;
0588             <span class="keyword">end</span>
0589             
0590             sim = CachedSimulationObjectUtil.load();
0591             g = sim.gene;
0592             
0593             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0594             load([baseDir <span class="string">'geneClasses.mat'</span>]);
0595             
0596             <span class="keyword">for</span> i = 1:numel(classIdxs)
0597                 geneIdxs = find(geneClasses == classIdxs(i));
0598                 
0599                 data = cell(numel(geneIdxs) + 1, 1);
0600                 <span class="keyword">for</span> j = 1:numel(geneIdxs)
0601                     tmp = load([baseDir g.wholeCellModelIDs{geneIdxs(j)} <span class="string">'.mat'</span>]);
0602                     <span class="keyword">if</span> numel(tmp.simEndTimes) &gt; 1
0603                         fields = setdiff(fieldnames(tmp), {<span class="string">'metaData'</span>, <span class="string">'time'</span>, <span class="string">'simEndTimes'</span>});
0604                         simIdx = randperm(numel(tmp.simEndTimes));
0605                         simIdx = simIdx(1);
0606                         tmp.metaData = tmp.metaData(simIdx);
0607                         tmp.simEndTimes = tmp.simEndTimes(simIdx);
0608                         <span class="keyword">for</span> k = 1:numel(fields)
0609                             tmp.(fields{k}) = tmp.(fields{k})(:, simIdx);
0610                         <span class="keyword">end</span>
0611                     <span class="keyword">end</span>
0612                     data{j} = tmp;
0613                 <span class="keyword">end</span>
0614                 data{end} = load([baseDir <span class="string">'WT.mat'</span>]);
0615                 
0616                 classLabels = [
0617                     cellfun(@(geneIdx) [<span class="string">'{\Delta}'</span> strrep(g.wholeCellModelIDs{geneIdx}, <span class="string">'_'</span>, <span class="string">'\_'</span>)], <span class="keyword">...</span>
0618                     num2cell(geneIdxs), <span class="string">'UniformOutput'</span>, false);
0619                     {<span class="string">'Wild-Type'</span>}];
0620                 
0621                 [~, figHandle] = PlotUtil.newAxesHandle();
0622                 SingleGeneDeletions.plotSingleGeneDeletion(<span class="keyword">...</span>
0623                     data, <span class="keyword">...</span>
0624                     1:numel(data), <span class="keyword">...</span>
0625                     classLabels, <span class="keyword">...</span>
0626                     [false(numel(geneIdxs), 1); true], <span class="keyword">...</span>
0627                     figHandle, <span class="keyword">...</span>
0628                     [], [PlotUtil.getRedGreenColorOrder(1:numel(geneIdxs)); 0 1 1]);
0629                 <span class="keyword">if</span> nargin == 0
0630                     <span class="keyword">try</span> <span class="comment">%#ok&lt;TRYNC&gt;</span>
0631                         saveas(figHandle, sprintf(<span class="string">'%sclass-%d.pdf'</span>, baseDir, classIdxs(i)));
0632                         PdfUtil.rotatePages(sprintf(<span class="string">'%sclass-%d.pdf'</span>, baseDir, classIdxs(i)));
0633                     <span class="keyword">end</span>
0634                     close(figHandle);
0635                 <span class="keyword">end</span>
0636                 
0637                 clear data;
0638             <span class="keyword">end</span>
0639         <span class="keyword">end</span>
0640         
0641         <a name="_sub8" href="#_subfunctions" class="code">function plotDeletionStrainClassification()</a>
0642             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0643             import edu.stanford.covert.cell.sim.util.PlotUtil;
0644             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0645             
0646             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0647             load([baseDir <span class="string">'wtStats.mat'</span>]);
0648             load([baseDir <span class="string">'deletionStats.mat'</span>]);
0649             load([baseDir <span class="string">'geneClasses.mat'</span>]);
0650             
0651             <span class="comment">%Decomposing, non-growing, slow growing, non-essential</span>
0652             SingleGeneDeletions.plotDeletionStrainClassificationHelper(<span class="keyword">...</span>
0653                 deletionStats(:, 1, 1), deletionStats(:, 9, 1) + deletionStats(:, 10, 1), <span class="keyword">...</span>
0654                 <span class="string">'Growth (fg h^-1)'</span>, <span class="string">'Energy Usage'</span>, <span class="keyword">...</span>
0655                 geneClasses, [
0656                 SingleGeneDeletions.DECOMPOSING
0657                 SingleGeneDeletions.NON_GROWING
0658                 SingleGeneDeletions.NON_ESSENTIAL
0659                 SingleGeneDeletions.SLOW_GROWING
0660                 ], 1, <span class="string">'SouthEast'</span>);
0661             
0662             <span class="comment">%decaying growth</span>
0663             SingleGeneDeletions.plotDeletionStrainClassificationHelper(<span class="keyword">...</span>
0664                 deletionStats(:, 1, 1), deletionStats(:, 15, 1), <span class="keyword">...</span>
0665                 <span class="string">'Growth (fg h^-1)'</span>, <span class="string">'RNA Mass Decay Constant (h)'</span>, <span class="keyword">...</span>
0666                 geneClasses, [
0667                 SingleGeneDeletions.DECAYING_GROWTH_NON_RNA_PROTEIN
0668                 SingleGeneDeletions.DECAYING_GROWTH_NON_PROTEIN
0669                 ], 2, <span class="string">'NorthEast'</span>);
0670             
0671             <span class="comment">%non-replicative</span>
0672             SingleGeneDeletions.plotDeletionStrainClassificationHelper(<span class="keyword">...</span>
0673                 deletionStats(:, 1, 1), deletionStats(:, 11, 1), <span class="keyword">...</span>
0674                 <span class="string">'Growth (fg h^-1)'</span>, <span class="string">'DNA Mass (fg)'</span>, <span class="keyword">...</span>
0675                 geneClasses, [
0676                 SingleGeneDeletions.NON_REPLICATIVE
0677                 ], 3, <span class="string">'SouthWest'</span>);
0678             
0679             <span class="comment">%non-fissive</span>
0680             ydata = deletionStats(:, 7, 1);
0681             ydata(isnan(ydata)) = max(ydata);
0682             SingleGeneDeletions.plotDeletionStrainClassificationHelper(<span class="keyword">...</span>
0683                 deletionStats(:, 5, 1), ydata, <span class="keyword">...</span>
0684                 <span class="string">'Replication Time (h)'</span>, <span class="string">'Cell Cycle Length (h)'</span>, <span class="keyword">...</span>
0685                 geneClasses, [
0686                 SingleGeneDeletions.NON_FISSIVE
0687                 ], 4, <span class="string">'SouthEast'</span>);
0688             
0689             <span class="comment">%toxin accumulation</span>
0690             SingleGeneDeletions.plotDeletionStrainClassificationHelper(<span class="keyword">...</span>
0691                 deletionStats(:, 1, 1), deletionStats(:, 18, 1), <span class="keyword">...</span>
0692                 <span class="string">'Growth (fg h^-1)'</span>, <span class="string">'Damaged Protein Mass Constant (h)'</span>, <span class="keyword">...</span>
0693                 geneClasses, [
0694                 SingleGeneDeletions.TOXIN_ACCUMULATION
0695                 ], 5, <span class="string">'NorthEast'</span>);
0696         <span class="keyword">end</span>
0697         
0698         <a name="_sub9" href="#_subfunctions" class="code">function plotDeletionGrowthRateDistribution(wtGrowth, koGrowth, geneClasses, outputFile)</a>
0699             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0700             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0701             import edu.stanford.covert.cell.sim.util.PlotUtil;
0702             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0703             
0704             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0705             sim = CachedSimulationObjectUtil.load();
0706             
0707             <span class="keyword">if</span> nargin &lt; 4
0708                 outputFile = [baseDir <span class="string">'deletionGrowthRateDistribution.pdf'</span>];
0709             <span class="keyword">end</span>
0710             
0711             <span class="comment">%% get data</span>
0712             <span class="keyword">if</span> nargin &lt; 1
0713                 wtData = load([baseDir <span class="string">'WT.mat'</span>], <span class="string">'simEndTimes'</span>, <span class="string">'growth'</span>);
0714                 wtGrowth = wtData.growth(sub2ind(size(wtData.growth), wtData.simEndTimes, (1:numel(wtData.simEndTimes))'));
0715             <span class="keyword">end</span>
0716             <span class="keyword">if</span> nargin &lt; 2
0717                 load([baseDir <span class="string">'deletionStats.mat'</span>]);
0718                 koGrowth = deletionStats(:, 1, 1); <span class="comment">%#ok&lt;NODEF&gt;</span>
0719             <span class="keyword">end</span>
0720             <span class="keyword">if</span> nargin &lt; 3
0721                 load([baseDir <span class="string">'geneClasses.mat'</span>]);
0722             <span class="keyword">end</span>
0723             
0724             koNonEssGrowth = koGrowth(geneClasses == SingleGeneDeletions.NON_ESSENTIAL);
0725             koSlowGrowth = koGrowth(geneClasses == SingleGeneDeletions.SLOW_GROWING);
0726             koGrowthEssGrowth = koGrowth(ismember(geneClasses, [
0727                 SingleGeneDeletions.DECOMPOSING;
0728                 SingleGeneDeletions.NON_GROWING
0729                 SingleGeneDeletions.DECAYING_GROWTH_NON_RNA_PROTEIN;
0730                 SingleGeneDeletions.DECAYING_GROWTH_NON_PROTEIN
0731                 ]));
0732             koOtherEssGrowth = koGrowth(ismember(geneClasses, [
0733                 SingleGeneDeletions.NON_REPLICATIVE;
0734                 SingleGeneDeletions.NON_FISSIVE;
0735                 SingleGeneDeletions.NON_PERPETUATING;
0736                 SingleGeneDeletions.NO_TERMINAL_ORGANELLE
0737                 SingleGeneDeletions.TOXIN_ACCUMULATION
0738                 ]));
0739             
0740             wtGrowth =  ((wtGrowth*1e-15)/2) / sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight);
0741             koNonEssGrowth = ((koNonEssGrowth*1e-15)/2) / sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight);
0742             koSlowGrowth = ((koSlowGrowth*1e-15)/2) / sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight);
0743             koGrowthEssGrowth = ((koGrowthEssGrowth*1e-15)/2) / sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight);
0744             koOtherEssGrowth = ((koOtherEssGrowth*1e-15)/2) / sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight);
0745             
0746             edges = linspace(0, max([wtGrowth; koGrowth]), 50);
0747             freqWtGrowth = histc(wtGrowth, edges) / numel(wtGrowth);
0748             freqKONonEssGrowth = histc(koNonEssGrowth, edges) / numel(koNonEssGrowth);
0749             freqKOSlowGrowth = histc(koSlowGrowth, edges) / numel(koSlowGrowth);
0750             freqKOGrowthEssGrowth = histc(koGrowthEssGrowth, edges) / numel(koGrowthEssGrowth);
0751             freqKOOtherEssGrowth = histc(koOtherEssGrowth, edges) / numel(koOtherEssGrowth);
0752             
0753             freqWtGrowth(freqWtGrowth == 0) = NaN;
0754             freqKONonEssGrowth(freqKONonEssGrowth == 0) = NaN;
0755             freqKOSlowGrowth(freqKOSlowGrowth == 0) = NaN;
0756             freqKOGrowthEssGrowth(freqKOGrowthEssGrowth == 0) = NaN;
0757             freqKOOtherEssGrowth(freqKOOtherEssGrowth == 0) = NaN;
0758             
0759             <span class="comment">%% plot</span>
0760             [~, figHandle] = PlotUtil.newAxesHandle();
0761             clf(figHandle);
0762             
0763             w = 11.4;
0764             h = 6;
0765             set(figHandle, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0766             set(figHandle, <span class="string">'PaperSize'</span>, [w h]); <span class="comment">%6.5 in</span>
0767             set(figHandle, <span class="string">'PaperPositionMode'</span>, <span class="string">'manual'</span>);
0768             set(figHandle, <span class="string">'PaperPosition'</span>, [0 0 get(figHandle, <span class="string">'PaperSize'</span>)]);
0769             figPos = get(figHandle, <span class="string">'Position'</span>);
0770             set(figHandle, <span class="string">'Position'</span>, [figPos(1:2) figPos(3) figPos(3) * h / w]);
0771             
0772             axesHandle = subplot(<span class="string">'Position'</span>, [0.075 0.13 0.925 0.87], <span class="string">'Parent'</span>, figHandle);
0773             hold(axesHandle, <span class="string">'on'</span>);
0774             
0775             barHandles = bar(axesHandle, edges, [freqKOGrowthEssGrowth freqKOSlowGrowth freqWtGrowth] * 100);
0776             set(barHandles(1), <span class="string">'FaceColor'</span>, [0 1 0])
0777             set(barHandles(2), <span class="string">'FaceColor'</span>, [1 0 0])
0778             set(barHandles(3), <span class="string">'FaceColor'</span>, [0 0 1])
0779             set(barHandles, <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'BarWidth'</span>, 2);
0780             xlim(axesHandle, [-0.05 1.2]);
0781             ylim(axesHandle, [0 0.62] * 100);
0782             set(axesHandle, <span class="string">'XTick'</span>, 0:0.25:1.5, <span class="string">'XTickLabel'</span>, {<span class="string">'0'</span> <span class="string">''</span> <span class="string">'1'</span> <span class="string">''</span> <span class="string">'2'</span> <span class="string">''</span> <span class="string">'3'</span>});
0783             set(axesHandle, <span class="string">'YTick'</span>, (0:0.2:0.6) * 100);
0784             set(axesHandle, <span class="string">'FontSize'</span>, 5, <span class="string">'TickDir'</span>, <span class="string">'out'</span>);
0785             
0786             tick2text(axesHandle, <span class="string">'axis'</span>, <span class="string">'xy'</span>, <span class="string">'xtickoffset'</span>, 0.05, <span class="string">'ytickoffset'</span>, 0.028);
0787             xTicks = getappdata(axesHandle, <span class="string">'XTickText'</span>);
0788             yTicks = getappdata(axesHandle, <span class="string">'YTickText'</span>);
0789             set(xTicks, <span class="string">'FontSize'</span>, 5);
0790             set(yTicks, <span class="string">'FontSize'</span>, 5);
0791             delete(xTicks(2:2:end));
0792             
0793             text(0.87, 0.60 * 100, <span class="string">'Wild type'</span>, <span class="keyword">...</span>
0794                 <span class="string">'Color'</span>, [0 0 1], <span class="string">'HorizontalAlign'</span>, <span class="string">'center'</span>, <span class="string">'FontSize'</span>, 7, <span class="string">'Parent'</span>, axesHandle)
0795             text(0.48, 0.60 * 100, <span class="string">'Quasi-essential'</span>, <span class="keyword">...</span>
0796                 <span class="string">'Color'</span>, [1 0 0], <span class="string">'HorizontalAlign'</span>, <span class="string">'center'</span>, <span class="string">'FontSize'</span>, 7, <span class="string">'Parent'</span>, axesHandle)
0797             text(0.09, 0.60 * 100, <span class="string">'Essential'</span>, <span class="keyword">...</span>
0798                 <span class="string">'Color'</span>, [0 1 0], <span class="string">'HorizontalAlign'</span>, <span class="string">'center'</span>, <span class="string">'FontSize'</span>, 7, <span class="string">'Parent'</span>, axesHandle)
0799             
0800             xlabel(axesHandle, <span class="string">'Growth rate constant (h^{-1})'</span>, <span class="string">'FontSize'</span>, 7);
0801             ylabel(axesHandle, <span class="string">'% cells'</span>, <span class="string">'FontSize'</span>, 7);
0802             xlabelPos = get(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'position'</span>);
0803             ylabelPos = get(get(axesHandle, <span class="string">'ylabel'</span>), <span class="string">'position'</span>);
0804             set(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'position'</span>, [xlabelPos(1) -0.05*100 xlabelPos(end)]);
0805             set(get(axesHandle, <span class="string">'ylabel'</span>), <span class="string">'position'</span>, [-0.120 ylabelPos(2:end)]);
0806             
0807             line(xlim(axesHandle), [0 0], <span class="string">'Parent'</span>, axesHandle, <span class="string">'Color'</span>, <span class="string">'k'</span>, <span class="string">'LineWidth'</span>, 0.5)
0808             
0809             print(figHandle, outputFile, <span class="string">'-dpdf'</span>, <span class="string">'-rgb'</span>);
0810             close(figHandle);
0811         <span class="keyword">end</span>
0812         
0813         <a name="_sub10" href="#_subfunctions" class="code">function plotDeletionStrainClassificationHelper(xdata, ydata, xlabelStr, ylabelStr, geneClasses, classIdxs, plotIdx, legendLocation)</a>
0814             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0815             import edu.stanford.covert.cell.sim.util.PlotUtil;
0816             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0817             
0818             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0819             
0820             [axesHandle, figHandle] = PlotUtil.newAxesHandle();
0821             hold(axesHandle, <span class="string">'on'</span>);
0822             h = zeros(size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1), 1);
0823             <span class="keyword">for</span> i = 1:size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1) - 2
0824                 geneTfs = geneClasses == i;
0825                 <span class="keyword">if</span> ~any(geneTfs)
0826                     <span class="keyword">continue</span>;
0827                 <span class="keyword">end</span>
0828                 h(i) = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, xdata(geneTfs), ydata(geneTfs), <span class="keyword">...</span>
0829                     <span class="string">'Marker'</span>, <span class="string">'.'</span>, <span class="keyword">...</span>
0830                     <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0831                     <span class="string">'Color'</span>, SingleGeneDeletions.COLORS(i, :));
0832             <span class="keyword">end</span>
0833             classIdxs = intersect(classIdxs, find(h));
0834             uistack(h(classIdxs), <span class="string">'top'</span>)
0835             set(h(classIdxs), <span class="string">'MarkerSize'</span>, 12)
0836             legend(h(classIdxs), SingleGeneDeletions.DELETION_STRAIN_CLASSES(classIdxs), <span class="keyword">...</span>
0837                 <span class="string">'Location'</span>, legendLocation);
0838             <span class="keyword">if</span> ~isnan(range(xdata)) &amp;&amp; range(xdata)
0839                 xlim(axesHandle, [min(xdata) max(xdata)] + range(xdata) * [-0.05 0.05]);
0840             <span class="keyword">end</span>
0841             <span class="keyword">if</span> ~isnan(range(ydata)) &amp;&amp; range(ydata)
0842                 ylim(axesHandle, [min(ydata) max(ydata)] + range(ydata) * [-0.05 0.05]);
0843             <span class="keyword">end</span>
0844             xlabel(axesHandle, xlabelStr, <span class="string">'FontSize'</span>, 14);
0845             ylabel(axesHandle, ylabelStr, <span class="string">'FontSize'</span>, 14);
0846             saveas(figHandle, [baseDir <span class="string">'classification-'</span> num2str(plotIdx) <span class="string">'.pdf'</span>]);
0847             close(figHandle);
0848         <span class="keyword">end</span>
0849         
0850         <a name="_sub11" href="#_subfunctions" class="code">function plotOverview(outFileName_Figure, outFileName_Table, </a><span class="keyword">...</span>
0851                 sim, geneClasses, gridData, gridMetaData)
0852             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
0853             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
0854             import edu.stanford.covert.cell.sim.util.PlotUtil;
0855             import edu.stanford.covert.cell.sim.util.PrintUtil;
0856             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
0857             import edu.stanford.covert.util.ConstantUtil;
0858             
0859             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
0860             <span class="keyword">if</span> nargin &lt; 1 || isempty(outFileName_Figure)
0861                 outFileName_Figure = [baseDir filesep <span class="string">'overview.pdf'</span>];
0862             <span class="keyword">end</span>
0863             <span class="keyword">if</span> nargin &lt; 2 || isempty(outFileName_Table)
0864                 outFileName_Table = [baseDir <span class="string">'overview.xls'</span>];
0865             <span class="keyword">end</span>
0866             
0867             <span class="comment">%% initialize</span>
0868             figW = 17.4;
0869             figH = 7.3;
0870             
0871             [~, figHandle] = PlotUtil.newAxesHandle();
0872             clf(figHandle);
0873             set(figHandle, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0874             set(figHandle, <span class="string">'PaperSize'</span>, [figW figH]); <span class="comment">%cell two column</span>
0875             set(figHandle, <span class="string">'PaperPositionMode'</span>, <span class="string">'manual'</span>);
0876             set(figHandle, <span class="string">'PaperPosition'</span>, [0 0 get(figHandle, <span class="string">'PaperSize'</span>)]);
0877             
0878             <span class="comment">%% get data</span>
0879             <span class="keyword">if</span> nargin &lt; 3
0880                 sim = CachedSimulationObjectUtil.load();
0881             <span class="keyword">end</span>
0882             g = sim.gene;
0883             isGeneImplemented = SingleGeneDeletions.getGeneImplementations(sim);
0884             expEss = ismember(g.essential, {<span class="string">'Y'</span>, <span class="string">''</span>});
0885             <span class="keyword">if</span> nargin &lt; 4
0886                 load([baseDir <span class="string">'geneClasses.mat'</span>]);
0887             <span class="keyword">end</span>
0888             modelEss = geneClasses ~= SingleGeneDeletions.NON_ESSENTIAL;
0889             
0890             showGeneSymbols = true;
0891             geneSymbols = struct;
0892             geneSymbols.MG006 = <span class="string">'tmk'</span>;
0893             geneSymbols.MG022 = <span class="string">'rpoE'</span>;
0894             geneSymbols.MG113 = <span class="string">'asnS'</span>;
0895             geneSymbols.MG048 = <span class="string">'ffh'</span>;
0896             geneSymbols.MG001 = <span class="string">'dnaN'</span>;
0897             geneSymbols.MG204 = <span class="string">'parC'</span>;
0898             geneSymbols.MG084 = <span class="string">'tilS'</span>;
0899             
0900             <span class="comment">%% sizes</span>
0901             fontSizeSubfigLabel = 8;
0902             fontSizeLarge = 7;
0903             fontSizeMed = 6;
0904             fontSizeSmall = 5;
0905             
0906             leftColX = 0.05;
0907             leftColLabelX = 0.051;
0908             leftColW = 0.15;
0909             leftColH1 = .23;
0910             leftColH2 = 0.23;
0911             leftColH3 = leftColH2;
0912             leftColY2 = 0.375;
0913             leftColY3 = 0.0622;
0914              
0915             <span class="comment">%% part A -- model vs. observed gene essentiality</span>
0916             PlotUtil.labelSubFigure(<span class="string">'A'</span>, [leftColLabelX 1.01 -0.0286 -0.0690], figHandle);
0917             SingleGeneDeletions.plotGeneDeletionPrediction(sim, geneClasses, [leftColX 0.71 leftColW leftColH1]);
0918             
0919             <span class="comment">%% part B -- deletion strain classes spark line matrix</span>
0920             catLabels = {
0921                 <span class="string">'WT'</span>             SingleGeneDeletions.WILD_TYPE
0922                 <span class="string">'Energy'</span>         SingleGeneDeletions.DECOMPOSING
0923                 <span class="string">'Metabolic'</span>      SingleGeneDeletions.NON_GROWING
0924                 <span class="string">'RNA'</span>            SingleGeneDeletions.DECAYING_GROWTH_NON_RNA_PROTEIN
0925                 <span class="string">'Protein'</span>        SingleGeneDeletions.DECAYING_GROWTH_NON_PROTEIN
0926                 <span class="string">'Other'</span>          SingleGeneDeletions.NON_PERPETUATING
0927                 <span class="string">'DNA'</span>            SingleGeneDeletions.NON_REPLICATIVE
0928                 <span class="string">'Cytokinesis'</span>    SingleGeneDeletions.NON_FISSIVE
0929                 <span class="string">'Term Org'</span>       SingleGeneDeletions.NO_TERMINAL_ORGANELLE
0930                 <span class="string">'Damaged'</span>        SingleGeneDeletions.TOXIN_ACCUMULATION
0931                 <span class="string">'Quasi-Ess'</span>      SingleGeneDeletions.SLOW_GROWING
0932                 <span class="string">'Non-Ess'</span>        SingleGeneDeletions.NON_ESSENTIAL
0933                 };
0934             propLabels = {
0935                 {<span class="string">'NTP'</span>}                 <span class="string">'ntps'</span>
0936                 {<span class="string">'Growth (fg h^{-1})'</span>}  <span class="string">'growth'</span>
0937                 {<span class="string">'Protein (fg)'</span>}        <span class="string">'proteinWt'</span>
0938                 {<span class="string">'RNA (fg)'</span>}            <span class="string">'rnaWt'</span>
0939                 {<span class="string">'DNA (fg)'</span>}            <span class="string">'dnaWt'</span>
0940                 {<span class="string">'Septum (nm)'</span>}         <span class="string">'pinchedDiameter'</span>
0941                 {<span class="string">'Term Org (fg)'</span>}       <span class="string">'terminalOrganelleWt'</span>
0942                 {<span class="string">'Damaged'</span> <span class="string">'Prot'</span>}      <span class="string">'damagedProteins'</span>
0943                 };
0944             highlightPlot = false(size(propLabels, 1), size(catLabels, 1));
0945             highlightPlot(1:8, 2) = true;<span class="comment">%energy</span>
0946             highlightPlot(2:7, 3) = true;<span class="comment">%metabolic</span>
0947             highlightPlot([1:4 6:7], 4) = true;<span class="comment">%RNA</span>
0948             highlightPlot([2 3 6:7], 5) = true;<span class="comment">%Protein</span>
0949             highlightPlot(7, 6) = true;<span class="comment">%other synthetic</span>
0950             highlightPlot(5:6, 7) = true;<span class="comment">%DNA</span>
0951             highlightPlot(6, 8) = true;<span class="comment">%cytokinesis</span>
0952             highlightPlot(8, 10) = true;<span class="comment">%damaged</span>
0953             highlightPlot([2 3 7], 11) = true;<span class="comment">%Slow</span>
0954             
0955             groupCats = (1:size(catLabels, 1))';
0956             groupCats([2 9 10 12]) = [3 6 11 0];
0957             showProps = (1:size(propLabels, 1))';
0958             showProps([1 7 8]) = false;
0959             
0960             catIdxs = find(groupCats == (1:size(catLabels, 1))');
0961             propIdxs = find(showProps);
0962             
0963             nCats = numel(catIdxs);
0964             nProps = numel(propIdxs);
0965             
0966             time = (0:50000)' / 3600;
0967             
0968             <span class="keyword">if</span> nargin &gt;= 8
0969             <span class="keyword">elseif</span> exist([baseDir <span class="string">'overview.mat'</span>], <span class="string">'file'</span>)
0970                 load([baseDir <span class="string">'overview.mat'</span>]);
0971             <span class="keyword">else</span>
0972                 [gridData, gridMetaData] = SingleGeneDeletions.calcOverviewData();
0973                 save([baseDir <span class="string">'overview.mat'</span>], <span class="string">'gridData'</span>, <span class="string">'gridMetaData'</span>);
0974             <span class="keyword">end</span>
0975             
0976             gridData(:, :, 1) = NaN;
0977             
0978             <span class="comment">%layout</span>
0979             x = leftColX + leftColW + 0.13;
0980             y = 0.845;
0981             W = 1 - x - 0.005;
0982             H = 0.773;
0983             w = W / nCats;
0984             h = H / nProps;
0985             y1 = y + 0.12;
0986             y2 = y + 0.08;
0987             y3 = y + 0.06;
0988             yMargin = 0.13 / 2;
0989             xMargin = (h * figH) / (w * figW) * yMargin;
0990             xSpan = 1 - 2 * xMargin;
0991             ySpan = 1 - 2 * yMargin;            
0992             highlightColor = [255 230 230] / 255; <span class="comment">%light red</span>
0993             nonhighlightColor = [1 1 1]; <span class="comment">%white</span>
0994             
0995             <span class="comment">%label</span>
0996             PlotUtil.labelSubFigure(<span class="string">'B'</span>, [x-0.0650 1.01 -0.0286 -0.0690], figHandle, fontSizeSubfigLabel);
0997             
0998             <span class="comment">%data</span>
0999             xlims = [0 time(end)] + [-1 1] * (1/xSpan - 1)/2 * time(end);
1000             <span class="keyword">for</span> i = 1:nProps
1001                 <span class="keyword">for</span> j = 1:nCats
1002                     axesHandle = subplot(<span class="string">'Position'</span>, [x+(j-1)*w  y-(i)*h  w  h]);
1003                     
1004                     <span class="keyword">switch</span> propLabels{propIdxs(i), 2}
1005                         <span class="keyword">case</span> <span class="string">'ntps'</span>
1006                             yticks = [0 1e6];
1007                             ytickLabels = {num2str(yticks(1))  <span class="string">'10^6'</span>};
1008                         <span class="keyword">case</span> <span class="string">'growth'</span>
1009                             yticks = [0 2.5];
1010                             ytickLabels = {num2str(yticks(1))  num2str(yticks(2))};
1011                         <span class="keyword">case</span> <span class="string">'rnaWt'</span>
1012                             yticks = [0 0.4] * 1e-15;
1013                             ytickLabels = {num2str(yticks(1)*1e15)  num2str(yticks(2)*1e15)};
1014                         <span class="keyword">case</span> <span class="string">'proteinWt'</span>
1015                             yticks = [2 7] * 1e-15;
1016                             ytickLabels = {num2str(yticks(1)*1e15)  num2str(yticks(2)*1e15)};
1017                         <span class="keyword">case</span> <span class="string">'dnaWt'</span>
1018                             yticks = [0.6 1.2] * 1e-15;
1019                             ytickLabels = {num2str(yticks(1)*1e15)  num2str(yticks(2)*1e15)};
1020                         <span class="keyword">case</span> <span class="string">'pinchedDiameter'</span>
1021                             yticks = [0 250e-9];
1022                             ytickLabels = {num2str(yticks(1))  num2str(yticks(2) * 1e9)};
1023                         <span class="keyword">case</span> <span class="string">'terminalOrganelleWt'</span>
1024                             yticks = [0 0.1] * 1e-15;
1025                             ytickLabels = {num2str(yticks(1) * 1e15)  num2str(yticks(2) * 1e15)};
1026                         <span class="keyword">case</span> <span class="string">'damagedProteins'</span>
1027                             yticks = [0 6000];
1028                             ytickLabels = {num2str(yticks(1))  num2str(yticks(2))};
1029                         <span class="keyword">otherwise</span>
1030                             throw(MException(<span class="string">'SingleGeneDeletions:error'</span>, <span class="string">'undefined property %s'</span>, propLabels{propIdxs(i), 2}))
1031                     <span class="keyword">end</span>
1032                     ylims0 = [min(yticks(1), min(min(gridData(propIdxs(i), :, :))))  max(yticks(2), max(max(gridData(propIdxs(i), :, :))))];
1033                     ylims = ylims0 + [-1 1] * (1/ySpan - 1)/2 * (ylims0(2) - ylims0(1));
1034                     
1035                     <span class="keyword">if</span> highlightPlot(propIdxs(i), catIdxs(j))
1036                         faceColor = highlightColor;
1037                     <span class="keyword">else</span>
1038                         faceColor = nonhighlightColor;
1039                     <span class="keyword">end</span>
1040                     <span class="keyword">if</span> ~all(faceColor == 1)
1041                         hold(axesHandle, <span class="string">'on'</span>);
1042                         rectangle(<span class="string">'Parent'</span>, axesHandle, <span class="string">'Position'</span>, [xlims(1) ylims(1) range(xlims) range(ylims)], <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'FaceColor'</span>, faceColor);
1043                     <span class="keyword">end</span>
1044                     
1045                     <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, time, squeeze(gridData(propIdxs(i), catIdxs(j), :)), <span class="string">'Color'</span>, <span class="string">'k'</span>);
1046                     
1047                     set(axesHandle, <span class="string">'XTick'</span>, [], <span class="string">'YTick'</span>, []);
1048                     set(axesHandle, <span class="string">'Color'</span>, <span class="string">'none'</span>, <span class="string">'Box'</span>, <span class="string">'off'</span>, <span class="string">'Visible'</span>, <span class="string">'off'</span>);
1049                     xlim(axesHandle, xlims);
1050                     ylim(axesHandle, ylims);
1051                     
1052                     <span class="keyword">if</span> j == 1
1053                         ylims = ylim(axesHandle);
1054                         <span class="keyword">for</span> k = 1:numel(yticks)
1055                             annotation(figHandle, <span class="string">'textbox'</span>, [x-0.006 - xMargin*w  (y-i*h + h*(yticks(k)-ylims(1)) / (ylims(end)-ylims(1)))-0.005 0  0], <span class="keyword">...</span>
1056                                 <span class="string">'String'</span>, ytickLabels{k}, <span class="keyword">...</span>
1057                                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1058                                 <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
1059                                 <span class="string">'Margin'</span>, 0, <span class="keyword">...</span>
1060                                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'Right'</span>, <span class="keyword">...</span>
1061                                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Middle'</span>);
1062                             annotation(figHandle, <span class="string">'line'</span>, [x  x-0.004] - xMargin*w, (y-i*h + h*(yticks(k)-ylims(1)) / (ylims(end)-ylims(1))) * [1 1] , <span class="string">'Color'</span>, <span class="string">'k'</span>);
1063                         <span class="keyword">end</span>
1064                         annotation(figHandle, <span class="string">'line'</span>, [x; x] - xMargin*w, [
1065                             y - i*h + yMargin*h + ySpan*h
1066                             y - i*h + yMargin*h
1067                             ] , <span class="string">'Color'</span>, <span class="string">'k'</span>);
1068                     <span class="keyword">end</span>
1069                 <span class="keyword">end</span>
1070             <span class="keyword">end</span>
1071             
1072             <span class="comment">%time axis</span>
1073             axesHandle = subplot(<span class="string">'Position'</span>, [x+xMargin*w  y-H-yMargin*h  w*xSpan  1e-6]);
1074             xlim(axesHandle, [0 time(end)]);
1075             set(axesHandle, <span class="string">'XTick'</span>, [0 10], <span class="string">'YTick'</span>, [], <span class="string">'TickDir'</span>, <span class="string">'out'</span>, <span class="string">'TickLen'</span>, [0.04 0.04], <span class="string">'FontSize'</span>, fontSizeSmall, <span class="string">'YColor'</span>, get(figHandle, <span class="string">'Color'</span>));
1076             xlabel(axesHandle, <span class="string">'Time (h)'</span>, <span class="string">'FontSize'</span>, fontSizeLarge);
1077             xlabelPos = get(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'position'</span>);
1078             set(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'position'</span>, [xlabelPos(1) xlabelPos(2)-50 xlabelPos(3)]);
1079             tick2text(axesHandle, <span class="string">'axis'</span>, <span class="string">'x'</span>, <span class="string">'xtickoffset'</span>, 7);
1080             xTicks = getappdata(axesHandle, <span class="string">'XTickText'</span>);
1081             set(xTicks, <span class="string">'FontSize'</span>, fontSizeSmall, <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="string">'VerticalAlignment'</span>, <span class="string">'top'</span>);
1082             
1083             <span class="comment">%grid</span>
1084             <span class="keyword">for</span> i = 0:nProps
1085                 <span class="keyword">if</span> i &gt; 0
1086                     txtHandle = annotation(figHandle, <span class="string">'textbox'</span>, [x-0.1-0.008-0.025+0.02  y - (i - 1 / 2) * h .2 0], <span class="keyword">...</span>
1087                         <span class="string">'String'</span>, strjoin(<span class="string">' '</span>, propLabels{propIdxs(i), 1}{:}), <span class="keyword">...</span>
1088                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1089                         <span class="string">'VerticalAlignment'</span>, <span class="string">'Middle'</span>, <span class="keyword">...</span>
1090                         <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1091                         <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'Margin'</span>, 0, <span class="keyword">...</span>
1092                         <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>);
1093                     set(txtHandle, <span class="string">'Position'</span>, [x-0.2-0.008-0.018  y - (i - 1 / 2) * h 0.2 0])
1094                 <span class="keyword">end</span>
1095                 annotation(figHandle, <span class="string">'line'</span>, x + [0 W], y - i * h * [1 1], <span class="string">'Color'</span>, [0.75 0.75 0.75]);
1096             <span class="keyword">end</span>
1097             txtHandles = zeros(nCats, 1);
1098             <span class="keyword">for</span> i = 0:nCats
1099                 <span class="keyword">if</span> i &gt; 0
1100                     txtHandles(i) = annotation(figHandle, <span class="string">'textbox'</span>, [x+(i-1/2)*w  y+0.03  0  0], <span class="keyword">...</span>
1101                         <span class="string">'String'</span>, catLabels{catIdxs(i), 1}, <span class="keyword">...</span>
1102                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1103                         <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
1104                         <span class="string">'FontSize'</span>, fontSizeMed, <span class="keyword">...</span>
1105                         <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
1106                         <span class="string">'Margin'</span>, 0, <span class="keyword">...</span>
1107                         <span class="string">'FitBoxToText'</span>, <span class="string">'on'</span>);
1108                 <span class="keyword">end</span>
1109                 <span class="keyword">if</span> i &gt; 0 &amp;&amp; catLabels{catIdxs(i), 2} ~= SingleGeneDeletions.WILD_TYPE
1110                     nGenes = 0;
1111                     nCorrect = 0;
1112                     <span class="keyword">for</span> j = 1:numel(groupCats)
1113                         <span class="keyword">if</span> groupCats(j) == catIdxs(i)
1114                             nGenes = nGenes + <span class="keyword">...</span>
1115                                 sum(isGeneImplemented &amp; geneClasses == catLabels{j, 2});
1116                             nCorrect = nCorrect + <span class="keyword">...</span>
1117                                 sum(expEss == modelEss &amp; isGeneImplemented &amp; geneClasses == catLabels{j, 2});
1118                         <span class="keyword">end</span>
1119                     <span class="keyword">end</span>
1120                     
1121                     tmp = strrep(gridMetaData(catIdxs(i)).gene, <span class="string">'_'</span>, <span class="string">''</span>);
1122                     <span class="keyword">if</span> showGeneSymbols
1123                         tmp = sprintf(<span class="string">'{\\it{%s}}'</span>, geneSymbols.(tmp));
1124                     <span class="keyword">end</span>
1125                     
1126                     txtHandles(i) = annotation(figHandle, <span class="string">'textbox'</span>, [x+(i-1/2)*w  y+0.005  0  0], <span class="keyword">...</span>
1127                         <span class="string">'String'</span>, sprintf(<span class="string">'(%d, %s)'</span>, nGenes, tmp), <span class="keyword">...</span>
1128                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1129                         <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
1130                         <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1131                         <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
1132                         <span class="string">'Margin'</span>, 0, <span class="keyword">...</span>
1133                         <span class="string">'FitBoxToText'</span>, <span class="string">'on'</span>);
1134                 <span class="keyword">end</span>
1135                 annotation(figHandle, <span class="string">'line'</span>, x + i * w * [1 1], y - [0 H], <span class="string">'Color'</span>, [0.75 0.75 0.75]);
1136             <span class="keyword">end</span>
1137             
1138             <span class="comment">%dendrogram</span>
1139             annotation(figHandle, <span class="string">'line'</span>, x + ( 1.5) * w * [1 1] + [0 6*w], [y1 y1],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1140             annotation(figHandle, <span class="string">'line'</span>, x + ( 1.5) * w * [1 1], [y1 y3],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1141             annotation(figHandle, <span class="string">'line'</span>, x + ( 3.5) * w * [1 1], [y1 y2+0.03],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1142             annotation(figHandle, <span class="string">'line'</span>, x + ( 6) * w * [1 1], [y1 y2+0.03],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1143             annotation(figHandle, <span class="string">'line'</span>, x + (7.5) * w * [1 1], [y3 y1],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1144             
1145             annotation(figHandle, <span class="string">'line'</span>, x + ( 2.5) * w * [1 1], [y3 y2],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1146             annotation(figHandle, <span class="string">'line'</span>, x + ( 2.5) * w * [1 1] + [0 2*w], [y2 y2],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1147             annotation(figHandle, <span class="string">'line'</span>, x + ( 4.5) * w * [1 1], [y2 y3],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1148             
1149             annotation(figHandle, <span class="string">'line'</span>, x + (5.5) * w * [1 1], [y3 y2],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1150             annotation(figHandle, <span class="string">'line'</span>, x + (5.5) * w * [1 1] + [0 w], [y2 y2],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1151             annotation(figHandle, <span class="string">'line'</span>, x + (6.5) * w * [1 1], [y2 y3],  <span class="string">'Color'</span>, <span class="string">'k'</span>);
1152             
1153             txtBox = [
1154                 annotation(figHandle, <span class="string">'textbox'</span>, [x+4.5*w-0.15  y1+0.02 0.3 0], <span class="string">'String'</span>, <span class="string">'Essential'</span>)
1155                 annotation(figHandle, <span class="string">'textbox'</span>, [x+3.5*w-0.15  y2+0.02 0.3 0], <span class="string">'String'</span>, <span class="string">'Macromolecule synthesis'</span>)
1156                 annotation(figHandle, <span class="string">'textbox'</span>, [x+6*w-0.15  y2+0.02 0.3 0],   <span class="string">'String'</span>, <span class="string">'Cell cycle'</span>)
1157                 ];
1158             set(txtBox, <span class="string">'FontSize'</span>, fontSizeLarge, <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="string">'Margin'</span>, 0, <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'FitBoxToText'</span>, <span class="string">'on'</span>);
1159             
1160             <span class="comment">%% part C -- methionine aminopeptidase, type I (MG_172)</span>
1161             
1162             nGenerations = 10;
1163             nSamples = 20;
1164             <span class="keyword">if</span> exist([baseDir filesep <span class="string">'MG_172-analysis2.mat'</span>], <span class="string">'file'</span>)
1165                 load([baseDir filesep <span class="string">'MG_172-analysis2.mat'</span>])
1166             <span class="keyword">else</span>
1167                 g = sim.gene;
1168                 r = sim.state(<span class="string">'Rna'</span>);
1169                 pm = sim.state(<span class="string">'ProteinMonomer'</span>);
1170                 pc = sim.state(<span class="string">'ProteinComplex'</span>);
1171                 mr = sim.state(<span class="string">'MetabolicReaction'</span>);
1172                 ppI = sim.process(<span class="string">'ProteinProcessingI'</span>);
1173                 met = sim.process(<span class="string">'Metabolism'</span>);
1174                 
1175                 sim.setForTest(<span class="string">'processesInInitOrder'</span>, sim.processesInInitOrder(~ismember(<span class="keyword">...</span>
1176                     cellfun(@(p) p.name, sim.processesInInitOrder, <span class="string">'UniformOutput'</span>, false), {<span class="keyword">...</span>
1177                     <span class="string">'Transcription'</span>
1178                     <span class="string">'FtsZPolymerization'</span>
1179                     <span class="string">'ChromosomeCondensation'</span>
1180                     <span class="string">'Translation'</span>
1181                     <span class="string">'DNASupercoiling'</span>
1182                     <span class="string">'ReplicationInitiation'</span>
1183                     })));
1184                 
1185                 pcComp = sum(pc.proteinComplexComposition(g.mRNAIndexs, :, :), 3);
1186                 monIdxs = ppI.nascentMonomerNTerminalMethionineCleavages;
1187                 unprocessedMonIdxs = ~ppI.nascentMonomerNTerminalMethionineCleavages;
1188                 cpxIdxs = find(any(pcComp(monIdxs, :), 1));
1189                 
1190                 rnaExp = r.expression;
1191                 rnaDecayRates = r.decayRates;
1192                 monDecayRates = pm.decayRates;
1193                 cpxDecayRates = pc.decayRates;
1194                 
1195                 cleavedMonWt = zeros(nGenerations, 3);
1196                 growths = zeros(nGenerations, 3);
1197                 <span class="keyword">for</span> i = 1:nGenerations
1198                     tmpCleavedMonWt = zeros(nSamples, 1);
1199                     tmpGrowths = zeros(nSamples, 1);
1200                     <span class="keyword">for</span> j = 1:nSamples
1201                         r.expression = rnaExp;
1202                         r.decayRates = rnaDecayRates;
1203                         pm.decayRates = monDecayRates;
1204                         pc.decayRates = cpxDecayRates;
1205                         mr.initialGrowthFilterWidth = Inf;
1206                         
1207                         sim.applyOptions(<span class="string">'seed'</span>, i * nGenerations + j);
1208                         sim.allocateMemoryForState(1);
1209                         sim.initializeState();
1210                         sim.applyPerturbations();
1211                         
1212                         mons = pm.counts;
1213                         cpxs = pc.counts;
1214                         
1215                         pm.counts(pm.processedIIIndexs(monIdxs),    :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.processedIIIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1216                         pm.counts(pm.signalSequenceIndexs(monIdxs), :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.signalSequenceIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1217                         pm.counts(pm.foldedIndexs(monIdxs),         :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.foldedIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1218                         pm.counts(pm.matureIndexs(monIdxs),         :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.matureIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1219                         pm.counts(pm.inactivatedIndexs(monIdxs),    :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.inactivatedIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1220                         pm.counts(pm.boundIndexs(monIdxs),          :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.boundIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1221                         pm.counts(pm.misfoldedIndexs(monIdxs),      :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.misfoldedIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1222                         pm.counts(pm.damagedIndexs(monIdxs),        :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.damagedIndexs(monIdxs), :), 1 / (2.^(i - 1)));
1223                         
1224                         pc.counts(pc.nascentIndexs(cpxIdxs),     :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.nascentIndexs(cpxIdxs), :), 1 / (2.^(i - 1)));
1225                         pc.counts(pc.matureIndexs(cpxIdxs),      :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.matureIndexs(cpxIdxs), :), 1 / (2.^(i - 1)));
1226                         pc.counts(pc.inactivatedIndexs(cpxIdxs), :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.inactivatedIndexs(cpxIdxs), :), 1 / (2.^(i - 1)));
1227                         pc.counts(pc.boundIndexs(cpxIdxs),       :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.boundIndexs(cpxIdxs), :), 1 / (2.^(i - 1)));
1228                         pc.counts(pc.misfoldedIndexs(cpxIdxs),   :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.misfoldedIndexs(cpxIdxs), :), 1 / (2.^(i - 1)));
1229                         pc.counts(pc.damagedIndexs(cpxIdxs),     :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.damagedIndexs(cpxIdxs), :), 1 / (2.^(i - 1)));
1230                         
1231                         diffMons = <span class="keyword">...</span>
1232                             + mons(pm.processedIIIndexs,    :) - pm.counts(pm.processedIIIndexs, :) <span class="keyword">...</span>
1233                             + mons(pm.signalSequenceIndexs, :) - pm.counts(pm.signalSequenceIndexs, :) <span class="keyword">...</span>
1234                             + mons(pm.foldedIndexs,         :) - pm.counts(pm.foldedIndexs, :) <span class="keyword">...</span>
1235                             + mons(pm.matureIndexs,         :) - pm.counts(pm.matureIndexs, :) <span class="keyword">...</span>
1236                             + mons(pm.inactivatedIndexs,    :) - pm.counts(pm.inactivatedIndexs, :) <span class="keyword">...</span>
1237                             + mons(pm.boundIndexs,          :) - pm.counts(pm.boundIndexs, :) <span class="keyword">...</span>
1238                             + mons(pm.misfoldedIndexs,      :) - pm.counts(pm.misfoldedIndexs, :) <span class="keyword">...</span>
1239                             + mons(pm.damagedIndexs,        :) - pm.counts(pm.damagedIndexs, :);
1240                         diffCpxs = <span class="keyword">...</span>
1241                             + cpxs(pc.nascentIndexs,     :) - pc.counts(pc.nascentIndexs, :) <span class="keyword">...</span>
1242                             + cpxs(pc.matureIndexs,      :) - pc.counts(pc.matureIndexs, :) <span class="keyword">...</span>
1243                             + cpxs(pc.inactivatedIndexs, :) - pc.counts(pc.inactivatedIndexs, :) <span class="keyword">...</span>
1244                             + cpxs(pc.boundIndexs,       :) - pc.counts(pc.boundIndexs, :) <span class="keyword">...</span>
1245                             + cpxs(pc.misfoldedIndexs,   :) - pc.counts(pc.misfoldedIndexs, :) <span class="keyword">...</span>
1246                             + cpxs(pc.damagedIndexs,     :) - pc.counts(pc.damagedIndexs, :);
1247                         pm.counts(pm.processedIIndexs, :) = <span class="keyword">...</span>
1248                             + pm.counts(pm.processedIIndexs, :) <span class="keyword">...</span>
1249                             + diffMons;
1250                         pm.counts(pm.processedIIndexs(monIdxs), :) = <span class="keyword">...</span>
1251                             + pm.counts(pm.processedIIndexs(monIdxs), :) <span class="keyword">...</span>
1252                             + pcComp(monIdxs, :) * diffCpxs;
1253                         pm.counts(pm.matureIndexs(unprocessedMonIdxs), :) = <span class="keyword">...</span>
1254                             + pm.counts(pm.matureIndexs(unprocessedMonIdxs), :) <span class="keyword">...</span>
1255                             + pcComp(unprocessedMonIdxs, :) * diffCpxs;
1256                         
1257                         pmCnts = sum(pm.counts, 2);
1258                         pcCnts = sum(pc.counts, 2);
1259                         totMons = <span class="keyword">...</span>
1260                             + pmCnts(pm.matureIndexs) <span class="keyword">...</span>
1261                             + pmCnts(pm.boundIndexs) <span class="keyword">...</span>
1262                             + sum(pc.proteinComplexComposition(g.mRNAIndexs, :, :), 3) * (<span class="keyword">...</span>
1263                                 + pcCnts(pc.matureIndexs) <span class="keyword">...</span>
1264                                 + pcCnts(pc.boundIndexs));
1265                         tmpCleavedMonWt(j) = (totMons .* ppI.nascentMonomerNTerminalMethionineCleavages)' * pm.molecularWeights(pm.matureIndexs) / ConstantUtil.nAvogadro * 1e15;
1266                         
1267                         processes = sim.processes;
1268                         sim.setForTest(<span class="string">'processes'</span>, {met});
1269                         sim.evolveState();
1270                         sim.setForTest(<span class="string">'processes'</span>, processes);
1271                         
1272                         tmpGrowths(j) = mr.growth;
1273                     <span class="keyword">end</span>
1274                     
1275                     cleavedMonWt(i, 1) = mean(tmpCleavedMonWt);
1276                     cleavedMonWt(i, 2:3) = quantile(tmpCleavedMonWt, [0.341 0.682]) - mean(tmpCleavedMonWt);
1277                     
1278                     growths(i, 1) = mean(tmpGrowths);
1279                     growths(i, 2:3) = quantile(tmpGrowths, [0.341 0.682]) - mean(tmpGrowths);
1280                 <span class="keyword">end</span>
1281                 
1282                 save([baseDir filesep <span class="string">'MG_172-analysis2.mat'</span>], <span class="string">'growths'</span>, <span class="string">'cleavedMonWt'</span>);
1283             <span class="keyword">end</span>
1284             
1285             growths = growths * 3600 * sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight) * 1e15;
1286                         
1287             PlotUtil.labelSubFigure(<span class="string">'C'</span>, [leftColLabelX leftColY2+leftColH2+0.05 -0.0286 -0.0690], figHandle, fontSizeSubfigLabel);
1288             
1289             axesHandle = subplot(<span class="string">'Position'</span>, [leftColX leftColY2 leftColW leftColH2]);
1290             hold(axesHandle, <span class="string">'on'</span>);
1291             errorbar((0:nGenerations-1)', cleavedMonWt(ones(nGenerations, 1), 1), cleavedMonWt(ones(nGenerations, 1), 2), cleavedMonWt(ones(nGenerations, 1), 3), <span class="string">'Color'</span>, <span class="string">'k'</span>);
1292             errorbar((0:nGenerations-1)', cleavedMonWt(:, 1), cleavedMonWt(:, 2), cleavedMonWt(:, 3), <span class="string">'Color'</span>, [0 0 255] / 255);
1293             xlabel(axesHandle, <span class="string">'Generation'</span>, <span class="string">'FontSize'</span>, fontSizeLarge);
1294             ylabel(axesHandle, {<span class="string">'N-term cleaved'</span> <span class="string">'protein (fg)'</span>}, <span class="string">'FontSize'</span>, fontSizeLarge);
1295             xlim(axesHandle, [-0.25 8.25])
1296             ylim(axesHandle, [-0.01 max(cleavedMonWt(:, 1) + cleavedMonWt(:, 3))])
1297             set(axesHandle, <span class="string">'XTick'</span>, [0 5])
1298             set(axesHandle, <span class="string">'YTick'</span>, 0:0.1:0.3)
1299             set(axesHandle, <span class="string">'FontSize'</span>, fontSizeSmall)
1300             text(8.2, 0.315, <span class="string">'WT'</span>, <span class="keyword">...</span>
1301                 <span class="string">'Margin'</span>, 1e-6, <span class="keyword">...</span>
1302                 <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1303                 <span class="string">'Color'</span>, <span class="string">'k'</span>, <span class="keyword">...</span>
1304                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1305                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1306                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Top'</span>)
1307             text(8.2, 0, <span class="string">'{\Delta}map'</span>, <span class="keyword">...</span>
1308                 <span class="string">'Margin'</span>, 1e-6, <span class="keyword">...</span>
1309                 <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1310                 <span class="string">'Color'</span>, [0 0 255] / 255, <span class="keyword">...</span>
1311                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1312                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1313                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Bottom'</span>);
1314             set(axesHandle, <span class="string">'FontSize'</span>, fontSizeSmall, <span class="string">'TickLen'</span>, [0.01 0.01], <span class="string">'TickDir'</span>, <span class="string">'out'</span>);
1315             tick2text(axesHandle, <span class="string">'axis'</span>, <span class="string">'xy'</span>, <span class="string">'xtickoffset'</span>, 0.07, <span class="string">'ytickoffset'</span>, 0.02);
1316             xTicks = getappdata(axesHandle, <span class="string">'XTickText'</span>);
1317             yTicks = getappdata(axesHandle, <span class="string">'YTickText'</span>);
1318             set(xTicks, <span class="keyword">...</span>
1319                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1320                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'Center'</span>, <span class="keyword">...</span>
1321                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Middle'</span>);
1322             set(yTicks, <span class="keyword">...</span>
1323                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1324                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1325                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Middle'</span>);
1326             delete(yTicks(2:end-1));
1327             
1328             xLabelPos = get(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'Position'</span>);
1329             set(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'Position'</span>, [xLabelPos(1) -0.055 xLabelPos(3)]);
1330             
1331             yLabelPos = get(get(axesHandle, <span class="string">'ylabel'</span>), <span class="string">'Position'</span>);
1332             set(get(axesHandle, <span class="string">'ylabel'</span>), <span class="string">'Position'</span>, [-1.3 yLabelPos(2:end)]);
1333             
1334             <span class="comment">%% part D -- methionine aminopeptidase, type I (MG_172)</span>
1335             PlotUtil.labelSubFigure(<span class="string">'D'</span>, [leftColLabelX leftColY3+leftColH3+0.05 -0.0286 -0.0690], figHandle, fontSizeSubfigLabel);
1336             
1337             axesHandle = subplot(<span class="string">'Position'</span>, [leftColX leftColY3 leftColW leftColH3]);
1338             hold(axesHandle, <span class="string">'on'</span>);
1339             errorbar((0:nGenerations-1)', growths(ones(nGenerations, 1), 1), growths(ones(nGenerations, 1), 2), growths(ones(nGenerations, 1), 3), <span class="string">'Color'</span>, <span class="string">'k'</span>);
1340             errorbar((0:nGenerations-1)', growths(:, 1), growths(:, 2), growths(:, 3), <span class="string">'Color'</span>, [0 0 255] / 255);
1341             xlabel(axesHandle, <span class="string">'Generation'</span>, <span class="string">'FontSize'</span>, fontSizeLarge);
1342             ylabel(axesHandle, <span class="string">'Growth (fg h^{-1})'</span>, <span class="string">'FontSize'</span>, fontSizeLarge);
1343             xlim(axesHandle, [-0.25 8.25])
1344             ylim(axesHandle, [-0.05 max(growths(:, 1) + growths(:, 3))])
1345             set(axesHandle, <span class="string">'XTick'</span>, [0 5])
1346             set(axesHandle, <span class="string">'YTick'</span>, 0:0.25:1)
1347             set(axesHandle, <span class="string">'FontSize'</span>, fontSizeSmall)
1348             text(8.2, 0.92, <span class="string">'WT'</span>, <span class="keyword">...</span>
1349                 <span class="string">'Margin'</span>, 1e-6, <span class="keyword">...</span>
1350                 <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1351                 <span class="string">'Color'</span>, <span class="string">'k'</span>, <span class="keyword">...</span>
1352                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1353                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1354                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Top'</span>)
1355             text(8.2, 0, <span class="string">'{\Delta}map'</span>, <span class="keyword">...</span>
1356                 <span class="string">'Margin'</span>, 1e-6, <span class="keyword">...</span>
1357                 <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1358                 <span class="string">'Color'</span>, [0 0 255] / 255, <span class="keyword">...</span>
1359                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1360                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1361                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Bottom'</span>);
1362             set(axesHandle, <span class="string">'FontSize'</span>, fontSizeSmall, <span class="string">'TickLen'</span>, [0.01 0.01], <span class="string">'TickDir'</span>, <span class="string">'out'</span>);
1363             tick2text(axesHandle, <span class="string">'axis'</span>, <span class="string">'xy'</span>, <span class="string">'xtickoffset'</span>, 0.07, <span class="string">'ytickoffset'</span>, 0.02);
1364             xTicks = getappdata(axesHandle, <span class="string">'XTickText'</span>);
1365             yTicks = getappdata(axesHandle, <span class="string">'YTickText'</span>);
1366             set(xTicks, <span class="keyword">...</span>
1367                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1368                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'Center'</span>, <span class="keyword">...</span>
1369                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Middle'</span>);
1370             set(yTicks, <span class="keyword">...</span>
1371                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1372                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1373                 <span class="string">'VerticalAlignment'</span>, <span class="string">'Middle'</span>);
1374             delete(yTicks(2:end-1));
1375             
1376             xLabelPos = get(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'Position'</span>);
1377             set(get(axesHandle, <span class="string">'xlabel'</span>), <span class="string">'Position'</span>, [xLabelPos(1) -0.18 xLabelPos(3)]);
1378             
1379             yLabelPos = get(get(axesHandle, <span class="string">'ylabel'</span>), <span class="string">'Position'</span>);
1380             set(get(axesHandle, <span class="string">'ylabel'</span>), <span class="string">'Position'</span>, [-1.3 yLabelPos(2:end)]);
1381             
1382             <span class="comment">%% standarize tick lengths</span>
1383             paperSize = get(figHandle, <span class="string">'PaperSize'</span>);
1384             figW = paperSize(1);
1385             figH = paperSize(2);
1386             axesHandles = findobj(figHandle, <span class="string">'type'</span>, <span class="string">'axes'</span>, <span class="string">'-and'</span>, <span class="string">'tag'</span>, <span class="string">''</span>);
1387             axesPos = cell2mat(get(axesHandles, <span class="string">'position'</span>));
1388             tickLen = 0.0075 * max(max(axesPos(:, 3:4), [], 1) .* [figW figH]);
1389             <span class="keyword">for</span> i = 1:numel(axesHandles)
1390                 maxVal = max(axesPos(i, 3:4) .* [figW figH]);
1391                 set(axesHandles(i), <span class="string">'TickLen'</span>, [tickLen / maxVal  0.0250]);
1392             <span class="keyword">end</span>
1393             
1394             <span class="comment">%% save figure</span>
1395             print(figHandle, outFileName_Figure, <span class="string">'-dpdf'</span>, <span class="string">'-rgb'</span>);
1396             close(figHandle);
1397             
1398             <span class="comment">%% save</span>
1399             colLabels = {<span class="string">'Class'</span> <span class="string">'Name'</span> <span class="string">'No Genes'</span> <span class="string">'No Simulations'</span> <span class="string">'Representative Gene Locus Tag'</span> <span class="string">'Representative Gene Symbol'</span> <span class="string">'Representative Simulation Batch'</span> <span class="string">'Representative Simulation Index'</span>};
1400             content = cell(0, numel(colLabels));
1401             <span class="keyword">for</span> i = 1:numel(catIdxs)
1402                 nGenes = 0;
1403                 nSimulations = 0;
1404                 <span class="keyword">for</span> j = 1:numel(groupCats)
1405                     <span class="keyword">if</span> groupCats(j) == catIdxs(i)
1406                         nGenes = nGenes + gridMetaData(j).nGenes;
1407                         nSimulations = nSimulations + gridMetaData(j).nSimulations;
1408                     <span class="keyword">end</span>
1409                 <span class="keyword">end</span>
1410                 
1411                 locusTag = gridMetaData(catIdxs(i)).gene;
1412                 <span class="keyword">if</span> ~isempty(locusTag)
1413                     symbol = geneSymbols.(strrep(locusTag, <span class="string">'_'</span>, <span class="string">''</span>));
1414                 <span class="keyword">else</span>
1415                     symbol = [];
1416                 <span class="keyword">end</span>
1417                 
1418                 content = [content; {
1419                     catLabels{catIdxs(i), 1} <span class="keyword">...</span>
1420                     SingleGeneDeletions.DELETION_STRAIN_CLASSES{catLabels{catIdxs(i), 2}, 1} <span class="keyword">...</span>
1421                     nGenes <span class="keyword">...</span>
1422                     nSimulations <span class="keyword">...</span>
1423                     locusTag <span class="keyword">...</span><span class="comment">                    </span>
1424                     symbol, <span class="keyword">...</span><span class="comment">                   </span>
1425                     gridMetaData(catIdxs(i)).simGroup <span class="keyword">...</span>
1426                     gridMetaData(catIdxs(i)).simIdx <span class="keyword">...</span>
1427                     }];
1428             <span class="keyword">end</span>
1429 
1430             <span class="keyword">if</span> ispc &amp;&amp; exist(outFileName_Table, <span class="string">'file'</span>)
1431                 delete(outFileName_Table)
1432             <span class="keyword">end</span>
1433             PrintUtil.printToFile(content, colLabels, outFileName_Table, <span class="string">'Single Gene Deletions'</span>);
1434         <span class="keyword">end</span>
1435         
1436         <a name="_sub12" href="#_subfunctions" class="code">function plotGeneDeletionPrediction(sim, geneClasses, position)</a>
1437             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
1438             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
1439             import edu.stanford.covert.cell.sim.util.PlotUtil;
1440             import edu.stanford.covert.cell.sim.util.PrintUtil;
1441             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
1442             
1443             g = sim.gene;
1444             isGeneImplemented = SingleGeneDeletions.getGeneImplementations(sim);
1445             expEss = ismember(g.essential, {<span class="string">'Y'</span>, <span class="string">''</span>});
1446             modelEss = geneClasses ~= SingleGeneDeletions.NON_ESSENTIAL;
1447             
1448             <span class="comment">%% fontsizes</span>
1449             fontSizeLarge = 7;
1450             fontSizeSmall = 5;
1451                         
1452             axesHandle = subplot(<span class="string">'Position'</span>, position);
1453             axis(axesHandle, <span class="string">'equal'</span>);
1454             xlim(axesHandle, [-0.5 1.5]);
1455             ylim(axesHandle, [-0.5 1.5]);
1456             set(axesHandle, <span class="string">'Box'</span>, <span class="string">'on'</span>);
1457             line([0.5 0.5], [-0.5 1.5], <span class="string">'Parent'</span>, axesHandle, <span class="string">'Color'</span>, <span class="string">'k'</span>)
1458             line([-0.5 1.5], [0.5 0.5], <span class="string">'Parent'</span>, axesHandle, <span class="string">'Color'</span>, <span class="string">'k'</span>)
1459             set(axesHandle, <span class="string">'XAxisLocation'</span>, <span class="string">'top'</span>);
1460             set(axesHandle, <span class="string">'XDir'</span>,<span class="string">'reverse'</span>);
1461             
1462             set(axesHandle, <span class="string">'TickLength'</span>, [0 0]);
1463             set(axesHandle, <span class="string">'XTick'</span>, [0 1]);
1464             set(axesHandle, <span class="string">'YTick'</span>, [0 1]);
1465             tick2text(axesHandle, <span class="string">'axis'</span>, <span class="string">'xy'</span>, <span class="string">'ytickoffset'</span>, 0.06)
1466             xTicks = getappdata(axesHandle, <span class="string">'XTickText'</span>);
1467             yTicks = getappdata(axesHandle, <span class="string">'YTickText'</span>);
1468             set(xTicks, <span class="keyword">...</span>
1469                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1470                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1471                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>);
1472             set(xTicks(1), <span class="string">'String'</span>, <span class="string">'Non-ess'</span>, <span class="string">'Position'</span>, [0 1.68 -1]);
1473             set(xTicks(2), <span class="string">'String'</span>, <span class="string">'Essential'</span>, <span class="string">'Position'</span>, [1 1.68 -1]);
1474             set(yTicks, <span class="string">'rotation'</span>, 90, <span class="keyword">...</span>
1475                 <span class="string">'FontSize'</span>, fontSizeSmall, <span class="keyword">...</span>
1476                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1477                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>);
1478             set(yTicks(1), <span class="string">'String'</span>, <span class="string">'Non-ess'</span>, <span class="string">'Position'</span>, [1.68 0 -1]);
1479             set(yTicks(2), <span class="string">'String'</span>, <span class="string">'Essential'</span>, <span class="string">'Position'</span>, [1.68 1 -1]);
1480             
1481             xlabel(axesHandle', <span class="string">'Model'</span>);
1482             ylabel(axesHandle, <span class="string">'Experiment'</span>);
1483             xlab = get(axesHandle, <span class="string">'xLabel'</span>);
1484             ylab = get(axesHandle, <span class="string">'yLabel'</span>);
1485             set(xlab, <span class="keyword">...</span>
1486                 <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1487                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1488                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
1489                 <span class="string">'Position'</span>, [0.5 1.9 1]);
1490             set(ylab, <span class="keyword">...</span>
1491                 <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1492                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1493                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
1494                 <span class="string">'Position'</span>, [1.9 0.5 1]);
1495             
1496             data = zeros(2, 2);
1497             data(1, 1) = sum(~modelEss &amp; ~expEss &amp; isGeneImplemented);
1498             data(1, 2) = sum(~modelEss &amp;  expEss &amp; isGeneImplemented);
1499             data(2, 1) = sum( modelEss &amp; ~expEss &amp; isGeneImplemented);
1500             data(2, 2) = sum( modelEss &amp;  expEss &amp; isGeneImplemented);
1501             <span class="keyword">for</span> i = 0:1
1502                 <span class="keyword">for</span> j = 0:1
1503                     text(i, j, num2str(data(i+1, j+1)), <span class="keyword">...</span>
1504                         <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1505                         <span class="string">'FontSize'</span>, fontSizeLarge, <span class="keyword">...</span>
1506                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
1507                         <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>);
1508                 <span class="keyword">end</span>
1509             <span class="keyword">end</span>
1510             
1511             text(1.75, -0.68, sprintf(<span class="string">'Correct:'</span>), <span class="keyword">...</span>
1512                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1513                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
1514                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
1515                 <span class="string">'FontSize'</span>, fontSizeLarge);
1516             text(1.75, -0.98, sprintf(<span class="string">'Incorrect:'</span>), <span class="keyword">...</span>
1517                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1518                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
1519                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
1520                 <span class="string">'FontSize'</span>, fontSizeLarge);
1521             text(-0.75, -0.68, sprintf(<span class="string">'%d (%d%%)'</span>, sum(diag(data)), round(100 * sum(diag(data)) / sum(data(:)))), <span class="keyword">...</span>
1522                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1523                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1524                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
1525                 <span class="string">'FontSize'</span>, fontSizeLarge);
1526             text(-0.75, -0.98, sprintf(<span class="string">'%d (%d%%)'</span>, sum(data(:)) - sum(diag(data)), round(100 * (1 - sum(diag(data)) / sum(data(:))))), <span class="keyword">...</span>
1527                 <span class="string">'Parent'</span>, axesHandle, <span class="keyword">...</span>
1528                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1529                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
1530                 <span class="string">'FontSize'</span>, fontSizeLarge);
1531         <span class="keyword">end</span>
1532         
1533         <a name="_sub13" href="#_subfunctions" class="code">function [gridData, gridMetaData] = calcOverviewData(iJob, nJobs)</a>
1534             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
1535             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
1536             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
1537             
1538             <span class="keyword">if</span> nargin &lt; 2
1539                 iJob = 1;
1540                 nJobs = 1;
1541             <span class="keyword">end</span>
1542             
1543             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
1544             load([baseDir <span class="string">'geneClasses.mat'</span>]);
1545             
1546             sim = CachedSimulationObjectUtil.load();
1547             g = sim.gene;
1548             
1549             isGeneImplemented = SingleGeneDeletions.getGeneImplementations(sim);
1550             
1551             nCats = size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1) - 1;
1552             nProps = 8;
1553             nTime = 50001;
1554             catLabels = {
1555                 <span class="string">'WT'</span>             SingleGeneDeletions.WILD_TYPE                        <span class="string">'growth'</span>
1556                 <span class="string">'Energy'</span>         SingleGeneDeletions.DECOMPOSING                      <span class="string">'ntps'</span>
1557                 <span class="string">'Metabolic'</span>      SingleGeneDeletions.NON_GROWING                      <span class="string">'growth'</span>
1558                 <span class="string">'RNA'</span>            SingleGeneDeletions.DECAYING_GROWTH_NON_RNA_PROTEIN  <span class="string">'rnaWt'</span>
1559                 <span class="string">'Protein'</span>        SingleGeneDeletions.DECAYING_GROWTH_NON_PROTEIN      <span class="string">'proteinWt'</span>
1560                 <span class="string">'Other'</span>          SingleGeneDeletions.NON_PERPETUATING                 <span class="string">'proteinWt'</span>
1561                 <span class="string">'DNA'</span>            SingleGeneDeletions.NON_REPLICATIVE                  <span class="string">'dnaWt'</span>
1562                 <span class="string">'Cytokinesis'</span>    SingleGeneDeletions.NON_FISSIVE                      <span class="string">'growth'</span>
1563                 <span class="string">'Term Org'</span>       SingleGeneDeletions.NO_TERMINAL_ORGANELLE            <span class="string">'terminalOrganelleWt'</span>
1564                 <span class="string">'Damaged'</span>        SingleGeneDeletions.TOXIN_ACCUMULATION               <span class="string">'damagedProteins'</span>
1565                 <span class="string">'Slow'</span>           SingleGeneDeletions.SLOW_GROWING                     <span class="string">'rnaWt'</span>
1566                 <span class="string">'Non-Ess'</span>        SingleGeneDeletions.NON_ESSENTIAL                    <span class="string">'growth'</span>
1567                 };
1568             propLabels = {
1569                 {<span class="string">'NTP'</span>}                 <span class="string">'ntps'</span>
1570                 {<span class="string">'Growth (fg h^{-1})'</span>}  <span class="string">'growth'</span>
1571                 {<span class="string">'Protein (fg)'</span>}        <span class="string">'proteinWt'</span>
1572                 {<span class="string">'RNA (fg)'</span>}            <span class="string">'rnaWt'</span>
1573                 {<span class="string">'DNA (fg)'</span>}            <span class="string">'dnaWt'</span>
1574                 {<span class="string">'Septum (nm)'</span>}         <span class="string">'pinchedDiameter'</span>
1575                 {<span class="string">'Term Org (fg)'</span>}       <span class="string">'terminalOrganelleWt'</span>
1576                 {<span class="string">'Damaged'</span> <span class="string">'Prot'</span>}      <span class="string">'damagedProteins'</span>
1577                 };
1578             
1579             gridData = NaN(nProps, nCats, nTime);
1580             gridMetaData = repmat(struct(<span class="string">'nSimulations'</span>, [], <span class="string">'nGenes'</span>, [], <span class="string">'gene'</span>, [], <span class="string">'simGroup'</span>, [], <span class="string">'simIdx'</span>, []), nCats, 1);
1581             <span class="keyword">for</span> i = iJob:nJobs:nCats
1582                 <span class="keyword">if</span> exist([baseDir <span class="string">'overview-'</span> catLabels{i, 1} <span class="string">'.mat'</span>], <span class="string">'file'</span>)
1583                     load([baseDir <span class="string">'overview-'</span> catLabels{i, 1} <span class="string">'.mat'</span>]);
1584                 <span class="keyword">else</span>
1585                     <span class="comment">%get data for all simulations in category</span>
1586                     <span class="keyword">if</span> catLabels{i, 2} == SingleGeneDeletions.WILD_TYPE
1587                         tmp2 = load([baseDir <span class="string">'WT.mat'</span>], <span class="string">'metaData'</span>, <span class="string">'simEndTimes'</span>, <span class="string">'ntps'</span>, <span class="string">'growth'</span>, <span class="string">'rnaWt'</span>, <span class="string">'proteinWt'</span>, <span class="string">'dnaWt'</span>, <span class="string">'pinchedDiameter'</span>, <span class="string">'terminalOrganelleWt'</span>, <span class="string">'damagedProteins'</span>);
1588                         tmp = tmp2.growth(sub2ind(size(tmp2.growth), tmp2.simEndTimes, (1:numel(tmp2.simEndTimes))'));
1589                         <span class="keyword">for</span> k = 1:nProps
1590                             <span class="keyword">for</span> l = 1:numel(tmp2.simEndTimes)
1591                                 <span class="keyword">if</span> isnan(tmp(l)) || ~isfield(tmp2, propLabels{k, 2}) || any(isnan(tmp2.(propLabels{k, 2})(2:tmp2.simEndTimes(l), l)))
1592                                     tmp(l) = NaN;
1593                                 <span class="keyword">end</span>
1594                             <span class="keyword">end</span>
1595                         <span class="keyword">end</span>
1596                         [~, idx] = min(abs(tmp - nanmedian(tmp)));
1597                         
1598                         tmpMetaData = struct(<span class="keyword">...</span>
1599                             <span class="string">'nSimulations'</span>, numel(tmp), <span class="keyword">...</span>
1600                             <span class="string">'nGenes'</span>, [], <span class="keyword">...</span>
1601                             <span class="string">'gene'</span>, [], <span class="keyword">...</span>
1602                             <span class="string">'simGroup'</span>, tmp2.metaData(idx).simGroup, <span class="keyword">...</span>
1603                             <span class="string">'simIdx'</span>, tmp2.metaData(idx).simIdx);
1604                     <span class="keyword">else</span>
1605                         geneIdxs = find(geneClasses == catLabels{i, 2} &amp; isGeneImplemented);
1606                         
1607                         tmp = zeros(0, 1);
1608                         genes = zeros(0, 1);
1609                         simIdxs = zeros(0, 1);
1610                         <span class="keyword">for</span> j = 1:numel(geneIdxs)
1611                             tmp2 = load([baseDir g.wholeCellModelIDs{geneIdxs(j)} <span class="string">'.mat'</span>], <span class="string">'simEndTimes'</span>, catLabels{i, 3});
1612                             <span class="keyword">if</span> ~isfield(tmp2, catLabels{i, 3})
1613                                 <span class="keyword">continue</span>;
1614                             <span class="keyword">end</span>
1615                             tmp = [tmp; tmp2.(catLabels{i, 3})(sub2ind(size(tmp2.(catLabels{i, 3})), tmp2.simEndTimes, (1:numel(tmp2.simEndTimes))'))];
1616                             genes = [genes; repmat(geneIdxs(j), numel(tmp2.simEndTimes), 1)];
1617                             simIdxs = [simIdxs; (1:numel(tmp2.simEndTimes))'];
1618                         <span class="keyword">end</span>
1619                         
1620                         <span class="keyword">while</span> true
1621                             <span class="keyword">switch</span> catLabels{i, 2}
1622                                 <span class="keyword">case</span> SingleGeneDeletions.NO_TERMINAL_ORGANELLE
1623                                     [~, idx] = min(tmp);                                
1624                                 <span class="keyword">otherwise</span>
1625                                     [~, idx] = min(abs(tmp - nanmedian(tmp)));
1626                             <span class="keyword">end</span>
1627                             tmp2 = load([baseDir g.wholeCellModelIDs{genes(idx)} <span class="string">'.mat'</span>], <span class="string">'metaData'</span>, <span class="string">'simEndTimes'</span>, propLabels{:, 2});
1628                             
1629                             <span class="keyword">if</span> ~all(ismember(propLabels(:, 2), fieldnames(tmp2)))
1630                                 tmp(idx) = NaN;
1631                             <span class="keyword">end</span>
1632                             <span class="keyword">for</span> k = 1:nProps
1633                                 <span class="keyword">if</span> ~isfield(tmp2, propLabels{k, 2}) || any(isnan(tmp2.(propLabels{k, 2})(2:tmp2.simEndTimes(simIdxs(idx)), simIdxs(idx))))
1634                                     tmp(idx) = NaN;
1635                                 <span class="keyword">end</span>
1636                             <span class="keyword">end</span>
1637                             
1638                             <span class="keyword">if</span> catLabels{i, 2} == SingleGeneDeletions.NON_FISSIVE &amp;&amp; (<span class="keyword">...</span>
1639                                     isnan(range(tmp2.dnaWt(:, simIdxs(idx)))) || ~range(tmp2.dnaWt(:, simIdxs(idx))) || <span class="keyword">...</span>
1640                                     isnan(tmp2.rnaWt(end-4*3600, simIdxs(idx))) || tmp2.rnaWt(<span class="keyword">end</span>, simIdxs(idx)) &lt; tmp2.rnaWt(end-4*3600, simIdxs(idx)))
1641                                 tmp(idx) = NaN;
1642                             <span class="keyword">end</span>
1643                             
1644                             <span class="keyword">if</span> ~isnan(tmp(idx))
1645                                 <span class="keyword">break</span>;
1646                             <span class="keyword">end</span>
1647                         <span class="keyword">end</span>
1648                         
1649                         tmpMetaData = struct(<span class="keyword">...</span>
1650                             <span class="string">'nSimulations'</span>, numel(tmp), <span class="keyword">...</span>
1651                             <span class="string">'nGenes'</span>, numel(geneIdxs), <span class="keyword">...</span>
1652                             <span class="string">'gene'</span>, g.wholeCellModelIDs{genes(idx)}, <span class="keyword">...</span>
1653                             <span class="string">'simGroup'</span>, tmp2.metaData(simIdxs(idx)).simGroup, <span class="keyword">...</span>
1654                             <span class="string">'simIdx'</span>, tmp2.metaData(simIdxs(idx)).simIdx);
1655                         
1656                         idx = simIdxs(idx);
1657                     <span class="keyword">end</span>
1658                     
1659                     <span class="comment">%get data for representative cell</span>
1660                     tmpData = struct;
1661                     <span class="keyword">for</span> k = 1:nProps
1662                         tmpData.(propLabels{k, 2}) = tmp2.(propLabels{k, 2})(:, idx);
1663                     <span class="keyword">end</span>
1664                     
1665                     <span class="comment">%save</span>
1666                     save([baseDir <span class="string">'overview-'</span> catLabels{i, 1} <span class="string">'.mat'</span>], <span class="string">'tmpMetaData'</span>, <span class="string">'tmpData'</span>);
1667                     
1668                     <span class="comment">%cleanup</span>
1669                     clear tmp2;
1670                 <span class="keyword">end</span>
1671                 
1672                 gridMetaData(i) = tmpMetaData;
1673                 <span class="keyword">for</span> j = 1:nProps
1674                     gridData(j, i, 1:numel(tmpData.(propLabels{j, 2}))) = tmpData.(propLabels{j, 2});
1675                 <span class="keyword">end</span>
1676             <span class="keyword">end</span>
1677         <span class="keyword">end</span>
1678     <span class="keyword">end</span>
1679     
1680     <span class="comment">%metabolic simulations of single gene deletions</span>
1681     methods (Static)
1682         <a name="_sub14" href="#_subfunctions" class="code">function [deletionMetabolicOutputs, wtMetabolicOutput] = calculateSingleGeneDeletionMetabolicOutputs(sim)</a>
1683             <span class="comment">%constants</span>
1684             g = sim.gene;
1685             comp = sim.compartment;
1686             met = sim.process(<span class="string">'Metabolism'</span>);
1687             nGenes = size(g.wholeCellModelIDs, 1);
1688             ntpIdxs = met.substrateIndexs({<span class="string">'ATP'</span>; <span class="string">'GTP'</span>});
1689             energyProductionRxnIdxs = met.fbaReactionIndexs_metaboliteInternalExchange(<span class="keyword">...</span>
1690                 ismember(<span class="keyword">...</span>
1691                 met.substrateIndexs_internalExchangedMetabolites, <span class="keyword">...</span>
1692                 sub2ind(size(met.substrates), ntpIdxs, repmat(comp.cytosolIndexs, size(ntpIdxs))) <span class="keyword">...</span>
1693                 ) <span class="keyword">...</span>
1694                 );
1695             
1696             <span class="comment">%setup substrates so that NMPs, NDPs are available to be</span>
1697             <span class="comment">%recycled and energy can be produced</span>
1698             sim.initializeState();
1699             
1700             <span class="comment">%calculate wild-type metabolic output: growth rate and energy</span>
1701             <span class="comment">%production</span>
1702             wtMetabolicOutput = zeros(1, 3);
1703             [wtMetabolicOutput(1, 1), ~, fbaReactionFluxs] = met.calcGrowthRate(met.calcFluxBounds(met.substrates, met.enzymes, met.fbaReactionBounds, met.fbaEnzymeBounds));
1704             wtMetabolicOutput(1, 2:3) = fbaReactionFluxs(energyProductionRxnIdxs);
1705             
1706             <span class="comment">%calculate single gene deletion metabolic output: growth rate</span>
1707             <span class="comment">%and energy production</span>
1708             deletionMetabolicOutputs = zeros(nGenes,3);
1709             deletionMetabolicOutputs(~any(met.enzymeGeneComposition, 2) &amp; ~any(met.substrateGeneComposition, 2), :) = NaN;
1710             enzGeneComp = met.enzymeGeneComposition();
1711             subGeneComp = met.substrateGeneComposition();
1712             <span class="keyword">for</span> i = 1:nGenes
1713                 enzIdxs = find(enzGeneComp(i, :));
1714                 subIdxs = find(subGeneComp(i, :));
1715                 <span class="keyword">if</span> isempty(enzIdxs) &amp;&amp; isempty(subIdxs)
1716                     <span class="keyword">continue</span>;
1717                 <span class="keyword">end</span>
1718                 
1719                 enzymes = met.enzymes;
1720                 substrates = met.substrates;
1721                 enzymes(enzIdxs, :) = 0;
1722                 substrates(subIdxs, :) = 0;
1723                 [deletionMetabolicOutputs(i, 1), ~, fbaReactionFluxs] = met.calcGrowthRate(met.calcFluxBounds(substrates, enzymes, met.fbaReactionBounds, met.fbaEnzymeBounds));
1724                 deletionMetabolicOutputs(i, 2:3) = fbaReactionFluxs(energyProductionRxnIdxs);
1725             <span class="keyword">end</span>
1726         <span class="keyword">end</span>
1727     <span class="keyword">end</span>
1728     
1729     <span class="comment">%summary of all single gene deletion strains and simulations</span>
1730     methods (Static)
1731         <a name="_sub15" href="#_subfunctions" class="code">function [content, colLabels] = printSingleGeneDeletionStrains(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses)</a>
1732             <span class="comment">%import classes</span>
1733             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
1734             import edu.stanford.covert.cell.sim.Simulation;
1735             import edu.stanford.covert.util.ConstantUtil;
1736             
1737             g = sim.gene;
1738             rna = sim.state(<span class="string">'Rna'</span>);
1739             [~, geneImplementedMolecules, geneImplementedProcesses] = SingleGeneDeletions.getGeneImplementations(sim);
1740             geneImplementedMolecules = cellfun(@(molecules) strjoin(<span class="string">', '</span>, molecules{:}), geneImplementedMolecules, <span class="string">'UniformOutput'</span>, false);
1741             geneImplementedProcesses = cellfun(@(processes) strjoin(<span class="string">', '</span>, processes{:}), geneImplementedProcesses, <span class="string">'UniformOutput'</span>, false);
1742             
1743             colLabels = {
1744                 <span class="string">'Gene'</span>
1745                 <span class="string">'Name'</span>
1746                 <span class="string">'Transcription Unit'</span>
1747                 <span class="string">'Transcription Unit Name'</span>
1748                 <span class="string">'Implementation Molecule'</span>
1749                 <span class="string">'Implementation Process'</span>
1750                 <span class="string">'Model Class'</span>
1751                 <span class="string">'Model Essentiality'</span>
1752                 <span class="string">'Mean Model Growth (fg h^-1)'</span>
1753                 <span class="string">'Std Model Growth (fg h^-1)'</span>
1754                 <span class="string">'Mean Model ATP Production (molecules s^-1)'</span>
1755                 <span class="string">'Std Model ATP Production (molecules s^-1)'</span>
1756                 <span class="string">'Mean Model GTP Production (molecules s^-1)'</span>
1757                 <span class="string">'Std Model GTP Production (molecules s^-1)'</span>
1758                 <span class="string">'Mean Model Replication Initiation Duration (h)'</span>
1759                 <span class="string">'Std Model Replication Initiation Duration (h)'</span>
1760                 <span class="string">'Mean Model Replication Duration (h)'</span>
1761                 <span class="string">'Std Model Replication Duration (h)'</span>
1762                 <span class="string">'Mean Model Cytokinesis Duration (h)'</span>
1763                 <span class="string">'Std Model Cytokinesis Duration (h)'</span>
1764                 <span class="string">'Mean Model Cell Cycle Duration (h)'</span>
1765                 <span class="string">'Std Model Cell Cycle Duration (h)'</span>
1766                 <span class="string">'Mean Model Mass Doubling Duration (h)'</span>
1767                 <span class="string">'Std Model Mass Doubling Duration (h)'</span>
1768                 <span class="string">'Mean Cumulative ATP Usage (molecules)'</span>
1769                 <span class="string">'Std Cumulative ATP Usage (molecules)'</span>
1770                 <span class="string">'Mean Cumulative GTP Usage (molecules)'</span>
1771                 <span class="string">'Std Cumulative GTP Usage (molecules)'</span>
1772                 <span class="string">'Mean Cell Weight Fraction DNA (%)'</span>
1773                 <span class="string">'Std Cell Weight Fraction DNA (%)'</span>
1774                 <span class="string">'Mean Cell Weight Fraction RNA (%)'</span>
1775                 <span class="string">'Std Cell Weight Fraction RNA (%)'</span>
1776                 <span class="string">'Mean Cell Weight Fraction Protein (%)'</span>
1777                 <span class="string">'Std Cell Weight Fraction Protein (%)'</span>
1778                 <span class="string">'Mean Superhelicity'</span>
1779                 <span class="string">'Std Superhelicity'</span>
1780                 <span class="string">'Mean Exponential Rate RNA growth (h^-1)'</span>
1781                 <span class="string">'Std Exponential Rate RNA growth (h^-1)'</span>
1782                 <span class="string">'Mean Exponential Rate Protein growth (h^-1)'</span>
1783                 <span class="string">'Std Exponential Rate Protein growth (h^-1)'</span>
1784                 <span class="string">'Mean Exponential Rate Damaged RNA growth (h^-1)'</span>
1785                 <span class="string">'Std Exponential Rate Damaged RNA growth (h^-1)'</span>
1786                 <span class="string">'Mean Exponential Rate Damaged Protein growth (h^-1)'</span>
1787                 <span class="string">'Std Exponential Rate Damaged Protein growth (h^-1)'</span>
1788                 <span class="string">'Mean Antibiotics (molecules)'</span>
1789                 <span class="string">'Std Antibiotics (molecules)'</span>
1790                 <span class="string">'FBA Growth (fg h^-1)'</span>
1791                 <span class="string">'FBA ATP Production (molecules s^-1)'</span>
1792                 <span class="string">'FBA GTP Production (molecules s^-1)'</span>
1793                 <span class="string">'Mean Experimental Mass Doubling Time (h)'</span>
1794                 <span class="string">'Std Experimental Mass Doubling Time (h)'</span>
1795                 <span class="string">'Experimental No. Replicates'</span>
1796                 <span class="string">'FBA Essentiality'</span>
1797                 <span class="string">'Experiment Essentiality'</span>
1798                 <span class="string">'Model Agree'</span>
1799                 <span class="string">'FBA Agree'</span>
1800                 }';
1801             content = cell(0, numel(colLabels));
1802             
1803             <span class="comment">%content</span>
1804             deletionGrowthRates = deletionMetabolicOutputs(:, 1);
1805             wtGrowthRate = wtMetabolicOutput(:, 1);
1806             deletionEnergyProductions = deletionMetabolicOutputs(:, 2:3);
1807             wtEnergyProduction = wtMetabolicOutput(:, 2:3);
1808             
1809             [deletionDoublingTimesExperimental, wtDoublingTimeExperimental] = SingleGeneDeletions.getExperimentalDoublingTimes();
1810             wtGrowthRateExperimental = log(2) ./ wtDoublingTimeExperimental(:, 1);
1811             deletionGrowthRatesExperimental = wtGrowthRateExperimental * (~ismember(g.essential, {<span class="string">'Y'</span>, <span class="string">''</span>}));
1812             essThresh = 0.2 * wtGrowthRateExperimental;
1813             
1814             ynChar = {<span class="string">'N'</span>; <span class="string">'Y'</span>; <span class="string">''</span>};
1815             agStr = {<span class="string">'Correct'</span>; <span class="string">'False Essential'</span>; <span class="string">'False Non-Essential'</span>; <span class="string">'Not Predicted'</span>};
1816             
1817             modelEss = 2 * ones(size(deletionGrowthRates));
1818             modelEss(geneClasses == SingleGeneDeletions.NON_ESSENTIAL) = 1;
1819             modelEss(geneClasses == SingleGeneDeletions.UNOBSERVED) = 3;
1820             
1821             fbaEss = ones(size(deletionGrowthRates));
1822             fbaEss(deletionGrowthRates &gt;= essThresh) = 1;
1823             fbaEss(deletionGrowthRates &lt; essThresh) = 2;
1824             fbaEss(isnan(deletionGrowthRates)) = 3;
1825             
1826             expEss = ones(size(deletionGrowthRatesExperimental));
1827             expEss(deletionGrowthRatesExperimental &gt;= essThresh) = 1;
1828             expEss(deletionGrowthRatesExperimental &lt; essThresh) = 2;
1829             expEss(isnan(deletionGrowthRatesExperimental)) = 3;
1830             
1831             modelAgrees = ones(size(deletionGrowthRates));
1832             modelAgrees(((geneClasses == SingleGeneDeletions.NON_ESSENTIAL) == (deletionGrowthRatesExperimental &gt; essThresh))) = 1;
1833             modelAgrees(((geneClasses ~= SingleGeneDeletions.NON_ESSENTIAL) &amp; (deletionGrowthRatesExperimental &gt; essThresh))) = 2;
1834             modelAgrees(((geneClasses == SingleGeneDeletions.NON_ESSENTIAL) &amp; (deletionGrowthRatesExperimental &lt; essThresh))) = 3;
1835             modelAgrees(geneClasses == SingleGeneDeletions.UNOBSERVED) = 4;
1836             
1837             fbaAgrees = ones(size(deletionGrowthRates));
1838             fbaAgrees(((deletionGrowthRates &gt; essThresh) == (deletionGrowthRatesExperimental &gt; essThresh))) = 1;
1839             fbaAgrees(((deletionGrowthRates &lt; essThresh) &amp; (deletionGrowthRatesExperimental &gt; essThresh))) = 2;
1840             fbaAgrees(((deletionGrowthRates &gt; essThresh) &amp; (deletionGrowthRatesExperimental &lt; essThresh))) = 3;
1841             fbaAgrees(isnan(deletionGrowthRates)) = 4;
1842             
1843             geneClassNames = cell(size(geneClasses));
1844             <span class="keyword">for</span> i = 1:size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1)
1845                 geneClassNames(geneClasses == i) = SingleGeneDeletions.DELETION_STRAIN_CLASSES(i);
1846             <span class="keyword">end</span>
1847             wtGrowthRate = wtGrowthRate * 3600 * sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight) * 1e15;
1848             deletionGrowthRates = deletionGrowthRates * 3600 * sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight) * 1e15;
1849             
1850             content = [content; {
1851                 <span class="string">'WT'</span> <span class="keyword">...</span>
1852                 <span class="string">'Wild-type'</span> <span class="keyword">...</span>
1853                 <span class="string">''</span> <span class="keyword">...</span>
1854                 <span class="string">''</span> <span class="keyword">...</span>
1855                 <span class="string">''</span> <span class="keyword">...</span>
1856                 <span class="string">''</span> <span class="keyword">...</span>
1857                 <span class="string">'Wild-type'</span> <span class="keyword">...</span>
1858                 <span class="string">''</span> <span class="keyword">...</span>
1859                 } <span class="keyword">...</span>
1860                 num2cell(reshape(permute(wtStats, [3 2 1]), [], size(wtStats, 1))') <span class="keyword">...</span>
1861                 num2cell(wtGrowthRate) <span class="keyword">...</span>
1862                 num2cell(wtEnergyProduction) <span class="keyword">...</span>
1863                 num2cell(wtDoublingTimeExperimental) <span class="keyword">...</span>
1864                 { <span class="keyword">...</span>
1865                 <span class="string">''</span> <span class="keyword">...</span>
1866                 <span class="string">''</span> <span class="keyword">...</span>
1867                 <span class="string">''</span> <span class="keyword">...</span>
1868                 <span class="string">''</span> <span class="keyword">...</span>
1869                 }];
1870             
1871             [i, j] = find(rna.nascentRNAGeneComposition);
1872             tuIDs = cell(size(g.wholeCellModelIDs));
1873             tuNames = cell(size(g.wholeCellModelIDs));
1874             tuIDs(i) = rna.wholeCellModelIDs(rna.nascentIndexs(j));
1875             tuNames(i) = rna.names(rna.nascentIndexs(j));
1876             
1877             content = [content;
1878                 g.wholeCellModelIDs <span class="keyword">...</span>
1879                 g.names <span class="keyword">...</span>
1880                 tuIDs <span class="keyword">...</span>
1881                 tuNames <span class="keyword">...</span>
1882                 geneImplementedMolecules <span class="keyword">...</span>
1883                 geneImplementedProcesses <span class="keyword">...</span>
1884                 geneClassNames <span class="keyword">...</span>
1885                 ynChar(modelEss) <span class="keyword">...</span>
1886                 num2cell(reshape(permute(deletionStats, [3 2 1]), [], size(deletionStats, 1))') <span class="keyword">...</span>
1887                 num2cell(deletionGrowthRates) <span class="keyword">...</span>
1888                 num2cell(deletionEnergyProductions) <span class="keyword">...</span>
1889                 num2cell(deletionDoublingTimesExperimental) <span class="keyword">...</span>
1890                 ynChar(fbaEss)  <span class="keyword">...</span>
1891                 ynChar(expEss) <span class="keyword">...</span>
1892                 agStr(modelAgrees) <span class="keyword">...</span>
1893                 agStr(fbaAgrees)
1894                 ];
1895             content(cellfun(@(x) ~isempty(x) &amp;&amp; all(isnumeric(x)) &amp;&amp; all(isnan(x)), content)) = {[]};
1896         <span class="keyword">end</span>
1897         
1898         <a name="_sub16" href="#_subfunctions" class="code">function [content, colLabels] = printSingleGeneDeletionStrainClasses(sim, geneClasses)</a>
1899             <span class="comment">%import classes</span>
1900             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
1901             import edu.stanford.covert.cell.sim.Simulation;
1902             import edu.stanford.covert.util.ConstantUtil;
1903             
1904             <span class="comment">%constants</span>
1905             g = sim.gene;
1906             isGeneImplemented = SingleGeneDeletions.getGeneImplementations(sim);
1907             
1908             <span class="comment">%content</span>
1909             expEss = ismember(g.essential, {<span class="string">'Y'</span>, <span class="string">''</span>});
1910             modelEss = geneClasses ~= SingleGeneDeletions.NON_ESSENTIAL;
1911             
1912             <span class="comment">%overall p-value versus random model of implemented genes. that</span>
1913             <span class="comment">%is p-value that model isn't random model which</span>
1914             <span class="comment">%- Randomly guesses that implemented genes are essential with</span>
1915             <span class="comment">%  probability = sum(tfModelEss &amp; tfImplemented) / nImplemented</span>
1916             <span class="comment">%- Deterministically reports that all non-implemented genes are</span>
1917             <span class="comment">%  non-essential</span>
1918             nImplemented = sum(isGeneImplemented);
1919             nCorrectImplemented = sum(modelEss == expEss &amp; isGeneImplemented);
1920             pCorrectGivenImplemented = <span class="keyword">...</span>
1921                 + sum( modelEss &amp; isGeneImplemented) / nImplemented * sum( expEss &amp; isGeneImplemented) / nImplemented  <span class="keyword">...</span>
1922                 + sum(~modelEss &amp; isGeneImplemented) / nImplemented * sum(~expEss &amp; isGeneImplemented) / nImplemented;
1923             totalPValue = 1 - binocdf(nCorrectImplemented - 1, nImplemented, pCorrectGivenImplemented);
1924             
1925             <span class="comment">%ROC analysis</span>
1926             rocAnalysis = zeros(size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1), 15);
1927             pValues = zeros(size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1), 1);
1928             <span class="keyword">for</span> i = 1:size(SingleGeneDeletions.DELETION_STRAIN_CLASSES, 1)
1929                 tfs = geneClasses == i;
1930                 rocAnalysis(i, 1) = sum(tfs);
1931                 rocAnalysis(i, 2:5) = sum([
1932                     modelEss(tfs) &amp;  expEss(tfs) <span class="keyword">...</span>
1933                     ~modelEss(tfs) &amp; ~expEss(tfs) <span class="keyword">...</span>
1934                     modelEss(tfs) &amp; ~expEss(tfs) <span class="keyword">...</span>
1935                     ~modelEss(tfs) &amp;  expEss(tfs) <span class="keyword">...</span>
1936                     ], 1);
1937                 
1938                 tfs = geneClasses == i  &amp;  isGeneImplemented;
1939                 rocAnalysis(i, 6) = sum(tfs);
1940                 rocAnalysis(i, 7:10) = sum([
1941                     modelEss(tfs) &amp;  expEss(tfs) <span class="keyword">...</span>
1942                     ~modelEss(tfs) &amp; ~expEss(tfs) <span class="keyword">...</span>
1943                     modelEss(tfs) &amp; ~expEss(tfs) <span class="keyword">...</span>
1944                     ~modelEss(tfs) &amp;  expEss(tfs) <span class="keyword">...</span>
1945                     ], 1);
1946                 
1947                 tfs = geneClasses == i  &amp;  ~isGeneImplemented;
1948                 rocAnalysis(i, 11) = sum(tfs);
1949                 rocAnalysis(i, 12:15) = sum([
1950                     modelEss(tfs) &amp;  expEss(tfs) <span class="keyword">...</span>
1951                     ~modelEss(tfs) &amp; ~expEss(tfs) <span class="keyword">...</span>
1952                     modelEss(tfs) &amp; ~expEss(tfs) <span class="keyword">...</span>
1953                     ~modelEss(tfs) &amp;  expEss(tfs) <span class="keyword">...</span>
1954                     ], 1);
1955                 
1956                 <span class="comment">% p-value versus random model of implemented genes</span>
1957                 tfs = geneClasses == i  &amp;  isGeneImplemented;
1958                 nImplemented = sum(isGeneImplemented(tfs));
1959                 nCorrectImplemented = sum(modelEss(tfs) == expEss(tfs) &amp; isGeneImplemented(tfs));
1960                 <span class="keyword">if</span> nImplemented == 0
1961                     pValues(i) = NaN;
1962                 <span class="keyword">else</span>
1963                     pValues(i) = 1 - binocdf(nCorrectImplemented - 1, nImplemented, pCorrectGivenImplemented);
1964                 <span class="keyword">end</span>
1965             <span class="keyword">end</span>
1966             
1967             <span class="comment">%format output</span>
1968             colLabels = {
1969                 <span class="string">'Class'</span>  <span class="keyword">...</span>
1970                 <span class="string">'Total-Count'</span>  <span class="string">'Total-True Essential'</span>  <span class="string">'Total-True Non-Essential'</span>  <span class="string">'Total-False Essential'</span>  <span class="string">'Total-False Non-Essential'</span> <span class="keyword">...</span>
1971                 <span class="string">'Implemented-Count'</span>  <span class="string">'Implemented-True Essential'</span>  <span class="string">'Implemented-True Non-Essential'</span>  <span class="string">'Implemented-False Essential'</span>  <span class="string">'Implemented-False Non-Essential'</span> <span class="keyword">...</span>
1972                 <span class="string">'Unimplemented-Count'</span>  <span class="string">'Unimplemented-True Essential'</span>  <span class="string">'Unimplemented-True Non-Essential'</span>  <span class="string">'Unimplemented-False Essential'</span>  <span class="string">'Unimplemented-False Non-Essential'</span> <span class="keyword">...</span>
1973                 <span class="string">'p-Value'</span> <span class="keyword">...</span>
1974                 };
1975             content = [
1976                 SingleGeneDeletions.DELETION_STRAIN_CLASSES(1:end-1, 1)  num2cell([rocAnalysis(1:end-1, 1)     rocAnalysis(1:end-1, 2:5) ./ rocAnalysis(1:end-1, ones(4, 1))   rocAnalysis(1:end-1, 6)     rocAnalysis(1:end-1, 7:10) ./ rocAnalysis(1:end-1, 6*ones(4, 1))    rocAnalysis(1:end-1, 11)     rocAnalysis(1:end-1, 12:15) ./ rocAnalysis(1:end-1, 11*ones(4, 1))  pValues(1:end-1, :)])
1977                 <span class="string">'Total'</span>                                                  num2cell([sum(rocAnalysis(:, 1), 1)   sum(rocAnalysis(:, 2:5), 1) / sum(rocAnalysis(:, 1), 1)         sum(rocAnalysis(:, 6), 1)   sum(rocAnalysis(:, 7:10), 1) / sum(rocAnalysis(:, 6), 1)            sum(rocAnalysis(:, 11), 1)   sum(rocAnalysis(:, 12:15), 1) / sum(rocAnalysis(:, 11), 1)          totalPValue])
1978                 ];
1979             content(cellfun(@(el) any(isnan(el)), content)) = {[]};
1980         <span class="keyword">end</span>
1981         
1982         <a name="_sub17" href="#_subfunctions" class="code">function plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)</a>
1983             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
1984             import edu.stanford.covert.cell.sim.util.PlotUtil;
1985             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
1986             
1987             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
1988             
1989             <span class="comment">%categories, IDs</span>
1990             [content, colLabels] = SingleGeneDeletions.printSingleGeneDeletionStrains(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses);
1991             geneIDs = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'Gene'</span>));
1992             geneCats = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'Model Agree'</span>));
1993             geneProcesses = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'Implementation Process'</span>));
1994             wtGrowthRateModel = cell2mat(content(1, ismember(colLabels, <span class="string">'FBA Growth (fg h^-1)'</span>)));
1995             wtDoublingTimeModel = cell2mat(content(1, ismember(colLabels, <span class="string">'Mean Model Mass Doubling Duration (h)'</span>)));
1996             wtCellCycleTimeModel = cell2mat(content(1, ismember(colLabels, <span class="string">'Mean Model Cell Cycle Duration (h)'</span>)));
1997             wtDoublingTimeExp = cell2mat(content(1, ismember(colLabels, <span class="string">'Mean Experimental Mass Doubling Time (h)'</span>)));
1998             geneGrowthRatesModel = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'FBA Growth (fg h^-1)'</span>));
1999             geneDoublingTimesModel = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'Mean Model Mass Doubling Duration (h)'</span>));
2000             geneCellCycleTimesModel = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'Mean Model Cell Cycle Duration (h)'</span>));
2001             geneDoublingTimesExp = content(2:<span class="keyword">end</span>, ismember(colLabels, <span class="string">'Mean Experimental Mass Doubling Time (h)'</span>));
2002             
2003             geneGrowthRatesModel(cellfun(@isempty, geneGrowthRatesModel)) = {NaN};
2004             geneDoublingTimesModel(cellfun(@isempty, geneDoublingTimesModel)) = {NaN};
2005             geneCellCycleTimesModel(cellfun(@isempty, geneCellCycleTimesModel)) = {NaN};
2006             geneDoublingTimesExp(cellfun(@isempty, geneDoublingTimesExp)) = {NaN};
2007             
2008             geneGrowthRatesModel = cell2mat(geneGrowthRatesModel);
2009             geneDoublingTimesModel = cell2mat(geneDoublingTimesModel);
2010             geneCellCycleTimesModel = cell2mat(geneCellCycleTimesModel);
2011             geneDoublingTimesExp = cell2mat(geneDoublingTimesExp);
2012             
2013             geneTfsModelImputed = isnan(geneDoublingTimesModel) &amp; ~isnan(geneGrowthRatesModel);
2014             geneDoublingTimesModel(isnan(geneDoublingTimesModel)) = wtDoublingTimeModel * <span class="keyword">...</span>
2015                 wtGrowthRateModel ./ geneGrowthRatesModel(isnan(geneDoublingTimesModel));
2016             geneCellCycleTimesModel(isnan(geneCellCycleTimesModel)) = wtCellCycleTimeModel * <span class="keyword">...</span>
2017                 wtGrowthRateModel ./ geneGrowthRatesModel(isnan(geneCellCycleTimesModel));
2018             
2019             <span class="comment">%sort</span>
2020             geneCats(cellfun(@isempty, geneProcesses)) = {<span class="string">'Uncharacterized'</span>};
2021             [~, idxs] = sort(geneCats);
2022             geneIDs = geneIDs(idxs);
2023             geneCats = geneCats(idxs);
2024             
2025             <span class="comment">%write svg grid</span>
2026             categories = unique([geneCats; {<span class="string">'Correct'</span>; <span class="string">'False Essential'</span>; <span class="string">'False Non-Essential'</span>; <span class="string">'Uncharacterized'</span>}]);
2027             colors = [
2028                 149 179 215
2029                 217 150 148
2030                 195 214 155
2031                 255 255 255];
2032             fid = fopen(fileName, <span class="string">'w'</span>);
2033             fwrite(fid, SingleGeneDeletions.plotGrid(categories, geneIDs, geneCats, 720, 450, 11, 16, colors));
2034             fclose(fid);
2035             
2036             <span class="comment">%% plot experimental observations vs model predictions</span>
2037             
2038             geneTfs = geneDoublingTimesModel &gt; 0 | geneDoublingTimesExp &gt; 0;
2039             geneTfsExpImputed = geneTfs &amp; geneDoublingTimesExp == wtDoublingTimeExp;
2040             geneTfsExpObserved = geneTfs &amp; ~geneTfsExpImputed;
2041             
2042             labels = {<span class="string">'Imputed'</span>, <span class="string">'Model Imputed'</span>, <span class="string">'Experiment Imputed'</span>, <span class="string">'Observed'</span>};
2043             
2044             <span class="comment">%doubling time vs doubling time</span>
2045             [axesHandle, figHandle] = PlotUtil.newAxesHandle();
2046             hold(axesHandle, <span class="string">'on'</span>);
2047             h = zeros(4, 1);
2048             <span class="keyword">if</span> any(geneTfsModelImputed &amp; geneTfsExpImputed)
2049                 h(1) = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(geneTfsModelImputed &amp; geneTfsExpImputed), geneDoublingTimesModel(geneTfsModelImputed &amp; geneTfsExpImputed), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, <span class="string">'r'</span>);
2050             <span class="keyword">end</span>
2051             <span class="keyword">if</span> any(geneTfsModelImputed &amp; geneTfsExpObserved)
2052                 h(2) = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(geneTfsModelImputed &amp; geneTfsExpObserved), geneDoublingTimesModel(geneTfsModelImputed &amp; geneTfsExpObserved), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, [0 0.5 0.5]);
2053             <span class="keyword">end</span>
2054             <span class="keyword">if</span> any(~geneTfsModelImputed &amp; geneTfsExpImputed)
2055                 h(3) = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(~geneTfsModelImputed &amp; geneTfsExpImputed), geneDoublingTimesModel(~geneTfsModelImputed &amp; geneTfsExpImputed), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, [0.5 0 0.5]);
2056             <span class="keyword">end</span>
2057             <span class="keyword">if</span> any(~geneTfsModelImputed &amp; geneTfsExpObserved)
2058                 h(4) = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(~geneTfsModelImputed &amp; geneTfsExpObserved), geneDoublingTimesModel(~geneTfsModelImputed &amp; geneTfsExpObserved), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, <span class="string">'b'</span>);
2059             <span class="keyword">end</span>
2060             labels = labels(h ~= 0);
2061             h = h(h ~= 0);
2062             legend(h(end:-1:1), labels(end:-1:1), <span class="string">'Location'</span>, <span class="string">'SouthEast'</span>);
2063             box(axesHandle, <span class="string">'on'</span>);
2064             xlim(axesHandle, [6 20]);
2065             ylim(axesHandle, [6 20]);
2066             xlabel(axesHandle, <span class="string">'Observed Mass Doubling Time (h)'</span>, <span class="string">'FontSize'</span>, 14);
2067             ylabel(axesHandle, <span class="string">'Predicted Mass Doubling Time (h)'</span>, <span class="string">'FontSize'</span>, 14);
2068             saveas(figHandle, [baseDir <span class="string">'ModelDoublingTimeVsExperimentDoublingTime.pdf'</span>]);
2069             close(figHandle);
2070             
2071             <span class="comment">%cell cycle length vs doubling time</span>
2072             [axesHandle, figHandle] = PlotUtil.newAxesHandle();
2073             hold(axesHandle, <span class="string">'on'</span>);
2074             h = zeros(4, 1);
2075             <span class="keyword">if</span> any(geneTfsModelImputed &amp; geneTfsExpImputed)
2076                 <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(geneTfsModelImputed &amp; geneTfsExpImputed), geneCellCycleTimesModel(geneTfsModelImputed &amp; geneTfsExpImputed), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, <span class="string">'r'</span>)
2077             <span class="keyword">end</span>
2078             <span class="keyword">if</span> any(geneTfsModelImputed &amp; geneTfsExpObserved)
2079                 <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(geneTfsModelImputed &amp; geneTfsExpObserved), geneCellCycleTimesModel(geneTfsModelImputed &amp; geneTfsExpObserved), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, [0 0.5 0.5])
2080             <span class="keyword">end</span>
2081             <span class="keyword">if</span> any(~geneTfsModelImputed &amp; geneTfsExpImputed)
2082                 <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(~geneTfsModelImputed &amp; geneTfsExpImputed), geneCellCycleTimesModel(~geneTfsModelImputed &amp; geneTfsExpImputed), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, [0.5 0 0.5])
2083             <span class="keyword">end</span>
2084             <span class="keyword">if</span> any(~geneTfsModelImputed &amp; geneTfsExpObserved)
2085                 <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, geneDoublingTimesExp(~geneTfsModelImputed &amp; geneTfsExpObserved), geneCellCycleTimesModel(~geneTfsModelImputed &amp; geneTfsExpObserved), <span class="string">'.'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'Color'</span>, <span class="string">'b'</span>)
2086             <span class="keyword">end</span>
2087             labels = labels(h ~= 0);
2088             h = h(h ~= 0);
2089             legend(h(end:-1:1), labels(end:-1:1), <span class="string">'Location'</span>, <span class="string">'SouthEast'</span>);
2090             box(axesHandle, <span class="string">'on'</span>);
2091             xlim(axesHandle, [6 20]);
2092             ylim(axesHandle, [6 20]);
2093             xlabel(axesHandle, <span class="string">'Observed Mass Doubling Time (h)'</span>, <span class="string">'FontSize'</span>, 14);
2094             ylabel(axesHandle, <span class="string">'Predicted Cell Cycle Length (h)'</span>, <span class="string">'FontSize'</span>, 14);
2095             saveas(figHandle, [baseDir <span class="string">'ModelCellCycleLengthVsExperimentDoublingTime.pdf'</span>]);
2096             close(figHandle);
2097         <span class="keyword">end</span>
2098         
2099         <a name="_sub18" href="#_subfunctions" class="code">function svg = plotGrid(categories, cellIDs, cellCats, width, height, gridFontSize, legendFontSize, colors)</a>
2100             <span class="comment">%layout grid</span>
2101             gridWidth = width - 220;
2102             area = gridWidth * height / numel(cellIDs);
2103             cols = ceil(gridWidth / sqrt(area));
2104             cellWidth = gridWidth / cols;
2105             cellHeight = cellWidth;
2106             rows = min(floor(height / cellHeight), ceil(numel(cellIDs) / cols));
2107             
2108             <span class="keyword">while</span> rows * cols &lt; numel(cellIDs)
2109                 cols = cols + 1;
2110                 cellWidth = gridWidth / cols;
2111                 cellHeight = cellWidth;
2112                 rows = min(floor(height / cellHeight), ceil(numel(cellIDs) / cols));
2113             <span class="keyword">end</span>
2114             
2115             <span class="comment">%grid</span>
2116             grid = [];
2117             grid = [grid sprintf(<span class="string">'\t&lt;g tansform=&quot;translate(0,0)&quot;&gt;\n'</span>)];
2118             <span class="keyword">for</span> i = 1:numel(cellIDs)
2119                 j = floor((i-1) / cols);
2120                 k = mod((i-1), cols);
2121                 category = regexprep(cellCats{i}, <span class="string">'\W'</span>, <span class="string">'_'</span>);
2122                 cellID = regexprep(regexprep(cellIDs{i}, <span class="string">'MG_*'</span>, <span class="string">''</span>), <span class="string">'rrnA'</span>, <span class="string">''</span>);
2123                 grid = [grid sprintf(<span class="string">'\t\t&lt;g transform=&quot;translate(%f,%f)&quot;&gt;&lt;rect transform=&quot;translate(%f,%f)&quot; width=&quot;%f&quot; height=&quot;%f&quot; class=&quot;%s&quot;/&gt;&lt;text transform=&quot;translate(%f,%f)&quot; class=&quot;grid %s&quot;&gt;%s&lt;/text&gt;&lt;/g&gt;\n'</span>, <span class="keyword">...</span>
2124                     k * cellWidth, j * cellHeight, 0, 0, cellWidth, cellHeight, category, cellWidth / 2, cellHeight / 2 + 0.4 * gridFontSize, category, cellID)]; <span class="comment">%#ok&lt;*AGROW&gt;</span>
2125             <span class="keyword">end</span>
2126             grid = [grid sprintf(<span class="string">'\t&lt;/g&gt;'</span>)];
2127             
2128             <span class="comment">%styles, legend</span>
2129             styles = [];
2130             legend = sprintf(<span class="string">'\t&lt;g transform=&quot;translate(%f,%f)&quot;&gt;\n'</span>, cellWidth * cols + 10, 0);
2131             <span class="keyword">for</span> i = 1:numel(categories)
2132                 category = regexprep(categories{i}, <span class="string">'\W'</span>, <span class="string">'_'</span>);
2133                 r = colors(mod(i-1, size(colors, 1))+1, 1);
2134                 g = colors(mod(i-1, size(colors, 1))+1, 2);
2135                 b = colors(mod(i-1, size(colors, 1))+1, 3);
2136                 
2137                 cellCount = sum(strcmp(cellCats, categories{i}));
2138                 
2139                 <span class="keyword">if</span> mean(colors(i, :)) &lt; 255 / 2
2140                     textAlpha = 255;
2141                 <span class="keyword">else</span>
2142                     textAlpha = 0;
2143                 <span class="keyword">end</span>
2144                 styles = [styles sprintf(<span class="string">'\t\trect.%s{\n\t\t\tfill:rgb(%d,%d,%d);\n\t\t}\n'</span>, category, r, g, b)];
2145                 styles = [styles sprintf(<span class="string">'\t\ttext.%s{\n\t\t\tfill:rgb(%d,%d,%d);\n\t\t}\n'</span>, category, textAlpha, textAlpha, textAlpha)];
2146                 
2147                 legend = [legend sprintf(<span class="string">'\t\t&lt;g transform=&quot;translate(%f,%f)&quot;&gt;\n'</span>, <span class="keyword">...</span>
2148                     0, (i-1) * (legendFontSize * 1.5))];
2149                 legend = [legend sprintf(<span class="string">'\t\t\t&lt;rect transform=&quot;translate(%f,%f)&quot; width=&quot;%f&quot; height=&quot;%f&quot; class=&quot;%s grid legend&quot; /&gt;\n'</span>, <span class="keyword">...</span>
2150                     0, 0, legendFontSize, legendFontSize, category)];
2151                 legend = [legend sprintf(<span class="string">'\t\t\t&lt;text transform=&quot;translate(%f,%f)&quot; class=&quot;legend&quot;&gt;%s (%d)&lt;/text&gt;\n'</span>, <span class="keyword">...</span>
2152                     legendFontSize * 1.25, legendFontSize / 2 + 0.4 * legendFontSize, categories{i}, cellCount)];
2153                 legend = [legend sprintf(<span class="string">'\t\t&lt;/g&gt;\n'</span>)];
2154             <span class="keyword">end</span>
2155             legend = [legend sprintf(<span class="string">'\t&lt;/g&gt;\n'</span>)];
2156             
2157             <span class="comment">%grid lines</span>
2158             gridLines = [];
2159             gridLines = [gridLines sprintf(<span class="string">'\t&lt;g&gt;\n'</span>)];
2160             gridLines = [gridLines sprintf(<span class="string">'\t\t&lt;g&gt;\n'</span>)];
2161             <span class="keyword">for</span> i = 0:rows
2162                 <span class="keyword">if</span> i == rows
2163                     c = numel(cellIDs) - (rows - 1) * cols;
2164                 <span class="keyword">else</span>
2165                     c = cols;
2166                 <span class="keyword">end</span>
2167                 <span class="keyword">if</span> i == 0 || i == rows
2168                     style = <span class="string">'outter'</span>;
2169                 <span class="keyword">else</span>
2170                     style = <span class="string">'inner'</span>;
2171                 <span class="keyword">end</span>
2172                 gridLines = [gridLines sprintf(<span class="string">'\t\t\t&lt;line x1=&quot;%f&quot; y1=&quot;%f&quot; x2=&quot;%f&quot; y2=&quot;%f&quot; class=&quot;grid_%s&quot;/&gt;\n'</span>, 0, i * cellHeight, cellWidth * c, i * cellHeight, style)];
2173                 <span class="keyword">if</span> i == rows - 1 &amp;&amp; rows * cols ~= numel(cellIDs)
2174                     c = mod(numel(cellIDs), cols);
2175                     gridLines = [gridLines sprintf(<span class="string">'\t\t\t&lt;line x1=&quot;%f&quot; y1=&quot;%f&quot; x2=&quot;%f&quot; y2=&quot;%f&quot; class=&quot;grid_outter&quot;/&gt;\n'</span>, cellWidth * c, i * cellHeight, cellWidth * cols, i * cellHeight)];
2176                 <span class="keyword">end</span>
2177             <span class="keyword">end</span>
2178             
2179             gridLines = [gridLines sprintf(<span class="string">'\t\t&lt;/g&gt;\n'</span>)];
2180             gridLines = [gridLines sprintf(<span class="string">'\t\t&lt;g&gt;\n'</span>)];
2181             <span class="keyword">for</span> i = 0:cols
2182                 <span class="keyword">if</span> (rows - 1) * cols + i &gt; numel(cellIDs)
2183                     r = rows - 1;
2184                 <span class="keyword">else</span>
2185                     r = rows;
2186                 <span class="keyword">end</span>
2187                 <span class="keyword">if</span> i == 0 || i == cols
2188                     style = <span class="string">'outter'</span>;
2189                 <span class="keyword">else</span>
2190                     style = <span class="string">'inner'</span>;
2191                 <span class="keyword">end</span>
2192                 gridLines = [gridLines sprintf(<span class="string">'\t\t\t&lt;line x1=&quot;%f&quot; y1=&quot;%f&quot; x2=&quot;%f&quot; y2=&quot;%f&quot; class=&quot;grid_%s&quot;/&gt;\n'</span>, i * cellWidth, 0, i * cellWidth, cellHeight * r, style)];
2193                 <span class="keyword">if</span> (rows - 1) * cols + i == numel(cellIDs) &amp;&amp; rows * cols ~= numel(cellIDs)
2194                     gridLines = [gridLines sprintf(<span class="string">'\t\t\t&lt;line x1=&quot;%f&quot; y1=&quot;%f&quot; x2=&quot;%f&quot; y2=&quot;%f&quot; class=&quot;grid_outter&quot;/&gt;\n'</span>, i * cellWidth, cellHeight * (rows-1), i * cellWidth, cellHeight * rows)];
2195                 <span class="keyword">end</span>
2196             <span class="keyword">end</span>
2197             gridLines = [gridLines sprintf(<span class="string">'\t\t&lt;/g&gt;\n'</span>)];
2198             gridLines = [gridLines sprintf(<span class="string">'\t&lt;/g&gt;\n'</span>)];
2199             
2200             <span class="comment">%svg</span>
2201             svg = [];
2202             svg = [svg sprintf(<span class="string">'&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n'</span>)];
2203             svg = [svg sprintf(<span class="string">'&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;\n'</span>)];
2204             svg = [svg sprintf(<span class="string">'    viewBox=&quot;-1 -1 %d %d&quot; width=&quot;%d&quot; height=&quot;%d&quot;&gt;\n'</span>, width-1, height-1, width, height)];
2205             svg = [svg sprintf(<span class="string">'    &lt;style type=&quot;text/css&quot;&gt;\n'</span>)];
2206             svg = [svg sprintf(<span class="string">'        text{\n'</span>)];
2207             svg = [svg sprintf(<span class="string">'            font-family:Helvetica,Helvetica;\n'</span>)];
2208             svg = [svg sprintf(<span class="string">'            fill:rgb(0,0,0);\n'</span>)];
2209             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2210             svg = [svg sprintf(<span class="string">'        line.grid_outter{\n'</span>)];
2211             svg = [svg sprintf(<span class="string">'            stroke-width:2px;\n'</span>)];
2212             svg = [svg sprintf(<span class="string">'            stroke:rgb(0,0,0);\n'</span>)];
2213             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2214             svg = [svg sprintf(<span class="string">'        line.grid_inner{\n'</span>)];
2215             svg = [svg sprintf(<span class="string">'            stroke-width:0.5px;\n'</span>)];
2216             svg = [svg sprintf(<span class="string">'            stroke:rgb(0,0,0);\n'</span>)];
2217             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2218             svg = [svg sprintf(<span class="string">'        text.legend{\n'</span>)];
2219             svg = [svg sprintf(<span class="string">'            font-size:%dpx;\n'</span>, legendFontSize)];
2220             svg = [svg sprintf(<span class="string">'            text-anchor:start;\n'</span>)];
2221             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2222             svg = [svg sprintf(<span class="string">'        text.grid{\n'</span>)];
2223             svg = [svg sprintf(<span class="string">'            font-size:%dpx;\n'</span>, gridFontSize)];
2224             svg = [svg sprintf(<span class="string">'            text-anchor:middle;\n'</span>)];
2225             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2226             svg = [svg sprintf(<span class="string">'        rect{\n'</span>)];
2227             svg = [svg sprintf(<span class="string">'            fill:none;\n'</span>)];
2228             svg = [svg sprintf(<span class="string">'            stroke-width:0px;\n'</span>)];
2229             svg = [svg sprintf(<span class="string">'            stroke:none;\n'</span>)];
2230             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2231             svg = [svg sprintf(<span class="string">'        rect.legend{\n'</span>)];
2232             svg = [svg sprintf(<span class="string">'            stroke-width:2px;\n'</span>)];
2233             svg = [svg sprintf(<span class="string">'            stroke:rgb(0,0,0);\n'</span>)];
2234             svg = [svg sprintf(<span class="string">'        }\n'</span>)];
2235             svg = [svg sprintf(<span class="string">'%s\n'</span>, styles)];
2236             svg = [svg sprintf(<span class="string">'    &lt;/style&gt;\n\n'</span>)];
2237             svg = [svg sprintf(<span class="string">'&lt;!-- Grid --&gt;\n'</span>)];
2238             svg = [svg sprintf(<span class="string">'%s\n\n'</span>, grid)];
2239             svg = [svg sprintf(<span class="string">'&lt;!-- Grid lines --&gt;\n'</span>)];
2240             svg = [svg sprintf(<span class="string">'%s\n\n'</span>, gridLines)];
2241             svg = [svg sprintf(<span class="string">'&lt;!-- Legend --&gt;\n'</span>)];
2242             svg = [svg sprintf(<span class="string">'%s\n\n'</span>, legend)];
2243             svg = [svg sprintf(<span class="string">'&lt;/svg&gt;\n'</span>)];
2244         <span class="keyword">end</span>
2245     <span class="keyword">end</span>
2246     
2247     <span class="comment">%overview of each single gene deletion strain</span>
2248     methods (Static)
2249         <a name="_sub19" href="#_subfunctions" class="code">function [data, simMetaData, validSims] = getSimulationData(sim, simMetaData)</a>
2250             import edu.stanford.covert.cell.sim.util.PlotUtil;
2251             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
2252             import edu.stanford.covert.cell.sim.util.SimulationEnsemble;
2253             import edu.stanford.covert.cell.sim.util.SummaryLogger;
2254             
2255             nSims = numel(simMetaData);
2256             simEndTimes = [simMetaData.lengthSec]';
2257             simBatchIDs = {simMetaData.simGroup}';
2258             simBatchIdxs = [simMetaData.simIdx]';
2259             
2260             termOrgIdxs = [
2261                 sim.compartment.terminalOrganelleCytosolIndexs
2262                 sim.compartment.terminalOrganelleMembraneIndexs
2263                 ];
2264             
2265             <span class="comment">%% get data</span>
2266             nTimePoints = max(simEndTimes)+1;
2267             time = (0:nTimePoints-1)' / 3600;
2268             
2269             ensembleStateNames = {
2270                 <span class="string">'mass'</span>
2271                 <span class="string">'growth_rate'</span>
2272                 <span class="string">'ploidy'</span>
2273                 <span class="string">'superhelicity'</span>
2274                 <span class="string">'dntps'</span>
2275                 <span class="string">'ntps'</span>
2276                 <span class="string">'amino_acids'</span>
2277                 <span class="string">'antibiotics'</span>
2278                 <span class="string">'mrnas'</span>
2279                 <span class="string">'rrnas'</span>
2280                 <span class="string">'srnas'</span>
2281                 <span class="string">'trnas'</span>
2282                 <span class="string">'matureMonomers'</span>
2283                 <span class="string">'matureComplexs'</span>
2284                 <span class="string">'damagedRnas'</span>
2285                 <span class="string">'damagedProteins'</span>
2286                 <span class="string">'atpUsage'</span>
2287                 <span class="string">'gtpUsage'</span>
2288                 <span class="string">'atpProduction'</span>
2289                 <span class="string">'gtpProduction'</span>
2290                 <span class="string">'pinchedDiameter'</span>
2291                 };
2292             
2293             stateNames = {
2294                 <span class="string">'Mass'</span> <span class="string">'cell'</span>       <span class="string">':'</span>  <span class="string">':'</span>
2295                 <span class="string">'Mass'</span> <span class="string">'dnaWt'</span>      <span class="string">':'</span>  <span class="string">'-sum'</span>
2296                 <span class="string">'Mass'</span> <span class="string">'rnaWt'</span>      <span class="string">':'</span>  <span class="string">'-sum'</span>
2297                 <span class="string">'Mass'</span> <span class="string">'proteinWt'</span>  <span class="string">':'</span>  <span class="string">'-sum'</span>
2298                 <span class="string">'Geometry'</span> <span class="string">'totalLength'</span> <span class="string">':'</span> <span class="string">':'</span>
2299                 <span class="string">'Host'</span> <span class="string">'isBacteriumAdherent'</span> <span class="string">':'</span> <span class="string">':'</span>
2300                 };
2301             
2302             mass = NaN(nTimePoints, nSims);
2303             growth = NaN(nTimePoints, nSims);
2304             atpUsage = NaN(nTimePoints, nSims);
2305             gtpUsage = NaN(nTimePoints, nSims);
2306             atpProduction = NaN(nTimePoints, nSims);
2307             gtpProduction = NaN(nTimePoints, nSims);
2308             ploidy = NaN(nTimePoints, nSims);
2309             superhelicalDensity = NaN(nTimePoints, nSims);
2310             rnas = NaN(nTimePoints, nSims);
2311             prots = NaN(nTimePoints, nSims);
2312             dntps = NaN(nTimePoints, nSims);
2313             ntps = NaN(nTimePoints, nSims);
2314             aminoAcids = NaN(nTimePoints, nSims);
2315             damagedRnas = NaN(nTimePoints, nSims);
2316             damagedProteins = NaN(nTimePoints, nSims);
2317             antibiotics = NaN(nTimePoints, nSims);
2318             repInitDuration = NaN(1, nSims);
2319             repDuration = NaN(1, nSims);
2320             cytokinesisDuration = NaN(1, nSims);
2321             massDoublingDuration = NaN(1, nSims);
2322             cellCycleDuration = NaN(1, nSims);
2323             cellWt = NaN(nTimePoints, nSims);
2324             dnaWt = NaN(nTimePoints, nSims);
2325             rnaWt = NaN(nTimePoints, nSims);
2326             proteinWt = NaN(nTimePoints, nSims);
2327             terminalOrganelleWt = NaN(nTimePoints, nSims);
2328             pinchedDiameter = NaN(nTimePoints, nSims);
2329             totalLength = NaN(nTimePoints, nSims);
2330             isBacteriumAdherent = NaN(nTimePoints, nSims);
2331             
2332             validSims = false(nSims, 1);
2333             <span class="keyword">for</span> i = 1:nSims
2334                 <span class="keyword">try</span>
2335                     <span class="comment">%summary statistics</span>
2336                     simStats = SummaryLogger.getSimulationStatistics([SimulationDiskUtil.getBaseDir() filesep simBatchIDs{i}], simBatchIdxs(i)) / 3600;
2337                     repInitDuration(i) = simStats(SummaryLogger.SIM_STATUS_INDEX_REP_INIT_TIME);
2338                     repDuration(i) = simStats(SummaryLogger.SIM_STATUS_INDEX_REP_TIME) - simStats(SummaryLogger.SIM_STATUS_INDEX_REP_INIT_TIME);
2339                     cytokinesisDuration(i) = simStats(SummaryLogger.SIM_STATUS_INDEX_CYTOKINESIS_TIME) - simStats(SummaryLogger.SIM_STATUS_INDEX_REP_TIME);
2340                     massDoublingDuration(i) = simStats(SummaryLogger.SIM_STATUS_INDEX_MASS_DOUBLING_TIME);
2341                     cellCycleDuration(i) = simStats(SummaryLogger.SIM_STATUS_INDEX_CYTOKINESIS_TIME);
2342                     
2343                     clear simStats;
2344                     
2345                     <span class="comment">%summary data</span>
2346                     ensemble = SimulationEnsemble(simBatchIDs{i}, ensembleStateNames, [], simBatchIdxs(i));
2347                     dt = ensemble.stateData.downsampleStepSec;
2348                     timeIdxs = 1:dt:dt * floor(simEndTimes(i) / dt) + 1;
2349                     <span class="keyword">if</span> timeIdxs(end) ~= simEndTimes(i)+1
2350                         timeIdxs = [timeIdxs  simEndTimes(i)+1];
2351                     <span class="keyword">end</span>
2352                     <span class="keyword">if</span> ensemble.stateData.time(end) &gt; simEndTimes(i)
2353                         time = (0:ensemble.stateData.time(end))' / 3600;
2354                     <span class="keyword">end</span>
2355                     mass(timeIdxs, i) = permute(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'mass'</span>), :, :), [3 1 2]);
2356                     growth(timeIdxs, i) = permute(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'growth_rate'</span>), :, :), [3 1 2]);
2357                     ploidy(timeIdxs, i) = permute(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'ploidy'</span>), :, :), [3 1 2]);
2358                     superhelicalDensity(timeIdxs, i) = permute(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'superhelicity'</span>), :, :), [3 1 2]);
2359                     dntps(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'dntps'</span>), :, :), 1), [3 1 2]);
2360                     ntps(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'ntps'</span>), :, :), 1), [3 1 2]);
2361                     aminoAcids(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'amino_acids'</span>), :, :), 1), [3 1 2]);
2362                     antibiotics(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'antibiotics'</span>), :, :), 1), [3 1 2]);
2363                     damagedRnas(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'damagedRnas'</span>), :, :), 1), [3 1 2]);
2364                     damagedProteins(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'damagedProteins'</span>), :, :), 1), [3 1 2]);
2365                     rnas(timeIdxs, i) = <span class="keyword">...</span>
2366                         + permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'mrnas'</span>), :, :), 1), [3 1 2]) <span class="keyword">...</span>
2367                         + permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'rrnas'</span>), :, :), 1), [3 1 2]) <span class="keyword">...</span>
2368                         + permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'srnas'</span>), :, :), 1), [3 1 2]) <span class="keyword">...</span>
2369                         + permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'trnas'</span>), :, :), 1), [3 1 2]);
2370                     prots(timeIdxs, i) = <span class="keyword">...</span>
2371                         + permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'matureMonomers'</span>), :, :), 1), [3 1 2]) <span class="keyword">...</span>
2372                         + permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'matureComplexs'</span>), :, :), 1), [3 1 2]);
2373                     atpUsage(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'atpUsage'</span>), :, :), 1), [3 1 2]);
2374                     gtpUsage(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'gtpUsage'</span>), :, :), 1), [3 1 2]);
2375                     atpProduction(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'atpProduction'</span>), :, :), 1), [3 1 2]);
2376                     gtpProduction(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'gtpProduction'</span>), :, :), 1), [3 1 2]);
2377                     pinchedDiameter(timeIdxs, i) = permute(sum(ensemble.stateData.values(ensemble.getPropertyIndices(<span class="string">'pinchedDiameter'</span>), :, :), 1), [3 1 2]);
2378                     
2379                     clear ensemble;
2380                     
2381                     states = SimulationEnsemble.load(simBatchIDs{i}, stateNames, [], [], 1, <span class="string">'extract'</span>, simBatchIdxs(i));
2382                     
2383                     cellWt(2:simEndTimes(i)+1, i) = permute(sum(states.Mass.cell, 2), [3 1 2]);
2384                     dnaWt(2:simEndTimes(i)+1, i) = permute(states.Mass.dnaWt, [3 1 2]);
2385                     rnaWt(2:simEndTimes(i)+1, i) = permute(states.Mass.rnaWt, [3 1 2]);
2386                     proteinWt(2:simEndTimes(i)+1, i) = permute(states.Mass.proteinWt, [3 1 2]);
2387                     terminalOrganelleWt(2:simEndTimes(i)+1, i) = permute(sum(states.Mass.cell(:, termOrgIdxs, :), 2), [3 1 2]);
2388                     totalLength(2:simEndTimes(i)+1, i) = permute(states.Geometry.totalLength, [3 1 2]);
2389                     isBacteriumAdherent(2:simEndTimes(i)+1, i) = permute(states.Host.isBacteriumAdherent, [3 1 2]);
2390                     
2391                     clear states;
2392                     
2393                     validSims(i) = true;
2394                 <span class="keyword">catch</span> exception
2395                     <span class="keyword">if</span> exist(<span class="string">'simStats'</span>, <span class="string">'var'</span>)
2396                         clear simStats;
2397                     <span class="keyword">end</span>
2398                     <span class="keyword">if</span> exist(<span class="string">'ensemble'</span>, <span class="string">'var'</span>)
2399                         clear ensemble;
2400                     <span class="keyword">end</span>
2401                     warning(<span class="string">'WholeCell:warning:loadSingleGeneDeletion'</span>, <span class="string">'Unable to read simulation %s:%d\n%s'</span>, simBatchIDs{i}, simBatchIdxs(i), exception.getReport());
2402                 <span class="keyword">end</span>
2403             <span class="keyword">end</span>
2404             
2405             <span class="keyword">if</span> nSims &gt; 0 &amp;&amp; ~any(validSims)
2406                 exception.addCause(MException(<span class="string">'SingleGeneDeletions:error'</span>, <span class="string">'No valid Simulations'</span>)).rethrow();
2407             <span class="keyword">end</span>
2408             
2409             simEndTimes = simEndTimes(validSims, :);
2410             mass = mass(:, validSims);
2411             growth = growth(:, validSims);
2412             atpUsage = atpUsage(:, validSims);
2413             gtpUsage = gtpUsage(:, validSims);
2414             atpProduction = atpProduction(:, validSims);
2415             gtpProduction = gtpProduction(:, validSims);
2416             ploidy = ploidy(:, validSims);
2417             superhelicalDensity = superhelicalDensity(:, validSims);
2418             rnas = rnas(:, validSims);
2419             prots = prots(:, validSims);
2420             dntps = dntps(:, validSims);
2421             ntps = ntps(:, validSims);
2422             aminoAcids = aminoAcids(:, validSims);
2423             damagedRnas = damagedRnas(:, validSims);
2424             damagedProteins = damagedProteins(:, validSims);
2425             antibiotics = antibiotics(:, validSims);
2426             repInitDuration = repInitDuration(:, validSims);
2427             repDuration = repDuration(:, validSims);
2428             cytokinesisDuration = cytokinesisDuration(:, validSims);
2429             massDoublingDuration = massDoublingDuration(:, validSims);
2430             cellCycleDuration = cellCycleDuration(:, validSims);
2431             cellWt = cellWt(:, validSims);
2432             dnaWt = dnaWt(:, validSims);
2433             rnaWt = rnaWt(:, validSims);
2434             proteinWt = proteinWt(:, validSims);
2435             terminalOrganelleWt = terminalOrganelleWt(:, validSims);
2436             pinchedDiameter = pinchedDiameter(:, validSims);
2437             totalLength = totalLength(:, validSims);
2438             isBacteriumAdherent = isBacteriumAdherent(:, validSims);
2439             
2440             mass = mass * sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight) * 1e15;
2441             growth = growth * 3600 * sim.state(<span class="string">'Mass'</span>).cellInitialDryWeight / (1 - sim.state(<span class="string">'Mass'</span>).fractionWetWeight) * 1e15;
2442             
2443             <span class="comment">%% figure data</span>
2444             data = struct;
2445             data.simEndTimes = simEndTimes;
2446             data.time = time;
2447             data.mass = mass;
2448             data.growth = growth;
2449             data.atpUsage = atpUsage;
2450             data.gtpUsage = gtpUsage;
2451             data.atpProduction = atpProduction;
2452             data.gtpProduction = gtpProduction;
2453             data.ploidy = ploidy;
2454             data.superhelicalDensity = superhelicalDensity;
2455             data.rnas = rnas;
2456             data.prots = prots;
2457             data.dntps = dntps;
2458             data.ntps = ntps;
2459             data.aminoAcids = aminoAcids;
2460             data.damagedRnas = damagedRnas;
2461             data.damagedProteins = damagedProteins;
2462             data.antibiotics = antibiotics;
2463             data.repInitDuration = repInitDuration;
2464             data.repDuration = repDuration;
2465             data.cytokinesisDuration = cytokinesisDuration;
2466             data.massDoublingDuration = massDoublingDuration;
2467             data.cellCycleDuration = cellCycleDuration;
2468             data.cellWt = cellWt;
2469             data.dnaWt = dnaWt;
2470             data.rnaWt = rnaWt;
2471             data.proteinWt = proteinWt;
2472             data.terminalOrganelleWt = terminalOrganelleWt;
2473             data.pinchedDiameter = pinchedDiameter;
2474             data.totalLength = totalLength;
2475             data.isBacteriumAdherent = isBacteriumAdherent;
2476         <span class="keyword">end</span>
2477         
2478         <a name="_sub20" href="#_subfunctions" class="code">function nPlots = plotSingleGeneDeletion(data, classes, classLabels, plotRepresentativeCell, figHandle, plotIdx, colors)</a>
2479             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
2480             import edu.stanford.covert.cell.sim.util.PlotUtil;
2481             
2482             <span class="keyword">if</span> nargin &lt; 7
2483                 colors = SingleGeneDeletions.COLORS;
2484             <span class="keyword">end</span>
2485             
2486             maxTime = NaN;
2487             <span class="keyword">for</span> i = 1:numel(data)
2488                 maxTime = max(maxTime, data{i}.time(end));
2489             <span class="keyword">end</span>
2490             
2491             growthDataNamesFields = {
2492                 <span class="string">'mass'</span>                 {<span class="string">'Mass'</span> <span class="string">'(fg)'</span>}
2493                 <span class="string">'growth'</span>               {<span class="string">'Growth'</span> <span class="string">'(fg h^{-1})'</span>}
2494                 <span class="string">'atpUsage'</span>             {<span class="string">'ATP'</span> <span class="string">'Usage'</span>}
2495                 <span class="string">'gtpUsage'</span>             {<span class="string">'GTP'</span> <span class="string">'Usage'</span>}
2496                 <span class="string">'ploidy'</span>               {<span class="string">'Chr'</span> <span class="string">'Copy No'</span>}
2497                 <span class="string">'superhelicalDensity'</span>  {<span class="string">'Super-'</span> <span class="string">'helicity'</span>}
2498                 <span class="string">'rnas'</span>                 <span class="string">'RNA'</span>
2499                 <span class="string">'prots'</span>                <span class="string">'Protein'</span>
2500                 };
2501             toxicDataNamesFields = {
2502                 <span class="string">'dntps'</span>            <span class="string">'dNTP'</span>
2503                 <span class="string">'ntps'</span>             <span class="string">'NTP'</span>
2504                 <span class="string">'aminoAcids'</span>       {<span class="string">'Amino'</span> <span class="string">'Acid'</span>}
2505                 <span class="string">'damagedRnas'</span>      {<span class="string">'Damaged'</span> <span class="string">'RNA'</span>}
2506                 <span class="string">'damagedProteins'</span>  {<span class="string">'Damaged'</span> <span class="string">'Protein'</span>}
2507                 <span class="string">'antibiotics'</span>      <span class="string">'Antibiotics'</span>
2508                 };
2509             phaseDataNamesFields = {
2510                 <span class="string">'repInitDuration'</span>       {<span class="string">'Replication'</span> <span class="string">'Initiation'</span>}
2511                 <span class="string">'repDuration'</span>           <span class="string">'Replication'</span>
2512                 <span class="string">'cytokinesisDuration'</span>   <span class="string">'Cytokinesis'</span>
2513                 <span class="string">'massDoublingDuration'</span>  <span class="string">'Growth'</span>
2514                 <span class="string">'cellCycleDuration'</span>     <span class="string">'Cell Cycle'</span>
2515                 };
2516             
2517             <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(plotIdx)
2518                 <span class="keyword">for</span> i = 1:size(growthDataNamesFields, 1)
2519                     <span class="keyword">if</span> iscell(growthDataNamesFields{i, 2})
2520                         growthDataNamesFields{i, 2} = strjoin(<span class="string">' '</span>, growthDataNamesFields{i, 2}{:});
2521                     <span class="keyword">end</span>
2522                 <span class="keyword">end</span>
2523                 <span class="keyword">for</span> i = 1:size(toxicDataNamesFields, 1)
2524                     <span class="keyword">if</span> iscell(toxicDataNamesFields{i, 2})
2525                         toxicDataNamesFields{i, 2} = strjoin(<span class="string">' '</span>, toxicDataNamesFields{i, 2}{:});
2526                     <span class="keyword">end</span>
2527                 <span class="keyword">end</span>
2528                 <span class="keyword">for</span> i = 1:size(phaseDataNamesFields, 1)
2529                     <span class="keyword">if</span> iscell(phaseDataNamesFields{i, 2})
2530                         phaseDataNamesFields{i, 2} = strjoin(<span class="string">' '</span>, phaseDataNamesFields{i, 2}{:});
2531                     <span class="keyword">end</span>
2532                 <span class="keyword">end</span>
2533             <span class="keyword">end</span>
2534             
2535             nPlots = <span class="keyword">...</span>
2536                 + size(growthDataNamesFields, 1) <span class="keyword">...</span>
2537                 + size(toxicDataNamesFields, 1) <span class="keyword">...</span>
2538                 + size(phaseDataNamesFields, 1);
2539             
2540             
2541             <span class="comment">%% plot data</span>
2542             clf(figHandle);
2543             <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(plotIdx)
2544                 <span class="keyword">if</span> plotIdx &lt;= size(growthDataNamesFields, 1) + size(toxicDataNamesFields, 1)
2545                     [axesHandles, xAxesHandles] = PlotUtil.multiElementPlot(figHandle, {50; 50}, [0 maxTime], struct(<span class="keyword">...</span>
2546                         <span class="string">'colWidths'</span>, [2.4 0.5], <span class="string">'yAxesLabelWidths'</span>, [0.14 0.01], <span class="string">'position'</span>, [0.02 0.32 0.95 0.6]));
2547                     delete(xAxesHandles{2});
2548                 <span class="keyword">else</span>
2549                     [axesHandles, xAxesHandles] = PlotUtil.multiElementPlot(figHandle, {50}, [0 maxTime], struct(<span class="keyword">...</span>
2550                         <span class="string">'yAxesLabelWidths'</span>, 0.09, <span class="string">'position'</span>, [0.02 0.32 0.95 0.6]));
2551                 <span class="keyword">end</span>
2552             <span class="keyword">else</span>
2553                 axesSizes = {
2554                     5 * ones(8, 1);   5 * ones(8, 1);
2555                     5 * ones(6, 1);   5 * ones(6, 1);
2556                     5 * ones(5, 1);
2557                     };
2558                 [axesHandles, xAxesHandles] = PlotUtil.multiElementPlot(figHandle, axesSizes, [0 maxTime], struct(<span class="keyword">...</span>
2559                     <span class="string">'colWidths'</span>, [2.4 0.5 2.4 0.5 2], <span class="string">'yAxesLabelWidths'</span>, [0.14 0.01 0.14 0.01 0.09], <span class="string">'position'</span>, [0.02 0.32 0.95 0.6]));
2560                 delete(xAxesHandles{2});
2561                 delete(xAxesHandles{4});
2562             <span class="keyword">end</span>
2563             
2564             <span class="comment">%% growth</span>
2565             <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(plotIdx) &amp;&amp; plotIdx &lt;= size(growthDataNamesFields, 1)
2566                 SingleGeneDeletions.plotSingleGeneDeletionTemporalDynamics(<span class="keyword">...</span>
2567                     axesHandles{1}, axesHandles{2}, data, classes, classLabels, <span class="keyword">...</span>
2568                     plotRepresentativeCell, growthDataNamesFields{plotIdx, :}, colors);
2569             <span class="keyword">elseif</span> nargin &lt; 6 || isempty(plotIdx)
2570                 <span class="keyword">for</span> i = 1:size(growthDataNamesFields, 1)
2571                     SingleGeneDeletions.plotSingleGeneDeletionTemporalDynamics(<span class="keyword">...</span>
2572                         axesHandles{1}(i), axesHandles{2}(i), data, classes, classLabels, <span class="keyword">...</span>
2573                         plotRepresentativeCell, growthDataNamesFields{i, :}, colors);
2574                 <span class="keyword">end</span>
2575             <span class="keyword">end</span>
2576             
2577             <span class="comment">%% toxic build up</span>
2578             <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(plotIdx) &amp;&amp; plotIdx &gt; size(growthDataNamesFields, 1) &amp;&amp; plotIdx &lt;= size(growthDataNamesFields, 1) + size(toxicDataNamesFields, 1)
2579                 tmp = plotIdx - size(growthDataNamesFields, 1);
2580                 SingleGeneDeletions.plotSingleGeneDeletionTemporalDynamics(<span class="keyword">...</span>
2581                     axesHandles{1}, axesHandles{2}, data, classes, classLabels, <span class="keyword">...</span>
2582                     plotRepresentativeCell, toxicDataNamesFields{tmp, :}, colors);
2583             <span class="keyword">elseif</span> nargin &lt; 6 || isempty(plotIdx)
2584                 <span class="keyword">for</span> i = 1:size(toxicDataNamesFields, 1)
2585                     SingleGeneDeletions.plotSingleGeneDeletionTemporalDynamics(<span class="keyword">...</span>
2586                         axesHandles{3}(i), axesHandles{4}(i), data, classes, classLabels, <span class="keyword">...</span>
2587                         plotRepresentativeCell, toxicDataNamesFields{i, :}, colors);
2588                 <span class="keyword">end</span>
2589             <span class="keyword">end</span>
2590             
2591             <span class="comment">%% cell cycle phase durations</span>
2592             <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(plotIdx) &amp;&amp; plotIdx &gt; (size(growthDataNamesFields, 1) + size(toxicDataNamesFields, 1))
2593                 tmp = plotIdx - size(growthDataNamesFields, 1) - size(toxicDataNamesFields, 1);
2594                 SingleGeneDeletions.plotSingleGeneDeletionCellCyclePhaseHistogram(<span class="keyword">...</span>
2595                     axesHandles{1}, data, classes, classLabels, phaseDataNamesFields{tmp, :}, colors);
2596             <span class="keyword">elseif</span> nargin &lt; 6 || isempty(plotIdx)
2597                 <span class="keyword">for</span> i = 1:size(phaseDataNamesFields, 1)
2598                     SingleGeneDeletions.plotSingleGeneDeletionCellCyclePhaseHistogram(<span class="keyword">...</span>
2599                         axesHandles{5}(i), data, classes, classLabels, phaseDataNamesFields{i, :}, colors);
2600                 <span class="keyword">end</span>
2601             <span class="keyword">end</span>
2602             
2603             <span class="comment">%% formatting</span>
2604             tmp = [];
2605             tmp2 = [];
2606             <span class="keyword">for</span> i = 1:2:numel(axesHandles)
2607                 tmp = [tmp; axesHandles{i}];
2608                 tmp2 = [tmp2; xAxesHandles{i}];
2609             <span class="keyword">end</span>
2610             
2611             <span class="keyword">if</span> nargin &gt;= 6 &amp;&amp; ~isempty(plotIdx)
2612                 set(tmp, <span class="string">'FontSize'</span>, 10);
2613                 set(tmp2, <span class="string">'FontSize'</span>, 10);
2614                 set(get(tmp2, <span class="string">'xlabel'</span>), <span class="string">'FontSize'</span>, 12);
2615                 set(get(tmp, <span class="string">'ylabel'</span>), <span class="string">'FontSize'</span>, 12, <span class="string">'Color'</span>, [0 0 0]);
2616                 set(get(tmp, <span class="string">'title'</span>), <span class="string">'FontSize'</span>, 12);
2617                 PlotUtil.alignYAxesLabels(axesHandles);
2618                 axesHandles2 = PlotUtil.offsetYAxes(tmp, 0.02);
2619                 h = [
2620                     getappdata(tmp, <span class="string">'YTickText'</span>)
2621                     getappdata(axesHandles2(1), <span class="string">'YTickText'</span>)
2622                     ];
2623                 set(h, <span class="string">'FontSize'</span>, 10);
2624             <span class="keyword">else</span>
2625                 set(tmp, <span class="string">'FontSize'</span>, 6);
2626                 set(tmp2, <span class="string">'FontSize'</span>, 6);
2627                 set(cell2mat(get(tmp2, <span class="string">'xlabel'</span>)), <span class="string">'FontSize'</span>, 8);
2628                 set(cell2mat(get(tmp, <span class="string">'ylabel'</span>)), <span class="string">'FontSize'</span>, 8, <span class="string">'Color'</span>, [0 0 0]);
2629                 set(cell2mat(get(tmp, <span class="string">'title'</span>)), <span class="string">'FontSize'</span>, 8);
2630                 PlotUtil.alignYAxesLabels(axesHandles);
2631                 PlotUtil.offsetYAxes(axesHandles(1:2:end-1), 0.05);
2632             <span class="keyword">end</span>
2633             
2634             <span class="comment">%% legend</span>
2635             [uClasses, uClassIdxs] = unique(classes);
2636             h = zeros(size(uClasses));
2637             nCols = max(5, ceil(numel(uClasses) / 5));
2638             nRows = 5;
2639             <span class="keyword">for</span> i = 1:numel(uClasses)
2640                 x = 0.11 + 0.78 / nCols * (ceil(i / nRows) - 1);
2641                 y = 0.32 - 0.10 - 0.03 * (mod(i - 1, nRows) + 1);
2642                 h(i) = annotation(figHandle, <span class="string">'textarrow'</span>, x + [0 -0.025], y(1, [1 1]), <span class="keyword">...</span>
2643                     <span class="string">'HeadStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
2644                     <span class="string">'String'</span>, classLabels{uClassIdxs(i), 1}, <span class="keyword">...</span>
2645                     <span class="string">'FontSize'</span>, 6, <span class="keyword">...</span>
2646                     <span class="string">'LineWidth'</span>, 4, <span class="keyword">...</span>
2647                     <span class="string">'Color'</span>, colors(uClasses(i), :), <span class="keyword">...</span>
2648                     <span class="string">'TextColor'</span>, <span class="string">'k'</span>);
2649                 setappdata(h(i), <span class="string">'class'</span>, uClasses(i));
2650                 setappdata(h(i), <span class="string">'label'</span>, classLabels(uClassIdxs(i), 1));
2651                 set(h(i), <span class="string">'ButtonDownFcn'</span>, @SingleGeneDeletions.plotSingleGeneDeletionCallback);
2652             <span class="keyword">end</span>
2653             
2654             setappdata(figHandle, <span class="string">'legendEntries'</span>, h);
2655         <span class="keyword">end</span>
2656         
2657         <a name="_sub21" href="#_subfunctions" class="code">function plotSingleGeneDeletionTemporalDynamics(dynamicsAxesHandle, histogramAxesHandle, data, classes, classLabels, plotRepresentativeCell, dataField, dataLabel, colors)</a>
2658             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
2659             import edu.stanford.covert.cell.sim.util.PlotUtil;
2660             
2661             <span class="comment">%options</span>
2662             <span class="keyword">if</span> nargin &lt; 9
2663                 colors = SingleGeneDeletions.COLORS;
2664             <span class="keyword">end</span>
2665             
2666             <span class="comment">%axes</span>
2667             cla(dynamicsAxesHandle);
2668             cla(histogramAxesHandle);
2669             hold(dynamicsAxesHandle, <span class="string">'on'</span>);
2670             hold(histogramAxesHandle, <span class="string">'on'</span>);
2671             
2672             yRange = [NaN NaN];
2673             maxTime = NaN;
2674             <span class="keyword">for</span> i = 1:numel(data)
2675                 yRange(1) = min(yRange(1), min(data{i}.(dataField)(:)));
2676                 yRange(2) = max(yRange(2), max(data{i}.(dataField)(:)));
2677                 maxTime = max(maxTime, data{i}.time(end));
2678             <span class="keyword">end</span>
2679             maxTime = min(maxTime, 20);
2680             <span class="keyword">if</span> yRange(1) == yRange(2)
2681                 yRange(1) = yRange(1) - sqrt(eps);
2682                 yRange(2) = yRange(2) + sqrt(eps);
2683             <span class="keyword">end</span>
2684             
2685             simEndTimes = cell(size(data));
2686             <span class="keyword">for</span> i = 1:numel(data)
2687                 simEndTimes{i} = zeros(size(data{i}.simEndTimes));
2688                 <span class="keyword">for</span> j = 1:numel(data{i}.simEndTimes);
2689                     simEndTimes{i}(j) = find(~isnan(data{i}.growth(:, j)), 1, <span class="string">'last'</span>);
2690                 <span class="keyword">end</span>
2691             <span class="keyword">end</span>
2692             
2693             <span class="comment">%dynamics</span>
2694             <span class="keyword">for</span> i = 1:numel(data)
2695                 <span class="keyword">if</span> plotRepresentativeCell(i)
2696                     medianTime = median(simEndTimes{i});
2697                     [~, simIdx] = min(abs(medianTime - simEndTimes{i}));
2698                 <span class="keyword">else</span>
2699                     simIdx = 1:numel(simEndTimes{i});
2700                 <span class="keyword">end</span>
2701                 xdata = data{i}.time;
2702                 ydata = data{i}.(dataField)(:, simIdx);
2703                 xdata = xdata(any(~isnan(ydata), 2), :);
2704                 ydata = ydata(any(~isnan(ydata), 2), :);
2705                 
2706                 h = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(dynamicsAxesHandle, xdata, ydata);
2707                 set(h, <span class="string">'Color'</span>, colors(classes(i), :));
2708                 <span class="keyword">for</span> j = 1:numel(h)
2709                     setappdata(h(j), <span class="string">'class'</span>, i);
2710                     setappdata(h(j), <span class="string">'label'</span>, classLabels(i, :));
2711                 <span class="keyword">end</span>
2712                 set(h, <span class="string">'ButtonDownFcn'</span>, @SingleGeneDeletions.plotSingleGeneDeletionCallback);
2713             <span class="keyword">end</span>
2714             
2715             <span class="comment">%marginal</span>
2716             edges = linspace(yRange(1), yRange(2), 20);
2717             uClasses = unique(classes);
2718             freq = zeros(numel(edges), numel(uClasses));
2719             <span class="keyword">for</span> i = 1:numel(data)
2720                 tmp = data{i}.(dataField)(sub2ind(size(data{i}.(dataField)), simEndTimes{i}, (1:numel(simEndTimes{i}))'));
2721                 freq(:, classes(i) == uClasses) = <span class="keyword">...</span>
2722                     + freq(:, classes(i) == uClasses) <span class="keyword">...</span>
2723                     + reshape(histc(tmp, edges), [], 1);
2724             <span class="keyword">end</span>
2725             freq = freq ./ repmat(sum(freq, 1), [numel(edges) 1]);
2726             edges = [edges(1);  edges(:) + diff(edges(1:2)) / 2;  edges(end) + diff(edges(1:2))];
2727             h = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(histogramAxesHandle, [zeros(1, numel(uClasses)); freq; zeros(1, numel(uClasses))], edges, <span class="string">'b'</span>);
2728             
2729             <span class="keyword">for</span> i = 1:numel(uClasses)
2730                 set(h(i), <span class="string">'Color'</span>, colors(uClasses(i), :));
2731                 setappdata(h(i), <span class="string">'class'</span>, uClasses(i));
2732                 setappdata(h(i), <span class="string">'label'</span>, classLabels(uClasses(i), 1));
2733                 set(h(i), <span class="string">'ButtonDownFcn'</span>, @SingleGeneDeletions.plotSingleGeneDeletionCallback);
2734             <span class="keyword">end</span>
2735             
2736             <span class="comment">%axes</span>
2737             xlim(dynamicsAxesHandle, [0 maxTime]);
2738             xlim(histogramAxesHandle, [0 max(1, max(freq(:)))]);
2739             ylabel(dynamicsAxesHandle, dataLabel, <span class="string">'FontSize'</span>, 8);
2740             
2741             <span class="keyword">if</span> any(yRange) &amp;&amp; range(yRange)
2742                 ylim(dynamicsAxesHandle, yRange);
2743                 ylim(histogramAxesHandle, yRange);
2744                 set(dynamicsAxesHandle, <span class="string">'YTick'</span>, yRange);
2745                 PlotUtil.formatYAxes(dynamicsAxesHandle, yRange(1), yRange(end));
2746             <span class="keyword">end</span>
2747             
2748             figHandle = get(dynamicsAxesHandle, <span class="string">'Parent'</span>);
2749             
2750             box(dynamicsAxesHandle, <span class="string">'off'</span>);
2751             set(dynamicsAxesHandle, <span class="keyword">...</span>
2752                 <span class="string">'FontSize'</span>, 7, <span class="keyword">...</span>
2753                 <span class="string">'TickDir'</span>, <span class="string">'out'</span>, <span class="keyword">...</span>
2754                 <span class="string">'YMinorTick'</span>, <span class="string">'off'</span>, <span class="keyword">...</span>
2755                 <span class="string">'XTick'</span>, [], <span class="keyword">...</span>
2756                 <span class="string">'XColor'</span>, get(figHandle, <span class="string">'Color'</span>));
2757             
2758             box(histogramAxesHandle, <span class="string">'off'</span>);
2759             set(histogramAxesHandle, <span class="keyword">...</span>
2760                 <span class="string">'Visible'</span>, <span class="string">'off'</span>, <span class="keyword">...</span>
2761                 <span class="string">'FontSize'</span>, 7, <span class="keyword">...</span>
2762                 <span class="string">'TickDir'</span>, <span class="string">'out'</span>, <span class="keyword">...</span>
2763                 <span class="string">'XMinorTick'</span>, <span class="string">'off'</span>, <span class="keyword">...</span>
2764                 <span class="string">'YMinorTick'</span>, <span class="string">'off'</span>, <span class="keyword">...</span>
2765                 <span class="string">'XTick'</span>, [], <span class="keyword">...</span>
2766                 <span class="string">'YTick'</span>, [], <span class="keyword">...</span>
2767                 <span class="string">'XColor'</span>, get(figHandle, <span class="string">'Color'</span>), <span class="keyword">...</span>
2768                 <span class="string">'YColor'</span>, get(figHandle, <span class="string">'Color'</span>));
2769         <span class="keyword">end</span>
2770         
2771         <a name="_sub22" href="#_subfunctions" class="code">function plotSingleGeneDeletionCellCyclePhaseHistogram(axesHandle, data, classes, classLabels, dataField, dataLabel, colors)</a>
2772             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
2773             import edu.stanford.covert.cell.sim.util.PlotUtil;
2774             
2775             <span class="keyword">if</span> nargin &lt; 7
2776                 colors = SingleGeneDeletions.COLORS;
2777             <span class="keyword">end</span>
2778             
2779             cla(axesHandle);
2780             
2781             maxTime = NaN;
2782             <span class="keyword">for</span> i = 1:numel(data)
2783                 maxTime = max(maxTime, data{i}.time(end));
2784             <span class="keyword">end</span>
2785             
2786             edges = linspace(0, maxTime, 20);
2787             
2788             uClasses = unique(classes);
2789             freq = zeros(numel(edges), numel(uClasses));
2790             <span class="keyword">for</span> i = 1:numel(data)
2791                 freq(:, classes(i) == uClasses) = <span class="keyword">...</span>
2792                     + freq(:, classes(i) == uClasses) <span class="keyword">...</span>
2793                     + reshape(histc(data{i}.(dataField), edges), [], 1);
2794             <span class="keyword">end</span>
2795             freq = freq ./ repmat(sum(freq, 1), [numel(edges) 1]);
2796             
2797             edges = [edges(1);  edges(:) + diff(edges(1:2)) / 2;  edges(end) + diff(edges(1:2))];
2798             h = <a href="#_sub18" class="code" title="subfunction plot(sim, deletionMetabolicOutputs, wtMetabolicOutput, deletionStats, wtStats, geneClasses, fileName)">plot</a>(axesHandle, edges, [zeros(1, numel(uClasses)); freq; zeros(1, numel(uClasses))], <span class="string">'b'</span>);
2799             <span class="keyword">for</span> i = 1:numel(uClasses)
2800                 set(h(i), <span class="string">'Color'</span>, colors(uClasses(i), :));
2801                 setappdata(h(i), <span class="string">'class'</span>, uClasses(i));
2802                 setappdata(h(i), <span class="string">'label'</span>, classLabels(uClasses(i), 1));
2803                 set(h(i), <span class="string">'ButtonDownFcn'</span>, @SingleGeneDeletions.plotSingleGeneDeletionCallback);
2804             <span class="keyword">end</span>
2805             
2806             xlim(axesHandle, [0 maxTime]);
2807             box(axesHandle, <span class="string">'off'</span>);
2808             set(axesHandle, <span class="keyword">...</span>
2809                 <span class="string">'FontSize'</span>, 7, <span class="keyword">...</span>
2810                 <span class="string">'TickDir'</span>, <span class="string">'out'</span>, <span class="keyword">...</span>
2811                 <span class="string">'XMinorTick'</span>, <span class="string">'off'</span>, <span class="keyword">...</span>
2812                 <span class="string">'YMinorTick'</span>, <span class="string">'off'</span>, <span class="keyword">...</span>
2813                 <span class="string">'XTick'</span>, [], <span class="keyword">...</span>
2814                 <span class="string">'YTick'</span>, [], <span class="keyword">...</span>
2815                 <span class="string">'XColor'</span>, get(get(axesHandle, <span class="string">'Parent'</span>), <span class="string">'Color'</span>), <span class="keyword">...</span>
2816                 <span class="string">'YColor'</span>, get(get(axesHandle, <span class="string">'Parent'</span>), <span class="string">'Color'</span>));
2817             ylabel(axesHandle, [dataLabel {<span class="string">'Freq'</span>}], <span class="string">'FontSize'</span>, 8);
2818         <span class="keyword">end</span>
2819         
2820         <a name="_sub23" href="#_subfunctions" class="code">function plotSingleGeneDeletionCallback(hObject, ~)</a>
2821             class = getappdata(hObject, <span class="string">'class'</span>);
2822             label = getappdata(hObject, <span class="string">'label'</span>);
2823             
2824             figHandle = get(get(hObject, <span class="string">'Parent'</span>), <span class="string">'Parent'</span>);
2825             axesHandles = findobj(get(figHandle, <span class="string">'Children'</span>), <span class="string">'type'</span>, <span class="string">'axes'</span>);
2826             <span class="keyword">for</span> i = 1:numel(axesHandles)
2827                 lineHandles = findobj(get(axesHandles(i), <span class="string">'Children'</span>), <span class="string">'type'</span>, <span class="string">'line'</span>);
2828                 <span class="keyword">for</span> j = 1:numel(lineHandles)
2829                     tmpClass = getappdata(lineHandles(j), <span class="string">'class'</span>);
2830                     <span class="keyword">if</span> ~isempty(tmpClass)
2831                         <span class="keyword">if</span> tmpClass == class
2832                             <span class="keyword">if</span> ~isequal(get(lineHandles(j), <span class="string">'MarkerEdgeColor'</span>), <span class="string">'auto'</span>)
2833                                 set(lineHandles(j), <span class="string">'Color'</span>, get(lineHandles(j), <span class="string">'MarkerEdgeColor'</span>));
2834                             <span class="keyword">end</span>
2835                             set(lineHandles(j), <span class="string">'LineWidth'</span>, 2);
2836                             uistack(lineHandles(j), <span class="string">'top'</span>);
2837                         <span class="keyword">else</span>
2838                             <span class="keyword">if</span> isequal(get(lineHandles(j), <span class="string">'MarkerEdgeColor'</span>), <span class="string">'auto'</span>)
2839                                 set(lineHandles(j), <span class="string">'MarkerEdgeColor'</span>, get(lineHandles(j), <span class="string">'Color'</span>));
2840                             <span class="keyword">end</span>
2841                             set(lineHandles(j), <span class="string">'LineWidth'</span>, 1, <span class="string">'Color'</span>, [0.9 0.9 0.9]);
2842                         <span class="keyword">end</span>
2843                     <span class="keyword">end</span>
2844                 <span class="keyword">end</span>
2845             <span class="keyword">end</span>
2846             
2847             legendEntries = getappdata(figHandle, <span class="string">'legendEntries'</span>);
2848             <span class="keyword">for</span> i = 1:numel(legendEntries)
2849                 tmpClass = getappdata(legendEntries(i), <span class="string">'class'</span>);
2850                 <span class="keyword">if</span> tmpClass == class
2851                     <span class="keyword">if</span> ~isequal(get(legendEntries(i), <span class="string">'TextEdgeColor'</span>), <span class="string">'none'</span>)
2852                         set(legendEntries(i), <span class="string">'Color'</span>, get(legendEntries(i), <span class="string">'TextEdgeColor'</span>));
2853                     <span class="keyword">end</span>
2854                     uistack(legendEntries(i), <span class="string">'top'</span>);
2855                 <span class="keyword">else</span>
2856                     <span class="keyword">if</span> isequal(get(legendEntries(i), <span class="string">'TextEdgeColor'</span>), <span class="string">'none'</span>)
2857                         set(legendEntries(i), <span class="string">'TextEdgeColor'</span>, get(legendEntries(i), <span class="string">'Color'</span>), <span class="string">'TextLineWidth'</span>, 0);
2858                     <span class="keyword">end</span>
2859                     set(legendEntries(i), <span class="string">'Color'</span>, [0.9 0.9 0.9]);
2860                 <span class="keyword">end</span>
2861                 set(legendEntries(i), <span class="string">'TextColor'</span>, <span class="string">'k'</span>);
2862             <span class="keyword">end</span>
2863             
2864             label = strjoin(<span class="string">' - '</span>, label{:});
2865             label = strrep(label, <span class="string">'{\Delta}'</span>, char(916));
2866             label = strrep(label, <span class="string">'\_'</span>, <span class="string">'_'</span>);
2867             disp([<span class="string">'Selected: '</span>, label]);
2868         <span class="keyword">end</span>
2869         
2870         <a name="_sub24" href="#_subfunctions" class="code">function [class, classLabel] = classifyDeletionStrain(geneID, wtData)</a>
2871             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
2872             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
2873             
2874             baseDir = [SimulationDiskUtil.getBaseDir() filesep <span class="string">'singleGeneDeletions'</span> filesep];
2875             deletionData = load([baseDir geneID <span class="string">'.mat'</span>]);
2876             <span class="keyword">if</span> nargin &lt; 2
2877                 wtData = load([baseDir <span class="string">'WT.mat'</span>]);
2878             <span class="keyword">end</span>
2879             
2880             nWtSims = numel(wtData.simEndTimes);
2881             nDeletionSims = numel(deletionData.simEndTimes);
2882             
2883             cellCycleLength = min([wtData.simEndTimes; deletionData.simEndTimes]);
2884             
2885             wtStartTimes = 2 * ones(size(wtData.simEndTimes));
2886             wtTauTimes = zeros(size(wtData.growth, 2), 1);
2887             wtFinTimes = wtData.simEndTimes + 1;
2888             deletionStartTimes = 101 * ones(size(deletionData.simEndTimes));
2889             deletionTauTimes = zeros(size(deletionData.growth, 2), 1);
2890             deletionFinTimes = deletionData.simEndTimes + 1;
2891             <span class="keyword">for</span> i = 1:nWtSims
2892                 wtTauTimes(i) = find(~isnan(wtData.growth(1:cellCycleLength, i)), 1, <span class="string">'last'</span>);
2893             <span class="keyword">end</span>
2894             <span class="keyword">for</span> i = 1:nDeletionSims
2895                 deletionTauTimes(i) = find(~isnan(deletionData.growth(1:cellCycleLength, i)), 1, <span class="string">'last'</span>);
2896             <span class="keyword">end</span>
2897             
2898             wtStartInds = sub2ind(size(wtData.growth), wtStartTimes', 1:nWtSims);
2899             wtFinInds = sub2ind(size(wtData.growth), wtFinTimes', 1:nWtSims); <span class="comment">%#ok&lt;NASGU&gt;</span>
2900             wtTauInds = sub2ind(size(wtData.growth), wtTauTimes', 1:nWtSims);
2901             deletionStartInds = sub2ind(size(deletionData.growth), deletionStartTimes', 1:nDeletionSims);
2902             deletionFinInds = sub2ind(size(deletionData.growth), deletionFinTimes', 1:nDeletionSims);
2903             deletionTauInds = sub2ind(size(deletionData.growth), deletionTauTimes', 1:nDeletionSims);
2904             
2905             wtTauGrowths = wtData.growth(wtTauInds);
2906             deletionFinGrowths = deletionData.growth(deletionFinInds);
2907             deletionTauGrowths = deletionData.growth(deletionTauInds);
2908             deletionInitGrowths = deletionData.growth(deletionStartInds);
2909             
2910             <span class="keyword">if</span> <span class="keyword">...</span>
2911                     median(deletionInitGrowths) &lt; 0.1 * median(wtData.growth(wtStartInds)) &amp;&amp; (<span class="keyword">...</span>
2912                     median(deletionData.damagedProteins(deletionFinInds)) &gt; max(100, 100 * median(wtData.damagedProteins(wtTauInds))) || <span class="keyword">...</span>
2913                     median(deletionData.damagedRnas(deletionFinInds))     &gt; max(100, 100 * median(wtData.damagedRnas(wtTauInds)))     || <span class="keyword">...</span>
2914                     median(deletionData.aminoAcids(deletionFinInds))      &gt; max(100, 100 * median(wtData.aminoAcids(wtTauInds)))      || <span class="keyword">...</span>
2915                     median(deletionData.ntps(deletionFinInds))            &gt; max(100, 100 * median(wtData.ntps(wtTauInds)))               <span class="keyword">...</span>
2916                     )
2917                 class = SingleGeneDeletions.DECOMPOSING;
2918             <span class="keyword">elseif</span> median(deletionInitGrowths) &lt; 0.1 * median(wtData.growth(wtStartInds))
2919                 class = SingleGeneDeletions.NON_GROWING;
2920             <span class="keyword">elseif</span> all(deletionFinGrowths &lt; deletionInitGrowths) &amp;&amp; all(deletionData.rnas(deletionTauInds) &lt; deletionData.rnas(deletionStartInds))
2921                 class = SingleGeneDeletions.DECAYING_GROWTH_NON_RNA_PROTEIN;
2922             <span class="keyword">elseif</span> all(deletionFinGrowths &lt; deletionInitGrowths) &amp;&amp; all(deletionData.prots(deletionTauInds) &lt; deletionData.prots(deletionStartInds))
2923                 class = SingleGeneDeletions.DECAYING_GROWTH_NON_PROTEIN;
2924             <span class="keyword">elseif</span> <span class="keyword">...</span>
2925                     median(deletionData.damagedProteins(deletionFinInds)) &gt; max(100, 100 * median(wtData.damagedProteins(wtTauInds))) || <span class="keyword">...</span>
2926                     median(deletionData.damagedRnas(deletionFinInds))     &gt; max(100, 100 * median(wtData.damagedRnas(wtTauInds)))     || <span class="keyword">...</span>
2927                     median(deletionData.aminoAcids(deletionFinInds))      &gt; max(100, 100 * median(wtData.aminoAcids(wtTauInds)))      || <span class="keyword">...</span>
2928                     median(deletionData.ntps(deletionFinInds))            &gt; max(100, 100 * median(wtData.ntps(wtTauInds)))            || <span class="keyword">...</span>
2929                     median(deletionData.antibiotics(deletionFinInds))     &gt; max(100, 100 * median(wtData.antibiotics(wtTauInds)))
2930                 class = SingleGeneDeletions.TOXIN_ACCUMULATION;
2931             <span class="keyword">elseif</span> ~any(deletionData.ploidy(:) &gt; 1)
2932                 class = SingleGeneDeletions.NON_REPLICATIVE;
2933             <span class="keyword">elseif</span> median(deletionTauGrowths) &lt; 0.80 * median(wtTauGrowths) &amp;&amp; median(deletionTauGrowths) &gt; median(deletionInitGrowths)
2934                 class = SingleGeneDeletions.SLOW_GROWING;
2935             <span class="keyword">elseif</span> ~any(deletionData.cytokinesisDuration(:))
2936                 class = SingleGeneDeletions.NON_FISSIVE;
2937             <span class="keyword">elseif</span> ~any(deletionData.isBacteriumAdherent(2, :))
2938                 class = SingleGeneDeletions.NO_TERMINAL_ORGANELLE;
2939             <span class="keyword">elseif</span> ismember(geneID, SingleGeneDeletions.nonPerpetuatingEssentialGenes)
2940                 class = SingleGeneDeletions.NON_PERPETUATING;
2941             <span class="keyword">else</span>
2942                 class = SingleGeneDeletions.NON_ESSENTIAL;
2943             <span class="keyword">end</span>
2944             
2945             classLabel = SingleGeneDeletions.DELETION_STRAIN_CLASSES{class};
2946         <span class="keyword">end</span>
2947     <span class="keyword">end</span>
2948     
2949     <span class="comment">%Analyze specific single gene deletion strains</span>
2950     methods (Static)
2951         <a name="_sub25" href="#_subfunctions" class="code">function figData = analyzeSingleGeneDeletionStrain_MG_210(figHandle, geneID, deletionData, wtData, figData)</a>
2952             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
2953             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
2954             import edu.stanford.covert.cell.sim.util.PlotUtil;
2955             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
2956             
2957             <span class="comment">%% constants</span>
2958             perturbations = struct;
2959             perturbations.geneticKnockouts = {geneID};
2960             
2961             sim = CachedSimulationObjectUtil.load();
2962             sim.applyOptions(<span class="string">'lengthSec'</span>, 0);
2963             sim.applyOptions(perturbations);
2964             
2965             g = sim.gene;
2966             mass = sim.state(<span class="string">'Mass'</span>);
2967             r = sim.state(<span class="string">'Rna'</span>);
2968             pm = sim.state(<span class="string">'ProteinMonomer'</span>);
2969             pc = sim.state(<span class="string">'ProteinComplex'</span>);
2970             mr = sim.state(<span class="string">'MetabolicReaction'</span>);
2971             ppII = sim.process(<span class="string">'ProteinProcessingII'</span>);
2972             
2973             pcComp = sum(pc.proteinComplexComposition(g.mRNAIndexs, :, :), 3);
2974             monIdxs = [ppII.lipoproteinMonomerIndexs; ppII.secretedMonomerIndexs];
2975             unprocessedMonIdxs = ppII.unprocessedMonomerIndexs;
2976             cpxIdxs = find(any(pcComp(monIdxs, :), 1));
2977             
2978             cellInitialDryWeight = mass.cellInitialDryWeight;
2979             rnaExp = r.expression;
2980             rnaDecayRates = r.decayRates;
2981             monDecayRates = pm.decayRates;
2982             cpxDecayRates = pc.decayRates;
2983             
2984             <span class="comment">%% data</span>
2985             maxTime = NaN;
2986             data = {deletionData, wtData};
2987             <span class="keyword">for</span> i = 1:numel(data)
2988                 maxTime = max(maxTime, data{i}.time(end));
2989             <span class="keyword">end</span>
2990             
2991             <span class="keyword">if</span> nargin &gt;= 5 &amp;&amp; ~isempty(figData)
2992                 nSamples = figData.nSamples;
2993                 nGenerations = figData.nGenerations;
2994                 generations = figData.generations;
2995             <span class="keyword">else</span>
2996                 nSamples = 20;
2997                 nGenerations = 10;
2998                 generations = 1:nGenerations;
2999                 
3000                 figData = struct;
3001                 figData.data = cell(nGenerations, 1);
3002                 figData.nSamples = nSamples;
3003                 figData.nGenerations = nGenerations;
3004                 figData.generations = generations;
3005                 
3006                 <span class="keyword">for</span> i = 1:nGenerations
3007                     growths = zeros(4, nSamples);
3008                     <span class="keyword">for</span> j = 1:5
3009                         <span class="keyword">for</span> k = 1:nSamples
3010                             r.expression = rnaExp;
3011                             r.decayRates = rnaDecayRates;
3012                             pm.decayRates = monDecayRates;
3013                             pc.decayRates = cpxDecayRates;
3014                             mass.cellInitialDryWeight = cellInitialDryWeight * exp(log(2) * (j - 1) / 4);
3015                             mr.initialGrowthFilterWidth = Inf;
3016                             
3017                             sim.applyOptions(<span class="string">'seed'</span>, i * nGenerations + j * 5 +  k);
3018                             sim.allocateMemoryForState(1);
3019                             sim.initializeState();
3020                             sim.applyPerturbations();
3021                             
3022                             mons = pm.counts;
3023                             cpxs = pc.counts;
3024                             
3025                             pm.counts(pm.processedIIIndexs(monIdxs),    :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.processedIIIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3026                             pm.counts(pm.signalSequenceIndexs(monIdxs), :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.signalSequenceIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3027                             pm.counts(pm.foldedIndexs(monIdxs),         :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.foldedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3028                             pm.counts(pm.matureIndexs(monIdxs),         :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.matureIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3029                             pm.counts(pm.inactivatedIndexs(monIdxs),    :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.inactivatedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3030                             pm.counts(pm.boundIndexs(monIdxs),          :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.boundIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3031                             pm.counts(pm.misfoldedIndexs(monIdxs),      :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.misfoldedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3032                             pm.counts(pm.damagedIndexs(monIdxs),        :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.damagedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3033                             
3034                             pc.counts(pc.nascentIndexs(cpxIdxs),     :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.nascentIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3035                             pc.counts(pc.matureIndexs(cpxIdxs),      :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.matureIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3036                             pc.counts(pc.inactivatedIndexs(cpxIdxs), :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.inactivatedIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3037                             pc.counts(pc.boundIndexs(cpxIdxs),       :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.boundIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3038                             pc.counts(pc.misfoldedIndexs(cpxIdxs),   :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.misfoldedIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3039                             pc.counts(pc.damagedIndexs(cpxIdxs),     :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.damagedIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3040                             
3041                             diffMons = <span class="keyword">...</span>
3042                                 + mons(pm.processedIIIndexs,    :) - pm.counts(pm.processedIIIndexs, :) <span class="keyword">...</span>
3043                                 + mons(pm.signalSequenceIndexs, :) - pm.counts(pm.signalSequenceIndexs, :) <span class="keyword">...</span>
3044                                 + mons(pm.foldedIndexs,         :) - pm.counts(pm.foldedIndexs, :) <span class="keyword">...</span>
3045                                 + mons(pm.matureIndexs,         :) - pm.counts(pm.matureIndexs, :) <span class="keyword">...</span>
3046                                 + mons(pm.inactivatedIndexs,    :) - pm.counts(pm.inactivatedIndexs, :) <span class="keyword">...</span>
3047                                 + mons(pm.boundIndexs,          :) - pm.counts(pm.boundIndexs, :) <span class="keyword">...</span>
3048                                 + mons(pm.misfoldedIndexs,      :) - pm.counts(pm.misfoldedIndexs, :) <span class="keyword">...</span>
3049                                 + mons(pm.damagedIndexs,        :) - pm.counts(pm.damagedIndexs, :);
3050                             diffCpxs = <span class="keyword">...</span>
3051                                 + cpxs(pc.nascentIndexs,     :) - pc.counts(pc.nascentIndexs, :) <span class="keyword">...</span>
3052                                 + cpxs(pc.matureIndexs,      :) - pc.counts(pc.matureIndexs, :) <span class="keyword">...</span>
3053                                 + cpxs(pc.inactivatedIndexs, :) - pc.counts(pc.inactivatedIndexs, :) <span class="keyword">...</span>
3054                                 + cpxs(pc.boundIndexs,       :) - pc.counts(pc.boundIndexs, :) <span class="keyword">...</span>
3055                                 + cpxs(pc.misfoldedIndexs,   :) - pc.counts(pc.misfoldedIndexs, :) <span class="keyword">...</span>
3056                                 + cpxs(pc.damagedIndexs,     :) - pc.counts(pc.damagedIndexs, :);
3057                             pm.counts(pm.processedIIndexs, :) = <span class="keyword">...</span>
3058                                 + pm.counts(pm.processedIIndexs, :) <span class="keyword">...</span>
3059                                 + diffMons;
3060                             pm.counts(pm.processedIIndexs(monIdxs), :) = <span class="keyword">...</span>
3061                                 + pm.counts(pm.processedIIndexs(monIdxs), :) <span class="keyword">...</span>
3062                                 + pcComp(monIdxs, :) * diffCpxs;
3063                             pm.counts(pm.matureIndexs(unprocessedMonIdxs), :) = <span class="keyword">...</span>
3064                                 + pm.counts(pm.matureIndexs(unprocessedMonIdxs), :) <span class="keyword">...</span>
3065                                 + pcComp(unprocessedMonIdxs, :) * diffCpxs;
3066                             
3067                             sim.evolveState();
3068                             growths(j, k) = mr.growth;
3069                         <span class="keyword">end</span>
3070                     <span class="keyword">end</span>
3071                     figData.data{i} = struct;
3072                     figData.data{i}.time = cumsum([ 0; log(2) ./ mean(growths(1:end-1, :), 2) .* exp(log(2) * (0:j-2)'/4) / 4]) / 3600;
3073                     figData.data{i}.growth = mean(growths, 2) * 3600 * cellInitialDryWeight / (1 - mass.fractionWetWeight) * 1e15;
3074                     figData.data{i}.growths = growths * 3600 * cellInitialDryWeight / (1 - mass.fractionWetWeight) * 1e15;
3075                     figData.data{i}.simEndTimes = j;
3076                 <span class="keyword">end</span>
3077             <span class="keyword">end</span>
3078             
3079             <span class="comment">%% plot data</span>
3080             clf(figHandle);
3081             
3082             options = struct;
3083             options.colWidths = [2.4 0.5 2.4];
3084             options.yAxesLabelWidths = [0.14 0.01 0.01];
3085             options.xlabelStr = {<span class="string">'Time (h)'</span>, [], <span class="string">'Generation'</span>};
3086             [axesHandles, xAxesHandles] = PlotUtil.multiElementPlot(figHandle, {50; 50; 50}, {[0 maxTime] [0 maxTime] generations([1 end])}, options);
3087             delete(xAxesHandles{2});
3088             
3089             colors = PlotUtil.getRedGreenColorOrder(1:nGenerations);
3090             colors = [
3091                 colors(1, :)
3092                 0 1 1
3093                 colors(1:<span class="keyword">end</span>, :)
3094                 ];
3095             classLabels = [
3096                 {<span class="string">'Generation 1 (Full Model)'</span>}
3097                 cellfun(@(i) [<span class="string">'Generation '</span> num2str(i)], num2cell((1:nGenerations)'), <span class="string">'UniformOutput'</span>, false)
3098                 {<span class="string">'Wild-type'</span>}
3099                 ];
3100             SingleGeneDeletions.plotSingleGeneDeletionTemporalDynamics(axesHandles{1}(1), axesHandles{2}(1), <span class="keyword">...</span>
3101                 [data figData.data'], 1:nGenerations+2, classLabels, [false; true; false(size(figData.data))], <span class="string">'growth'</span>, <span class="string">'Growth (fg h^{-1})'</span>, colors);
3102             
3103             axesHandle = axesHandles{3}(1);
3104             growths = [];
3105             groups = [];
3106             <span class="keyword">for</span> i = 1:nGenerations
3107                 growths = [growths figData.data{i}.growths(1, :)];
3108                 groups = [groups repmat(generations(i), 1, nSamples)];
3109             <span class="keyword">end</span>
3110             boxplot(growths, groups, <span class="string">'Parent'</span>, axesHandle);
3111             ylim(axesHandle, ylim(axesHandles{1}(1)));
3112             set(axesHandle, <span class="string">'YTick'</span>, []);
3113         <span class="keyword">end</span>
3114         
3115         <span class="comment">%methionine aminopeptidase</span>
3116         <a name="_sub26" href="#_subfunctions" class="code">function figData = analyzeSingleGeneDeletionStrain_MG_172(figHandle, geneID, deletionData, wtData, figData)</a>
3117             import edu.stanford.covert.cell.sim.analysis.SingleGeneDeletions;
3118             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
3119             import edu.stanford.covert.cell.sim.util.PlotUtil;
3120             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
3121             
3122             <span class="comment">%% constants</span>
3123             perturbations = struct;
3124             perturbations.geneticKnockouts = {geneID};
3125             
3126             sim = CachedSimulationObjectUtil.load();
3127             sim.applyOptions(<span class="string">'lengthSec'</span>, 0);
3128             sim.applyOptions(perturbations);
3129             
3130             g = sim.gene;
3131             mass = sim.state(<span class="string">'Mass'</span>);
3132             r = sim.state(<span class="string">'Rna'</span>);
3133             pm = sim.state(<span class="string">'ProteinMonomer'</span>);
3134             pc = sim.state(<span class="string">'ProteinComplex'</span>);
3135             mr = sim.state(<span class="string">'MetabolicReaction'</span>);
3136             ppI = sim.process(<span class="string">'ProteinProcessingI'</span>);
3137             met = sim.process(<span class="string">'Metabolism'</span>);
3138             
3139             sim.setForTest(<span class="string">'processesInInitOrder'</span>, sim.processesInInitOrder(~ismember(<span class="keyword">...</span>
3140                 cellfun(@(p) p.name, sim.processesInInitOrder, <span class="string">'UniformOutput'</span>, false), {<span class="keyword">...</span>
3141                 <span class="string">'Transcription'</span>
3142                 <span class="string">'FtsZPolymerization'</span>
3143                 <span class="string">'ChromosomeCondensation'</span>
3144                 <span class="string">'Translation'</span>
3145                 <span class="string">'DNASupercoiling'</span>
3146                 <span class="string">'ReplicationInitiation'</span>
3147                 })));
3148             
3149             pcComp = sum(pc.proteinComplexComposition(g.mRNAIndexs, :, :), 3);
3150             monIdxs = ppI.nascentMonomerNTerminalMethionineCleavages;
3151             unprocessedMonIdxs = ~ppI.nascentMonomerNTerminalMethionineCleavages;
3152             cpxIdxs = find(any(pcComp(monIdxs, :), 1));
3153             
3154             cellInitialDryWeight = mass.cellInitialDryWeight;
3155             rnaExp = r.expression;
3156             rnaDecayRates = r.decayRates;
3157             monDecayRates = pm.decayRates;
3158             cpxDecayRates = pc.decayRates;
3159             
3160             <span class="comment">%% data</span>
3161             maxTime = NaN;
3162             data = {deletionData, wtData};
3163             <span class="keyword">for</span> i = 1:numel(data)
3164                 maxTime = max(maxTime, data{i}.time(end));
3165             <span class="keyword">end</span>
3166             
3167             <span class="keyword">if</span> nargin &gt;= 5 &amp;&amp; ~isempty(figData)
3168                 nSamples = figData.nSamples;
3169                 nGenerations = figData.nGenerations;
3170                 generations = figData.generations;
3171             <span class="keyword">else</span>
3172                 nSamples = 20;
3173                 nGenerations = 10;
3174                 generations = 1:nGenerations;
3175                 
3176                 figData = struct;
3177                 figData.data = cell(nGenerations, 1);
3178                 figData.nSamples = nSamples;
3179                 figData.nGenerations = nGenerations;
3180                 figData.generations = generations;
3181                 
3182                 <span class="keyword">for</span> i = 1:nGenerations
3183                     growths = zeros(4, nSamples);
3184                     <span class="keyword">for</span> j = 1:5
3185                         <span class="keyword">for</span> k = 1:nSamples
3186                             r.expression = rnaExp;
3187                             r.decayRates = rnaDecayRates;
3188                             pm.decayRates = monDecayRates;
3189                             pc.decayRates = cpxDecayRates;
3190                             mass.cellInitialDryWeight = cellInitialDryWeight * exp(log(2) * (j - 1) / 4);
3191                             mr.initialGrowthFilterWidth = Inf;
3192                                                         
3193                             sim.applyOptions(<span class="string">'seed'</span>, i * nGenerations + j * 5 +  k);
3194                             sim.allocateMemoryForState(1);
3195                             sim.initializeState();
3196                             sim.applyPerturbations();
3197                             
3198                             mons = pm.counts;
3199                             cpxs = pc.counts;
3200                             
3201                             pm.counts(pm.processedIIIndexs(monIdxs),    :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.processedIIIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3202                             pm.counts(pm.signalSequenceIndexs(monIdxs), :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.signalSequenceIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3203                             pm.counts(pm.foldedIndexs(monIdxs),         :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.foldedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3204                             pm.counts(pm.matureIndexs(monIdxs),         :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.matureIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3205                             pm.counts(pm.inactivatedIndexs(monIdxs),    :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.inactivatedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3206                             pm.counts(pm.boundIndexs(monIdxs),          :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.boundIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3207                             pm.counts(pm.misfoldedIndexs(monIdxs),      :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.misfoldedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3208                             pm.counts(pm.damagedIndexs(monIdxs),        :) = pm.randStream.random(<span class="string">'binomial'</span>, pm.counts(pm.damagedIndexs(monIdxs), :), 1 / (2.^(generations(i) - 1)));
3209                             
3210                             pc.counts(pc.nascentIndexs(cpxIdxs),     :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.nascentIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3211                             pc.counts(pc.matureIndexs(cpxIdxs),      :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.matureIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3212                             pc.counts(pc.inactivatedIndexs(cpxIdxs), :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.inactivatedIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3213                             pc.counts(pc.boundIndexs(cpxIdxs),       :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.boundIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3214                             pc.counts(pc.misfoldedIndexs(cpxIdxs),   :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.misfoldedIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3215                             pc.counts(pc.damagedIndexs(cpxIdxs),     :) = pc.randStream.random(<span class="string">'binomial'</span>, pc.counts(pc.damagedIndexs(cpxIdxs), :), 1 / (2.^(generations(i) - 1)));
3216                             
3217                             diffMons = <span class="keyword">...</span>
3218                                 + mons(pm.processedIIIndexs,    :) - pm.counts(pm.processedIIIndexs, :) <span class="keyword">...</span>
3219                                 + mons(pm.signalSequenceIndexs, :) - pm.counts(pm.signalSequenceIndexs, :) <span class="keyword">...</span>
3220                                 + mons(pm.foldedIndexs,         :) - pm.counts(pm.foldedIndexs, :) <span class="keyword">...</span>
3221                                 + mons(pm.matureIndexs,         :) - pm.counts(pm.matureIndexs, :) <span class="keyword">...</span>
3222                                 + mons(pm.inactivatedIndexs,    :) - pm.counts(pm.inactivatedIndexs, :) <span class="keyword">...</span>
3223                                 + mons(pm.boundIndexs,          :) - pm.counts(pm.boundIndexs, :) <span class="keyword">...</span>
3224                                 + mons(pm.misfoldedIndexs,      :) - pm.counts(pm.misfoldedIndexs, :) <span class="keyword">...</span>
3225                                 + mons(pm.damagedIndexs,        :) - pm.counts(pm.damagedIndexs, :);
3226                             diffCpxs = <span class="keyword">...</span>
3227                                 + cpxs(pc.nascentIndexs,     :) - pc.counts(pc.nascentIndexs, :) <span class="keyword">...</span>
3228                                 + cpxs(pc.matureIndexs,      :) - pc.counts(pc.matureIndexs, :) <span class="keyword">...</span>
3229                                 + cpxs(pc.inactivatedIndexs, :) - pc.counts(pc.inactivatedIndexs, :) <span class="keyword">...</span>
3230                                 + cpxs(pc.boundIndexs,       :) - pc.counts(pc.boundIndexs, :) <span class="keyword">...</span>
3231                                 + cpxs(pc.misfoldedIndexs,   :) - pc.counts(pc.misfoldedIndexs, :) <span class="keyword">...</span>
3232                                 + cpxs(pc.damagedIndexs,     :) - pc.counts(pc.damagedIndexs, :);
3233                             pm.counts(pm.processedIIndexs, :) = <span class="keyword">...</span>
3234                                 + pm.counts(pm.processedIIndexs, :) <span class="keyword">...</span>
3235                                 + diffMons;
3236                             pm.counts(pm.processedIIndexs(monIdxs), :) = <span class="keyword">...</span>
3237                                 + pm.counts(pm.processedIIndexs(monIdxs), :) <span class="keyword">...</span>
3238                                 + pcComp(monIdxs, :) * diffCpxs;
3239                             pm.counts(pm.matureIndexs(unprocessedMonIdxs), :) = <span class="keyword">...</span>
3240                                 + pm.counts(pm.matureIndexs(unprocessedMonIdxs), :) <span class="keyword">...</span>
3241                                 + pcComp(unprocessedMonIdxs, :) * diffCpxs;
3242                             
3243                             processes = sim.processes;
3244                             sim.setForTest(<span class="string">'processes'</span>, {met});
3245                             sim.evolveState();
3246                             sim.setForTest(<span class="string">'processes'</span>, processes);
3247                             
3248                             growths(j, k) = mr.growth;
3249                         <span class="keyword">end</span>
3250                     <span class="keyword">end</span>
3251                     figData.data{i} = struct;
3252                     figData.data{i}.time = cumsum([ 0; log(2) ./ mean(growths(1:end-1, :), 2) .* exp(log(2) * (0:j-2)'/4) / 4]) / 3600;
3253                     figData.data{i}.growth = mean(growths, 2) * 3600 * cellInitialDryWeight / (1 - mass.fractionWetWeight) * 1e15;
3254                     figData.data{i}.growths = growths * 3600 * cellInitialDryWeight / (1 - mass.fractionWetWeight) * 1e15;
3255                     figData.data{i}.simEndTimes = j;
3256                 <span class="keyword">end</span>
3257             <span class="keyword">end</span>
3258             
3259             <span class="comment">%% plot data</span>
3260             clf(figHandle);
3261             
3262             options = struct;
3263             options.colWidths = [2.4 0.5 2.4];
3264             options.yAxesLabelWidths = [0.14 0.01 0.01];
3265             options.xlabelStr = {<span class="string">'Time (h)'</span>, [], <span class="string">'Generation'</span>};
3266             [axesHandles, xAxesHandles] = PlotUtil.multiElementPlot(figHandle, {50; 50; 50}, {[0 maxTime] [0 maxTime] generations([1 end])}, options);
3267             delete(xAxesHandles{2});
3268             
3269             colors = PlotUtil.getRedGreenColorOrder(1:nGenerations);
3270             colors = [
3271                 colors(1, :)
3272                 0 1 1
3273                 colors(1:<span class="keyword">end</span>, :)
3274                 ];
3275             classLabels = [
3276                 {<span class="string">'Generation 1 (Full Model)'</span>}
3277                 cellfun(@(i) [<span class="string">'Generation '</span> num2str(i)], num2cell((1:nGenerations)'), <span class="string">'UniformOutput'</span>, false)
3278                 {<span class="string">'Wild-type'</span>}
3279                 ];
3280             SingleGeneDeletions.plotSingleGeneDeletionTemporalDynamics(axesHandles{1}(1), axesHandles{2}(1), <span class="keyword">...</span>
3281                 [data figData.data'], 1:nGenerations+2, classLabels, [false; true; false(size(figData.data))], <span class="string">'growth'</span>, <span class="string">'Growth (fg h^{-1})'</span>, colors);
3282             
3283             axesHandle = axesHandles{3}(1);
3284             growths = [];
3285             groups = [];
3286             <span class="keyword">for</span> i = 1:nGenerations
3287                 growths = [growths figData.data{i}.growths(1, :)];
3288                 groups = [groups repmat(generations(i), 1, nSamples)];
3289             <span class="keyword">end</span>
3290             boxplot(growths, groups, <span class="string">'Parent'</span>, axesHandle);
3291             ylim(axesHandle, ylim(axesHandles{1}(1)));
3292             set(axesHandle, <span class="string">'YTick'</span>, []);
3293         <span class="keyword">end</span>
3294     <span class="keyword">end</span>
3295     
3296     <span class="comment">%helper methods</span>
3297     methods (Static = true)
3298         <a name="_sub27" href="#_subfunctions" class="code">function [deletionDoublingTimes, wtDoublingTime] = getExperimentalDoublingTimes(sim)</a>
3299             import edu.stanford.covert.cell.sim.util.CachedSimulationObjectUtil;
3300             import edu.stanford.covert.cell.sim.util.SimulationDiskUtil;
3301             
3302             <span class="keyword">if</span> nargin &lt; 1
3303                 sim = CachedSimulationObjectUtil.load();
3304             <span class="keyword">end</span>
3305             g = sim.gene;
3306             
3307             <span class="comment">%read data</span>
3308             [~, ~, raw] = xlsread(<span class="string">'data/singleGeneDeletions.xls'</span>, <span class="string">'Doubling Time'</span>, <span class="string">'A1:AA100'</span>, <span class="string">'basic'</span>);
3309             colLabels = raw(2, :);
3310             strainIDs = raw(3:<span class="keyword">end</span>, strcmp(colLabels, <span class="string">'ID'</span>));
3311             strainMeanDoublingTimes = cell2mat(raw(3:<span class="keyword">end</span>, strcmp(colLabels, <span class="string">'Mean (h)'</span>)));
3312             strainStdDoublingTimes = cell2mat(raw(3:<span class="keyword">end</span>, strcmp(colLabels, <span class="string">'Standard Deviation (h)'</span>)));
3313             strainNumReplicateDoublingTimes = cell2mat(raw(3:<span class="keyword">end</span>, strcmp(colLabels, <span class="string">'No. Replicates'</span>)));
3314             
3315             <span class="comment">%wild-type growth rate</span>
3316             wtDoublingTime = NaN(1, 3);
3317             wtDoublingTime(1, 1) = strainMeanDoublingTimes(ismember(strainIDs, <span class="string">'WT'</span>));
3318             wtDoublingTime(1, 2) = strainStdDoublingTimes(ismember(strainIDs, <span class="string">'WT'</span>));
3319             wtDoublingTime(1, 3) = strainNumReplicateDoublingTimes(ismember(strainIDs, <span class="string">'WT'</span>));
3320             
3321             <span class="comment">%deletion growth rates</span>
3322             deletionDoublingTimes = NaN(size(g.wholeCellModelIDs, 1), 3);
3323             
3324             deletionDoublingTimes(strcmp(g.essential, <span class="string">'Y'</span>), 1) = 0;
3325             deletionDoublingTimes(strcmp(g.essential, <span class="string">'Y'</span>), 2) = NaN;
3326             deletionDoublingTimes(strcmp(g.essential, <span class="string">'Y'</span>), 3) = 0;
3327             
3328             [tfs, idxs] = ismember(strainIDs, g.wholeCellModelIDs);
3329             deletionDoublingTimes(idxs(tfs), 1) = strainMeanDoublingTimes(tfs);
3330             deletionDoublingTimes(idxs(tfs), 2) = strainStdDoublingTimes(tfs);
3331             deletionDoublingTimes(idxs(tfs), 3) = strainNumReplicateDoublingTimes(tfs);
3332             deletionDoublingTimes(isnan(deletionDoublingTimes(:, 1)), 2) = wtDoublingTime(1, 2);
3333             deletionDoublingTimes(isnan(deletionDoublingTimes(:, 1)), 3) = 0;
3334             deletionDoublingTimes(isnan(deletionDoublingTimes(:, 1)), 1) = wtDoublingTime(1, 1);
3335         <span class="keyword">end</span>
3336         
3337         <a name="_sub28" href="#_subfunctions" class="code">function [tfs, molecules, processes] = getGeneImplementations(sim)</a>
3338             g = sim.gene;
3339             
3340             tfs = false(size(g.wholeCellModelIDs));
3341             molecules = repmat({{}}, size(g.wholeCellModelIDs));
3342             processes = repmat({{}}, size(g.wholeCellModelIDs));
3343             
3344             <span class="keyword">for</span> i = 1:length(sim.processes)
3345                 m = sim.processes{i};
3346                 
3347                 <span class="comment">%stimuli</span>
3348                 stimuliGeneComposition = m.stimuliGeneComposition();
3349                 <span class="keyword">for</span> j = 1:length(sim.gene.wholeCellModelIDs)
3350                     <span class="keyword">for</span> k = 1:length(m.stimuliWholeCellModelIDs)
3351                         <span class="keyword">if</span> ~stimuliGeneComposition(j, k)
3352                             <span class="keyword">continue</span>;
3353                         <span class="keyword">end</span>
3354                         
3355                         tfs(j) = true;
3356                         molecules{j} = [molecules{j}; m.stimuliWholeCellModelIDs(k)];
3357                         processes{j} = [processes{j}; m.wholeCellModelID];
3358                     <span class="keyword">end</span>
3359                 <span class="keyword">end</span>
3360                 
3361                 <span class="comment">%substrates</span>
3362                 substrateGeneComposition = m.substrateGeneComposition();
3363                 <span class="keyword">for</span> j = 1:length(sim.gene.wholeCellModelIDs)
3364                     <span class="keyword">for</span> k = 1:length(m.substrateWholeCellModelIDs)
3365                         <span class="keyword">if</span> ~substrateGeneComposition(j, k)
3366                             <span class="keyword">continue</span>;
3367                         <span class="keyword">end</span>
3368                         
3369                         tfs(j) = true;
3370                         molecules{j} = [molecules{j}; m.substrateWholeCellModelIDs(k)];
3371                         processes{j} = [processes{j}; m.wholeCellModelID];
3372                     <span class="keyword">end</span>
3373                 <span class="keyword">end</span>
3374                 
3375                 <span class="comment">%enzymes</span>
3376                 enzymeGeneComposition = m.enzymeGeneComposition();
3377                 <span class="keyword">for</span> j = 1:length(sim.gene.wholeCellModelIDs)
3378                     <span class="keyword">for</span> k = 1:length(m.enzymeWholeCellModelIDs)
3379                         <span class="keyword">if</span> ~enzymeGeneComposition(j, k)
3380                             <span class="keyword">continue</span>;
3381                         <span class="keyword">end</span>
3382                         
3383                         tfs(j) = true;
3384                         molecules{j} = [molecules{j}; m.enzymeWholeCellModelIDs(k)];
3385                         processes{j} = [processes{j}; m.wholeCellModelID];
3386                     <span class="keyword">end</span>
3387                 <span class="keyword">end</span>
3388             <span class="keyword">end</span>
3389         <span class="keyword">end</span>
3390     <span class="keyword">end</span>
3391 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 19-Jul-2012 18:32:13 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>