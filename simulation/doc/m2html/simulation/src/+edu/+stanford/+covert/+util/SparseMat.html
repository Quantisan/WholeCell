<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of SparseMat</title>
  <meta name="keywords" content="SparseMat">
  <meta name="description" content="SparseMat">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../../index.html">Home</a> &gt;  <a href="../../../../../index.html">simulation</a> &gt; <a href="#">src</a> &gt; <a href="#">+edu</a> &gt; <a href="#">+stanford</a> &gt; <a href="#">+covert</a> &gt; <a href="index.html">+util</a> &gt; SparseMat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../../index.html"><img alt="<" border="0" src="../../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for simulation/src/+edu/+stanford/+covert/+util&nbsp;<img alt=">" border="0" src="../../../../../../right.png"></a></td></tr></table>-->

<h1>SparseMat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../../up.png"></a></h2>
<div class="box"><strong>SparseMat</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> SparseMat
   Multidimensional sparse matrix with support for
   - subscript reference/assignment
   - sizing (isempty, numel, nnz, size, ndims, nnz, reshape, repmat, squeeze,
     transpose, ctranspose, permute)
   - concatenation
   - logical operators
   - relational operators
   - element-wise algebra
   - reduction (eg. all, any, min, max, range, sum, mean, var, std, collapse,
     norm)
   - find
   - isinf, isfinite, isnan
   - type casting
   - abs, sign, sqrt, realsqrt, exp, expm1, log, logp1, log2, log10, reallog
   - complex numbers (ctranspose, conf, real, imag, isreal, angle)

 Author: Jonathan Karr
 Affilitation: Covert Lab, Department of Bioengineering, Stanford University
 Last updated: 7/18/2010</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../../matlabicon.gif)">
<li><a href="CircularSparseMat.html" class="code" title="">CircularSparseMat</a>	CircularSparseMat</li><li><a href="SparseMat.html" class="code" title="">SparseMat</a>	SparseMat</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../../../matlabicon.gif)">
<li><a href="SparseMat.html" class="code" title="">SparseMat</a>	SparseMat</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function this = SparseMat(varargin)</a></li><li><a href="#_sub2" class="code">function inds = get.inds(this)</a></li><li><a href="#_sub3" class="code">function val = isempty(this)</a></li><li><a href="#_sub4" class="code">function n = numel(this)</a></li><li><a href="#_sub5" class="code">function n = nnz(this)</a></li><li><a href="#_sub6" class="code">function l = length(this)</a></li><li><a href="#_sub7" class="code">function siz = size(this, k)</a></li><li><a href="#_sub8" class="code">function n = ndims(this)</a></li><li><a href="#_sub9" class="code">function this = reshape(this, varargin)</a></li><li><a href="#_sub10" class="code">function this = repmat(this, varargin)</a></li><li><a href="#_sub11" class="code">function this = transpose(this)</a></li><li><a href="#_sub12" class="code">function this = ctranspose(this)</a></li><li><a href="#_sub13" class="code">function this = permute(this, dims)</a></li><li><a href="#_sub14" class="code">function this = squeeze(this)</a></li><li><a href="#_sub15" class="code">function inds = sub2ind(this, subs, siz)</a></li><li><a href="#_sub16" class="code">function subs = ind2sub(this, inds, siz)</a></li><li><a href="#_sub17" class="code">function this = subsasgn(this, s, rhs)</a></li><li><a href="#_sub18" class="code">function value = subsref(this, s)</a></li><li><a href="#_sub19" class="code">function inds = subsindex(this)</a></li><li><a href="#_sub20" class="code">function e = end(this, k, ~)</a></li><li><a href="#_sub21" class="code">function this = normalize(this, reSize, reFind, reSort, ~)</a></li><li><a href="#_sub22" class="code">function this = cat(dim, varargin)</a></li><li><a href="#_sub23" class="code">function this = horzcat(this, varargin)</a></li><li><a href="#_sub24" class="code">function this = vertcat(this, varargin)</a></li><li><a href="#_sub25" class="code">function this = padarray(this, padsize, padval, direction)</a></li><li><a href="#_sub26" class="code">function this = abs(this)</a></li><li><a href="#_sub27" class="code">function this = sign(this)</a></li><li><a href="#_sub28" class="code">function C = sqrt(A)</a></li><li><a href="#_sub29" class="code">function C = realsqrt(A)</a></li><li><a href="#_sub30" class="code">function C = exp(A)</a></li><li><a href="#_sub31" class="code">function C = expm1(A)</a></li><li><a href="#_sub32" class="code">function C = log(A)</a></li><li><a href="#_sub33" class="code">function C = log2(A)</a></li><li><a href="#_sub34" class="code">function C = log10(A)</a></li><li><a href="#_sub35" class="code">function C = log1p(A)</a></li><li><a href="#_sub36" class="code">function C = reallog(A)</a></li><li><a href="#_sub37" class="code">function this = real(this)</a></li><li><a href="#_sub38" class="code">function this = imag(this)</a></li><li><a href="#_sub39" class="code">function this = angle(this)</a></li><li><a href="#_sub40" class="code">function this = conj(this)</a></li><li><a href="#_sub41" class="code">function this = isreal(this)</a></li><li><a href="#_sub42" class="code">function this = not(this)</a></li><li><a href="#_sub43" class="code">function C = or(A, B)</a></li><li><a href="#_sub44" class="code">function C = and(A, B)</a></li><li><a href="#_sub45" class="code">function C = xor(A, B)</a></li><li><a href="#_sub46" class="code">function C = nor(A, B)</a></li><li><a href="#_sub47" class="code">function C = nand(A, B)</a></li><li><a href="#_sub48" class="code">function this = uminus(this)</a></li><li><a href="#_sub49" class="code">function this = uplus(this)</a></li><li><a href="#_sub50" class="code">function C = plus(A, B)</a></li><li><a href="#_sub51" class="code">function C = minus(A,B)</a></li><li><a href="#_sub52" class="code">function C = times(A,B)</a></li><li><a href="#_sub53" class="code">function C = rdivide(A, B)</a></li><li><a href="#_sub54" class="code">function C = ldivide(A, B)</a></li><li><a href="#_sub55" class="code">function C = mtimes(A, B)</a></li><li><a href="#_sub56" class="code">function C = tprod(A, B, Aid, Bid)</a></li><li><a href="#_sub57" class="code">function C = mrdivide(A, B)</a></li><li><a href="#_sub58" class="code">function C = mldivide(A, B)</a></li><li><a href="#_sub59" class="code">function C = power(A, B)</a></li><li><a href="#_sub60" class="code">function C = mpower(A, B)</a></li><li><a href="#_sub61" class="code">function val = isequal(A, B)</a></li><li><a href="#_sub62" class="code">function assertElementsAlmostEqual(A, B, varargin)</a></li><li><a href="#_sub63" class="code">function C = eq(A, B)</a></li><li><a href="#_sub64" class="code">function C = ne(A,B)</a></li><li><a href="#_sub65" class="code">function C = ge(A,B)</a></li><li><a href="#_sub66" class="code">function C = gt(A,B)</a></li><li><a href="#_sub67" class="code">function C = le(A,B)</a></li><li><a href="#_sub68" class="code">function C = lt(A,B)</a></li><li><a href="#_sub69" class="code">function val = unique(this)</a></li><li><a href="#_sub70" class="code">function B = all(A, dim)</a></li><li><a href="#_sub71" class="code">function B = any(A, dim)</a></li><li><a href="#_sub72" class="code">function C = min(A, B, dim)</a></li><li><a href="#_sub73" class="code">function C = max(A, B, dim)</a></li><li><a href="#_sub74" class="code">function C = range(A, dim)</a></li><li><a href="#_sub75" class="code">function C = sum(A, dim)</a></li><li><a href="#_sub76" class="code">function C = mean(A, dim)</a></li><li><a href="#_sub77" class="code">function C = var(A, flag, dim)</a></li><li><a href="#_sub78" class="code">function C = std(A, flag, dim)</a></li><li><a href="#_sub79" class="code">function C = collapse(A, dim)</a></li><li><a href="#_sub80" class="code">function C = norm(A, option)</a></li><li><a href="#_sub81" class="code">function [subs, vals] = find(this)</a></li><li><a href="#_sub82" class="code">function subs = randomlySelectZeros(this, n, randStream)</a></li><li><a href="#_sub83" class="code">function this = isnan(this)</a></li><li><a href="#_sub84" class="code">function this = isinf(this)</a></li><li><a href="#_sub85" class="code">function this = isfinite(this)</a></li><li><a href="#_sub86" class="code">function type = valueClass(this)</a></li><li><a href="#_sub87" class="code">function val = full(this)</a></li><li><a href="#_sub88" class="code">function val = sparse(this)</a></li><li><a href="#_sub89" class="code">function val = cast(this, newclass)</a></li><li><a href="#_sub90" class="code">function this = valueCast(this, newclass)</a></li><li><a href="#_sub91" class="code">function val = char(this)</a></li><li><a href="#_sub92" class="code">function val = logical(this)</a></li><li><a href="#_sub93" class="code">function val = int8(this)</a></li><li><a href="#_sub94" class="code">function val = int16(this)</a></li><li><a href="#_sub95" class="code">function val = int32(this)</a></li><li><a href="#_sub96" class="code">function val = int64(this)</a></li><li><a href="#_sub97" class="code">function val = uint8(this)</a></li><li><a href="#_sub98" class="code">function val = uint16(this)</a></li><li><a href="#_sub99" class="code">function val = uint32(this)</a></li><li><a href="#_sub100" class="code">function val = uint64(this)</a></li><li><a href="#_sub101" class="code">function val = single(this)</a></li><li><a href="#_sub102" class="code">function val = double(this)</a></li><li><a href="#_sub103" class="code">function val = sptensor(this)</a></li><li><a href="#_sub104" class="code">function [subs2, I, J] = unique_subs(subs, siz)</a></li><li><a href="#_sub105" class="code">function tf = isunique_subs(subs, siz)</a></li><li><a href="#_sub106" class="code">function [subs, order] = sort_subs(subs, siz, colSortOrder)</a></li><li><a href="#_sub107" class="code">function [tfs, idxs] = ismember_subs(subs1, subs2, siz)</a></li><li><a href="#_sub108" class="code">function [C,IA,IB] = intersect_subs(subs1, subs2, siz)</a></li><li><a href="#_sub109" class="code">function val = issorted_subs(subs, siz)</a></li><li><a href="#_sub110" class="code">function toDisk(spmat, fileName)</a></li><li><a href="#_sub111" class="code">function ret = fromDisk(fileName, dim1, dim2, dim3)</a></li><li><a href="#_sub112" class="code">function ret = binSearch(m, value, low, high, col, lowerend)</a></li><li><a href="#_sub113" class="code">function disp(this)</a></li><li><a href="#_sub114" class="code">function display(this)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% SparseMat</span>
0002 <span class="comment">%   Multidimensional sparse matrix with support for</span>
0003 <span class="comment">%   - subscript reference/assignment</span>
0004 <span class="comment">%   - sizing (isempty, numel, nnz, size, ndims, nnz, reshape, repmat, squeeze,</span>
0005 <span class="comment">%     transpose, ctranspose, permute)</span>
0006 <span class="comment">%   - concatenation</span>
0007 <span class="comment">%   - logical operators</span>
0008 <span class="comment">%   - relational operators</span>
0009 <span class="comment">%   - element-wise algebra</span>
0010 <span class="comment">%   - reduction (eg. all, any, min, max, range, sum, mean, var, std, collapse,</span>
0011 <span class="comment">%     norm)</span>
0012 <span class="comment">%   - find</span>
0013 <span class="comment">%   - isinf, isfinite, isnan</span>
0014 <span class="comment">%   - type casting</span>
0015 <span class="comment">%   - abs, sign, sqrt, realsqrt, exp, expm1, log, logp1, log2, log10, reallog</span>
0016 <span class="comment">%   - complex numbers (ctranspose, conf, real, imag, isreal, angle)</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% Author: Jonathan Karr</span>
0019 <span class="comment">% Affilitation: Covert Lab, Department of Bioengineering, Stanford University</span>
0020 <span class="comment">% Last updated: 7/18/2010</span>
0021 classdef <a href="SparseMat.html" class="code" title="">SparseMat</a>
0022     properties (SetAccess = protected)
0023         subs
0024         vals
0025         siz
0026     <span class="keyword">end</span>
0027     
0028     properties (Dependent = true, SetAccess = protected)
0029         inds
0030     <span class="keyword">end</span>
0031     
0032     <span class="comment">%constructor</span>
0033     methods
0034         <span class="comment">%three ways to instatiate:</span>
0035         <span class="comment">%(1) x = SparseMat()</span>
0036         <span class="comment">%    Creates an empty sparse matrix of size 0x2</span>
0037         <span class="comment">%</span>
0038         <span class="comment">%(2) x = SparseMat(mat)</span>
0039         <span class="comment">%    Casts matrix mat to sparse matrix</span>
0040         <span class="comment">%</span>
0041         <span class="comment">%(3) x = SparseMat(subs, vals, sz)</span>
0042         <span class="comment">%    Creates sparse matrix with size sz and non-zeros with subscripts</span>
0043         <span class="comment">%    subs and values vals</span>
0044         <a name="_sub0" href="#_subfunctions" class="code">function this = SparseMat(varargin)</a>
0045             import edu.stanford.covert.util.SparseMat;
0046             
0047             <span class="keyword">switch</span> nargin
0048                 <span class="keyword">case</span> 3
0049                     subs = varargin{1};
0050                     vals = varargin{2};
0051                     siz = varargin{3};
0052                     
0053                     <span class="keyword">if</span> ~<a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs)); subs = zeros(0, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2)); <span class="keyword">end</span>;
0054                     <span class="keyword">if</span> ~<a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals)); vals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(0, 1), class(vals)); <span class="keyword">end</span>;
0055                     <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(vals) == 1; vals = vals(ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1), 1); <span class="keyword">end</span>;
0056                     
0057                     <span class="comment">%squeeze trailing singleton dimensions</span>
0058                     idx = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(2, <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(siz ~= 1, 1, <span class="string">'last'</span>));
0059                     <span class="keyword">if</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(idx)
0060                         <span class="keyword">if</span> ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(subs(:, idx+1:end) == 1)
0061                             throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Index exceeds matrix dimensions.'</span>))
0062                         <span class="keyword">end</span>
0063                         siz = siz(:, 1:idx);
0064                     <span class="keyword">end</span>
0065                     <span class="keyword">if</span> <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 2) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2) &amp;&amp; <a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(subs(:, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2) + 1:end) == 1))
0066                         subs = subs(:, 1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz,2));
0067                     <span class="keyword">end</span>
0068                     
0069                     <span class="keyword">if</span> <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 2) ~= <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2)
0070                         throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'dimensions of subs must equal length of siz'</span>));
0071                     <span class="keyword">elseif</span> <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1) ~= <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals, 1)
0072                         throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'numbers of subs and vals must be equal'</span>));
0073                     <span class="keyword">elseif</span> <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals, 2) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
0074                         throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'length of second dimension of vals can be at most 1'</span>));
0075                     <span class="keyword">elseif</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(siz &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0 | siz ~= ceil(siz))
0076                         throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'siz must be non-negative integers'</span>));
0077                     <span class="keyword">elseif</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(subs &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 | subs ~= ceil(subs))
0078                         throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'subs must be positive integers'</span>));
0079                     <span class="keyword">elseif</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(subs) &amp;&amp; <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(<a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(subs, [], 1) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; siz)
0080                         throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'subs cannot be greater than lengths of dimensions'</span>));
0081                     <span class="keyword">end</span>
0082                     
0083                     <span class="keyword">if</span> ~this.isunique_subs(subs, siz)
0084                         [~, idxs] = <a href="#_sub69" class="code" title="subfunction val = unique(this)">unique</a>(subs, <span class="string">'rows'</span>, <span class="string">'last'</span>);
0085                         warning(<span class="string">'SparseMat:invalidAssignment'</span>, <span class="string">'subscripts are repeated, setting element to last value'</span>)
0086                         subs = subs(idxs, :);
0087                         vals = vals(idxs, :);
0088                     <span class="keyword">end</span>
0089                     
0090                     this.siz  = siz;
0091                     this.subs = subs;
0092                     this.vals = vals;
0093                     
0094                     this = this.normalize(true, true, true, zeros(1, this.ndims));
0095                 <span class="keyword">case</span> 0
0096                     this.siz = [0 2];
0097                     this.subs = zeros(0,2);
0098                     this.vals = zeros(0,1);
0099                 <span class="keyword">case</span> 1
0100                     arg = varargin{1};
0101                     <span class="keyword">if</span> isstruct(arg)
0102                         this.subs = arg.subs;
0103                         this.vals = arg.vals;
0104                         this.siz = arg.siz;
0105                     <span class="keyword">else</span>
0106                         this.siz = <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(arg);
0107                         
0108                         <span class="keyword">if</span> isa(arg,<span class="string">'SparseMat'</span>)
0109                             [this.subs, this.vals] = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(arg);
0110                         <span class="keyword">else</span>
0111                             [inds, ~, vals] = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(arg(:)); <span class="comment">%#ok&lt;*PROP&gt;</span>
0112                             this.subs = this.ind2sub(inds);
0113                             this.vals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(vals, class(arg));
0114                         <span class="keyword">end</span>
0115                         
0116                         this = this.normalize(true, false, false, zeros(1, this.ndims));
0117                     <span class="keyword">end</span>
0118                 <span class="keyword">otherwise</span>
0119                     throw(MException(<span class="string">'SparseMat:error'</span>,<span class="string">'no constructor matches the calling signature'</span>));
0120             <span class="keyword">end</span>
0121         <span class="keyword">end</span>
0122     <span class="keyword">end</span>
0123     
0124     <span class="comment">%getters</span>
0125     methods
0126         <a name="_sub1" href="#_subfunctions" class="code">function inds = get.inds(this)</a>
0127             inds = this.sub2ind(this.subs);
0128         <span class="keyword">end</span>
0129     <span class="keyword">end</span>
0130     
0131     <span class="comment">%size</span>
0132     methods
0133         <a name="_sub2" href="#_subfunctions" class="code">function val = isempty(this)</a>
0134             val = ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(this.siz);
0135         <span class="keyword">end</span>
0136         
0137         <a name="_sub3" href="#_subfunctions" class="code">function n = numel(this)</a>
0138             n = prod(this.siz);
0139         <span class="keyword">end</span>
0140         
0141         <a name="_sub4" href="#_subfunctions" class="code">function n = nnz(this)</a>
0142             n = <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 1);
0143         <span class="keyword">end</span>
0144         
0145         <a name="_sub5" href="#_subfunctions" class="code">function l = length(this)</a>
0146             l = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(this.siz);
0147         <span class="keyword">end</span>
0148         
0149         <a name="_sub6" href="#_subfunctions" class="code">function siz = size(this, k)</a>
0150             <span class="keyword">if</span> ~exist(<span class="string">'k'</span>,<span class="string">'var'</span>)
0151                 siz = this.siz;
0152             <span class="keyword">elseif</span> k &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || k~=ceil(k)
0153                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'k must be a positive integer'</span>))
0154             <span class="keyword">elseif</span> k &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.siz,2)
0155                 siz = 1;
0156             <span class="keyword">else</span>
0157                 siz = this.siz(k);
0158             <span class="keyword">end</span>
0159         <span class="keyword">end</span>
0160         
0161         <a name="_sub7" href="#_subfunctions" class="code">function n = ndims(this)</a>
0162             n = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(this.siz);
0163         <span class="keyword">end</span>
0164         
0165         <a name="_sub8" href="#_subfunctions" class="code">function this = reshape(this, varargin)</a>
0166             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin)==0
0167                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Not enough input arguments.'</span>));
0168             <span class="keyword">elseif</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin)==1
0169                 dims=varargin{1};
0170             <span class="keyword">else</span>
0171                 idxs = cellfun(@<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>,varargin);
0172                 <span class="keyword">if</span> <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(idxs)&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;1
0173                     throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Size can only have one unknown dimension.'</span>));
0174                 <span class="keyword">end</span>
0175                 dims = zeros(1, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin));
0176                 dims(~idxs) = cell2mat(varargin(~idxs));
0177                 dims(idxs) = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(0, this.numel/prod(dims(~idxs)));
0178             <span class="keyword">end</span>
0179             
0180             <span class="keyword">if</span> prod(dims) ~= this.numel
0181                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'the number of elements must not change'</span>));
0182             <span class="keyword">elseif</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(dims&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;0) || ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(isint(dims))
0183                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'dims must be non-negative integers'</span>))
0184             <span class="keyword">end</span>
0185             
0186             inds = this.inds;
0187             this.siz = dims;
0188             this.subs = this.ind2sub(inds);
0189             this = this.normalize(true, false, false, zeros(1,this.ndims));
0190         <span class="keyword">end</span>
0191         
0192         <a name="_sub9" href="#_subfunctions" class="code">function this = repmat(this, varargin)</a>
0193             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin) == 0
0194                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Not enough input arguments.'</span>));
0195             <span class="keyword">end</span>
0196             copies = cell2mat(varargin);
0197             <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(copies&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;0) || ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(isint(copies))
0198                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'copies must be non-negative integers'</span>))
0199             <span class="keyword">end</span>
0200             copies = copies(1:<a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(2,<a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(copies~=1, 1, <span class="string">'last'</span>)));
0201             len = <a href="#_sub6" class="code" title="subfunction l = length(this)">length</a>(copies);
0202             <span class="keyword">if</span> <a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(copies)
0203                 <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(copies&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;1)
0204                     subs = this.subs;
0205                     siz = this.siz;
0206                     subs(:,end+1:len) = 1;
0207                     siz(end+1:len) = 1;
0208                     <span class="keyword">for</span> i = 1:len
0209                         n = copies(i);
0210                         <span class="keyword">if</span> n &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
0211                             nVals = <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1);
0212                             subs = <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(subs, n, 1);
0213                             subs(nVals+1:<span class="keyword">end</span>,i) = subs(nVals+1:<span class="keyword">end</span>,i) + <span class="keyword">...</span>
0214                                 <a href="#_sub9" class="code" title="subfunction this = reshape(this, varargin)">reshape</a>(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(siz(i) * (1:n-1), [nVals 1]), [], 1);
0215                         <span class="keyword">end</span>
0216                     <span class="keyword">end</span>
0217                     this.subs = subs;
0218                     this.vals = <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(this.vals, prod(copies), 1);
0219                     this.siz(1:len) = siz(1:len) .* copies;
0220                     oldDims = 1 : this.ndims;
0221                     oldDims(copies ~= 1) = 0;
0222                     this = this.normalize(false, false, true, oldDims);
0223                 <span class="keyword">end</span>
0224             <span class="keyword">else</span>
0225                 this.subs = [];
0226                 this.vals = [];
0227                 this.siz(end+1:len) = 1;
0228                 this.siz(1:len) = this.siz(1:len) .* copies;
0229             <span class="keyword">end</span>
0230         <span class="keyword">end</span>
0231         
0232         <a name="_sub10" href="#_subfunctions" class="code">function this = transpose(this)</a>
0233             <span class="keyword">if</span> this.ndims &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 2
0234                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Transpose on ND array is not defined'</span>));
0235             <span class="keyword">end</span>
0236             this = this.permute([2 1]);
0237         <span class="keyword">end</span>
0238         
0239         <a name="_sub11" href="#_subfunctions" class="code">function this = ctranspose(this)</a>
0240             this = <a href="#_sub11" class="code" title="subfunction this = transpose(this)">transpose</a>(<a href="#_sub40" class="code" title="subfunction this = conj(this)">conj</a>(this));
0241         <span class="keyword">end</span>
0242         
0243         <a name="_sub12" href="#_subfunctions" class="code">function this = permute(this, dims)</a>
0244             <span class="keyword">if</span> ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(diff(sort(dims)))
0245                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'ORDER cannot contain repeated permutation indices'</span>))
0246             <span class="keyword">elseif</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(dims &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1) || ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(dims, ceil(dims))
0247                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'dims must be positive integers'</span>))
0248             <span class="keyword">elseif</span> <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(ismembc(dims, 1:this.ndims)) ~= this.ndims
0249                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'dims must contain each dimension of the matrix'</span>))
0250             <span class="keyword">end</span>
0251             
0252             oldDims = ismembc2(dims, 1:this.ndims);
0253             [~, idxs] = ismember(1:this.ndims, dims);
0254             
0255             subs = ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1), <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(dims));
0256             subs(:, idxs) = this.subs;
0257             
0258             siz = ones(1, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(dims));
0259             siz(:, idxs) = this.siz;
0260             
0261             this.subs = subs;
0262             this.siz = siz;
0263             
0264             this = this.normalize(true, false, true, oldDims);
0265         <span class="keyword">end</span>
0266         
0267         <a name="_sub13" href="#_subfunctions" class="code">function this = squeeze(this)</a>
0268             oldDims = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(this.siz~=1);
0269             dims = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(this.siz==1);
0270             this.subs(:,dims)=[];
0271             this.siz(:,dims)=[];
0272             
0273             <span class="keyword">if</span> this.ndims&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;2
0274                 this.subs = [this.subs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1), 2-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,2))];
0275                 this.siz = [this.siz ones(1, 2-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.siz,2))];
0276                 oldDims = [oldDims 0];
0277             <span class="keyword">end</span>
0278             
0279             this = this.normalize(false, false, false, oldDims);
0280         <span class="keyword">end</span>
0281         
0282         <a name="_sub14" href="#_subfunctions" class="code">function inds = sub2ind(this, subs, siz)</a>
0283             <span class="keyword">if</span> ~exist(<span class="string">'siz'</span>,<span class="string">'var'</span>)
0284                 siz = this.siz;
0285             <span class="keyword">end</span>
0286             
0287             mult = [1 cumprod(siz(1:end-1))];
0288             inds = (subs - 1) * mult' + 1;
0289         <span class="keyword">end</span>
0290         
0291         <a name="_sub15" href="#_subfunctions" class="code">function subs = ind2sub(this, inds, siz)</a>
0292             <span class="keyword">if</span> ~exist(<span class="string">'siz'</span>,<span class="string">'var'</span>)
0293                 siz = this.siz;
0294             <span class="keyword">end</span>
0295             
0296             n = <a href="#_sub6" class="code" title="subfunction l = length(this)">length</a>(siz);
0297             subs = zeros(<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(inds), n);
0298             
0299             <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(inds)
0300                 <span class="keyword">return</span>;
0301             <span class="keyword">end</span>
0302             
0303             k = [1 cumprod(siz(1:end-1))];
0304             inds = inds - 1;
0305             
0306             <span class="keyword">for</span> i = n : -1 : 1
0307                 subs(:,i) = floor(inds / k(i)) + 1;
0308                 inds = rem(inds, k(i));
0309             <span class="keyword">end</span>
0310         <span class="keyword">end</span>
0311     <span class="keyword">end</span>
0312     
0313     <span class="comment">%subscript reference, assignment</span>
0314     methods
0315         <span class="comment">%Supports three syntaxes</span>
0316         <span class="comment">%1. Dot assignment is referred to the super class subsasgn method.</span>
0317         <span class="comment">%2. Subscripts of elements, eg.</span>
0318         <span class="comment">%   x([r11, r21, ..., rN1; r21, r22, ..., rN2; ...])=y.</span>
0319         <span class="comment">%3. Subscripts ranges, eg. x(R1,R2,...,RN)=y where Rn are ranges.</span>
0320         <span class="comment">%</span>
0321         <span class="comment">%For Cases (2) and (3) y can either be a SparseMat or a builtin MATLAB</span>
0322         <span class="comment">%type. In these cases y will be cast to the class of x.vals (one of</span>
0323         <span class="comment">%MATLAB's builtin types).</span>
0324         <a name="_sub16" href="#_subfunctions" class="code">function this = subsasgn(this, s, rhs)</a>
0325             import edu.stanford.covert.util.SparseMat;
0326             
0327             <span class="comment">%Case 1: Dot reference to properties</span>
0328             <span class="keyword">if</span> strcmp(s.type,<span class="string">'.'</span>) || strcmp(s.type, <span class="string">'{}'</span>)
0329                 this = builtin(<span class="string">'subsasgn'</span>, this, s, rhs);
0330                 <span class="keyword">return</span>;
0331             <span class="keyword">end</span>
0332             
0333             rhs = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(rhs, <a href="#_sub86" class="code" title="subfunction type = valueClass(this)">valueClass</a>(this));
0334             
0335             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(s.subs)==1
0336                 <span class="comment">%Case 2: Subscripts of elements</span>
0337                 subs = s.subs{1};
0338                 
0339                 <span class="comment">%do nothing if subscripts are empty</span>
0340                 <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(subs)
0341                     <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs)~=1 &amp;&amp; ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs), [0 1])
0342                         throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>,<span class="string">'Subscripted assignment dimension mismatch.'</span>));
0343                     <span class="keyword">else</span>
0344                         <span class="keyword">return</span>;
0345                     <span class="keyword">end</span>
0346                 <span class="keyword">end</span>
0347                 
0348                 <span class="comment">%check that subscripts have 2 dimensions</span>
0349                 <span class="keyword">if</span> <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(subs) ~= 2 || <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,2)~= this.ndims
0350                     throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Subscripts must have number of columns equal to dimensions of matrix.'</span>));
0351                 <span class="keyword">end</span>
0352                 
0353                 <span class="comment">%check that subscripts are positive integers</span>
0354                 <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(<a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(subs&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;1)) || ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subs, ceil(<a href="#_sub37" class="code" title="subfunction this = real(this)">real</a>(subs)))
0355                     throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Subscript indices must either be real positive integers or logicals.'</span>));
0356                 <span class="keyword">end</span>
0357                 
0358                 <span class="comment">%check that subscripts are in range</span>
0359                 <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(<a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(subs,[],1) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; this.siz)
0360                     throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Index exceeds matrix dimensions.'</span>));
0361                 <span class="keyword">end</span>
0362                 
0363                 <span class="comment">%check that rhs isn't empty</span>
0364                 <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(rhs)
0365                     throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>,<span class="string">'Subscripted assignment dimension mismatch.'</span>));
0366                 <span class="keyword">end</span>
0367                 
0368                 <span class="comment">%check that rhs is vector</span>
0369                 <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1 &amp;&amp; <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs)&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;1)&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;1
0370                     throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>,<span class="string">'Subscripted assignment dimension mismatch.'</span>));
0371                 <span class="keyword">end</span>
0372                 rhs = rhs(:);
0373                 
0374                 <span class="comment">%check that rhs size matches that of subscripts</span>
0375                 <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1 &amp;&amp; <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs)~=<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1)
0376                     throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>,<span class="string">'Subscripted assignment dimension mismatch.'</span>));
0377                 <span class="keyword">end</span>
0378                 
0379                 <span class="comment">%remove duplicates</span>
0380                 <span class="keyword">if</span> this.isunique_subs(subs, this.siz)
0381                     idxs = (1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1))';
0382                 <span class="keyword">else</span>
0383                     [subs, idxs] = <a href="#_sub69" class="code" title="subfunction val = unique(this)">unique</a>(subs, <span class="string">'rows'</span>, <span class="string">'last'</span>);
0384                     warning(<span class="string">'SparseMat:invalidAssignment'</span>,<span class="string">'subscripts are repeated, setting element to last value'</span>)
0385                 <span class="keyword">end</span>
0386                 
0387                 <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
0388                     sref = struct(<span class="string">'type'</span>, <span class="string">'()'</span>, <span class="string">'subs'</span>, []);
0389                     sref.subs = {idxs, 1};
0390                     rhs = <a href="#_sub18" class="code" title="subfunction value = subsref(this, s)">subsref</a>(rhs, sref);
0391                 <span class="keyword">end</span>
0392                 
0393                 <span class="comment">%assign</span>
0394                 [tfs, idxs] = this.ismember_subs(subs, this.subs, this.siz);
0395                 <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) == 1
0396                     <span class="keyword">if</span> isa(rhs,<span class="string">'SparseMat'</span>)
0397                         rhs = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(rhs);
0398                     <span class="keyword">end</span>
0399                     
0400                     <span class="keyword">if</span> rhs == 0
0401                         this.subs(idxs(tfs),:) = [];
0402                         this.vals(idxs(tfs),:) = [];
0403                     <span class="keyword">else</span>
0404                         this.vals(idxs(tfs),:) = rhs;
0405                         
0406                         this.subs = [this.subs; subs(~tfs,:)];
0407                         this.vals = [this.vals; rhs(ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1)-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.vals,1), 1), 1)];
0408                         this = this.normalize(false, false, true, 1:this.ndims);
0409                     <span class="keyword">end</span>
0410                 <span class="keyword">elseif</span> isa(rhs, <span class="string">'SparseMat'</span>)
0411                     sref = struct(<span class="string">'type'</span>, <span class="string">'()'</span>, <span class="string">'subs'</span>, []);
0412                     sref.subs = {<a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(tfs), 1};
0413                     this.vals(idxs(tfs),:) = <a href="#_sub18" class="code" title="subfunction value = subsref(this, s)">subsref</a>(rhs, sref);
0414                     
0415                     [subIdxs, rhsIdxs] = intersect(rhs.subs(:,1), <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs));
0416                     
0417                     this.subs = [this.subs; subs(subIdxs, :)];
0418                     this.vals = [this.vals; rhs.vals(rhsIdxs, :)];
0419                     this = this.normalize(false, true, true, 1:this.ndims);
0420                 <span class="keyword">else</span>
0421                     this.vals(idxs(tfs),:) = rhs(tfs,:);
0422                     
0423                     idxs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs &amp; rhs);
0424                     this.subs = [this.subs; subs(idxs, :)];
0425                     this.vals = [this.vals; rhs(idxs, :)];
0426                     this = this.normalize(false, true, true, 1:this.ndims);
0427                 <span class="keyword">end</span>
0428             <span class="keyword">else</span>
0429                 <span class="comment">%Case 3: Subscripts ranges</span>
0430                 subs = s.subs;
0431                 
0432                 <span class="comment">%Do all short circuting and error checking before extraction to</span>
0433                 <span class="comment">%avoid doing the work of extraction if isn't going to be</span>
0434                 <span class="comment">%necessary</span>
0435                 <span class="comment">%1. check that subcripts of dimensions beyond that of the matrix</span>
0436                 <span class="comment">%   are either : or 1.</span>
0437                 <span class="comment">%2. check if any subs{n} is empty</span>
0438                 <span class="comment">%3. check that subscripts are vectors, are within range, and are</span>
0439                 <span class="comment">%   real positive integers</span>
0440                 <span class="comment">%4. if fewer subscripts provided than dimensions of matrix, assume</span>
0441                 <span class="comment">%   all missing subscripts are 1</span>
0442                 
0443                 <span class="comment">%compute size that RHS must be</span>
0444                 lhsSiz = zeros(1, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs));
0445                 <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0446                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; (subs{n} == <span class="string">':'</span>)
0447                         <span class="keyword">if</span> n &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; this.ndims
0448                             lhsSiz(n) = -1;
0449                         <span class="keyword">else</span>
0450                             lhsSiz(n) = this.siz(n);
0451                         <span class="keyword">end</span>
0452                     <span class="keyword">else</span>
0453                         lhsSiz(n) = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs{n});
0454                     <span class="keyword">end</span>
0455                 <span class="keyword">end</span>
0456                 
0457                 <span class="comment">%check RHS size matches that of subscripts</span>
0458                 rhsSiz = <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs);
0459                 lhsDims = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(lhsSiz ~= 1);
0460                 rhsDims = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(rhsSiz ~= 1);
0461                 <span class="keyword">if</span> ~<a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(rhsSiz)
0462                     throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>, <span class="string">'RHS cannot be null.'</span>));
0463                 <span class="keyword">elseif</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) ~= 1
0464                     <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsDims) ~= <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhsDims)
0465                         throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>, <span class="string">'Subscripted assignment dimension mismatch.'</span>));
0466                     <span class="keyword">end</span>
0467                     
0468                     <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsDims)
0469                         <span class="keyword">if</span> lhsSiz(lhsDims(n)) == -1
0470                             <span class="keyword">if</span> lhsDims(n) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; this.ndms  &amp;&amp; rhsSiz(rhsDims(b)) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
0471                                 throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>, <span class="string">'Subscripted assignment dimension mismatch.'</span>));
0472                             <span class="keyword">end</span>
0473                             subs{lhsDims(n)} = (1:rhsSiz(rhsDims(n)))';
0474                             lhsSiz(lhsDims(n)) = rhsSize(rhsDims(n));
0475                         <span class="keyword">end</span>
0476                     <span class="keyword">end</span>
0477                     
0478                     <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(lhsSiz(lhsSiz ~= 1), rhsSiz(rhsSiz ~= 1))
0479                         throw(MException(<span class="string">'SparseMat:invalidAssignment'</span>, <span class="string">'Subscripted assignment dimension mismatch.'</span>));
0480                     <span class="keyword">end</span>
0481                 <span class="keyword">else</span>
0482                     <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsSiz)
0483                         <span class="keyword">if</span> lhsSiz(i) == -1;
0484                             subs{i} = 1;
0485                             lhsSiz(i) = 1;
0486                         <span class="keyword">end</span>
0487                     <span class="keyword">end</span>
0488                 <span class="keyword">end</span>
0489                 
0490                 <span class="keyword">if</span> ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(lhsSiz)
0491                     <span class="keyword">return</span>;
0492                 <span class="keyword">elseif</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
0493                     rhs = <a href="#_sub9" class="code" title="subfunction this = reshape(this, varargin)">reshape</a>(rhs, lhsSiz);
0494                 <span class="keyword">end</span>
0495                 
0496                 <span class="comment">% reshape subscripts to vectors, and check subscripts are real</span>
0497                 <span class="comment">% positive integers</span>
0498                 <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0499                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0500                         <span class="keyword">continue</span>;
0501                     <span class="keyword">end</span>
0502                     
0503                     <span class="comment">%reshape subs{n} to vector</span>
0504                     <span class="keyword">if</span> ~(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs{n}, 2) == 1 &amp;&amp; <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(subs{n}) == 2)
0505                         subs{n} = subs{n}(:);
0506                     <span class="keyword">end</span>
0507                     
0508                     <span class="comment">%check that subscripts are positive integers</span>
0509                     <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(subs{n} &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1) || ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subs{n}, ceil(<a href="#_sub37" class="code" title="subfunction this = real(this)">real</a>(subs{n})))
0510                         throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>, <span class="string">'Subscript indices must either be real positive integers or logicals.'</span>));
0511                     <span class="keyword">end</span>
0512                 <span class="keyword">end</span>
0513                 
0514                 <span class="comment">%remove duplicates</span>
0515                 <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsDims)
0516                     n = lhsDims(i);
0517                     
0518                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0519                         <span class="keyword">continue</span>;
0520                     <span class="keyword">end</span>
0521                     
0522                     <span class="keyword">if</span> isscalar(subs{n}) || edu.stanford.covert.util.SetUtil.isunique(subs{n})
0523                         oldIdxs = (1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs{n}))';
0524                     <span class="keyword">else</span>
0525                         [subs{n}, oldIdxs] = <a href="#_sub69" class="code" title="subfunction val = unique(this)">unique</a>(subs{n}, <span class="string">'last'</span>);
0526                         warning(<span class="string">'SparseMat:invalidAssignment'</span>, <span class="string">'subscripts are repeated, setting element to last value'</span>);
0527                     <span class="keyword">end</span>
0528                     
0529                     lhsSiz(n) = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs{n});
0530                     
0531                     <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
0532                         m = rhsDims(i);
0533                         
0534                         <span class="keyword">if</span> isa(rhs, <span class="string">'SparseMat'</span>)
0535                             newIdxs = (1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs{n}, 1))';
0536                             [tfs, idxs] = ismember(rhs.subs(:, m), oldIdxs);
0537                             rhs.subs(tfs, m) = newIdxs(idxs(tfs));
0538                             rhs.subs(~tfs, :) = [];
0539                             rhs.vals(~tfs, :) = [];
0540                         <span class="keyword">else</span>
0541                             sref = struct(<span class="string">'type'</span>, <span class="string">'()'</span>, <span class="string">'subs'</span>, []);
0542                             sref.subs = num2cell(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(<span class="string">':'</span>, 1, <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(rhs)));
0543                             sref.subs{m} = oldIdxs;
0544                             rhs = <a href="#_sub18" class="code" title="subfunction value = subsref(this, s)">subsref</a>(rhs, sref);
0545                         <span class="keyword">end</span>
0546                     <span class="keyword">end</span>
0547                 <span class="keyword">end</span>
0548                 
0549                 <span class="comment">% if fewer subscripts provided than dimensions of matrix, assume</span>
0550                 <span class="comment">% all missing subscripts are 1</span>
0551                 <span class="keyword">for</span> n = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs) + 1:this.ndims
0552                     subs{n} = ones(1, 1);
0553                     lhsSiz(n) = 1;
0554                 <span class="keyword">end</span>
0555                 
0556                 <span class="comment">%compute new size</span>
0557                 siz = [this.siz ones(1, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.siz, 2))];
0558                 <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0559                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0560                         siz(n) = lhsSiz(n);
0561                     <span class="keyword">else</span>
0562                         siz(n) = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(siz(n), <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(subs{n}));
0563                     <span class="keyword">end</span>
0564                 <span class="keyword">end</span>
0565                 
0566                 <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) == 1
0567                     siz(siz == -1) = 1;
0568                 <span class="keyword">else</span>
0569                     ansDims = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(siz ~= 1);
0570                     rhsDims = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(rhsSiz ~= 1);
0571                     siz(ansDims(siz(ansDims) == -1)) = rhsSiz(rhsDims(siz(ansDims) == -1));
0572                 <span class="keyword">end</span>
0573                 
0574                 <span class="comment">% Delete what currently occupies the specified range</span>
0575                 deleteRange = true;
0576                 <span class="keyword">for</span> n = this.ndims + 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0577                     <span class="keyword">if</span> isnumeric(subs{n}) &amp;&amp; ~<a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(subs{n} == 1)
0578                         deleteRange = false;
0579                     <span class="keyword">end</span>
0580                 <span class="keyword">end</span>
0581                 
0582                 <span class="keyword">if</span> deleteRange
0583                     delIdxs = 1:this.nnz;
0584                     <span class="keyword">for</span> n = 1:this.ndims
0585                         <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0586                             <span class="keyword">continue</span>;
0587                         <span class="keyword">end</span>
0588                         
0589                         delIdxs = delIdxs(ismembc(this.subs(delIdxs, n), sort(subs{n})));
0590                     <span class="keyword">end</span>
0591                     
0592                     this.subs(delIdxs, :) = [];
0593                     this.vals(delIdxs, :) = [];
0594                 <span class="keyword">end</span>
0595                 
0596                 <span class="comment">%assign</span>
0597                 orginalDims = [1:this.ndims zeros(1, this.ndims - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2))];
0598                 orginalDims(this.siz ~= siz(1:this.ndims)) = 0;
0599                 
0600                 <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhs) == 1
0601                     <span class="keyword">if</span> isa(rhs, <span class="string">'SparseMat'</span>)
0602                         rhs = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(rhs);
0603                     <span class="keyword">end</span>
0604                     
0605                     <span class="keyword">if</span> rhs~=0
0606                         newsubs = zeros(prod(lhsSiz), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(lhsSiz, 2));
0607                         <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0608                             subsSize = lhsSiz;
0609                             subsSize(n) = 1;
0610                             <span class="keyword">if</span> n == 1
0611                                 subsDims = [1 2];
0612                             <span class="keyword">else</span>
0613                                 subsDims = n:-1:1;
0614                             <span class="keyword">end</span>
0615                             <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0616                                 newsubs(:, n) = <a href="#_sub9" class="code" title="subfunction this = reshape(this, varargin)">reshape</a>(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(<a href="#_sub13" class="code" title="subfunction this = permute(this, dims)">permute</a>((1:siz(n))', subsDims), subsSize), [], 1);
0617                             <span class="keyword">else</span>
0618                                 newsubs(:, n) = <a href="#_sub9" class="code" title="subfunction this = reshape(this, varargin)">reshape</a>(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(<a href="#_sub13" class="code" title="subfunction this = permute(this, dims)">permute</a>(subs{n}, subsDims), subsSize), [], 1);
0619                             <span class="keyword">end</span>
0620                         <span class="keyword">end</span>
0621                         
0622                         this.siz = siz;
0623                         this.subs = [this.subs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 1), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(lhsSiz, 2) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 2));
0624                             newsubs];
0625                         this.vals = [this.vals;
0626                             rhs(ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(newsubs, 1), 1), 1)];
0627                     <span class="keyword">end</span>
0628                 <span class="keyword">else</span>
0629                     <span class="keyword">if</span> ~isa(rhs,<span class="string">'SparseMat'</span>)
0630                         rhs = <a href="SparseMat.html" class="code" title="">SparseMat</a>(rhs);
0631                     <span class="keyword">end</span>
0632                     
0633                     ndim = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>([<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs.subs, 2) <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs) <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsSiz) <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhsSiz) <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(siz)]);
0634                     
0635                     rhs.subs = [rhs.subs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs.subs, 1), ndim-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs.subs, 2))];
0636                     rhsSubs = [rhs.subs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs.subs, 1), ndim-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhs.subs, 2))];
0637                     subs(<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsSiz) + 1:ndim) = {1};
0638                     lhsSiz = [lhsSiz ones(1, ndim - <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsSiz))];
0639                     rhsSiz = [rhsSiz ones(1, ndim - <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(rhsSiz))];
0640                     siz = [siz ones(1, ndim - <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(siz))];
0641                     lhsDims = [<a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(lhsSiz ~= 1) <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(lhsSiz == 1)];
0642                     rhsDims = [<a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(rhsSiz ~= 1) <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(rhsSiz == 1)];
0643                     <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(lhsDims)
0644                         n = lhsDims(i);
0645                         m = rhsDims(i);
0646                         <span class="keyword">if</span> isnumeric(subs{n})
0647                             rhsSubs(:,m) = subs{n}(rhs.subs(:, m));
0648                         <span class="keyword">else</span>
0649                             tmpsubs = (1:siz(n))';
0650                             rhsSubs(:,m) = tmpsubs(rhs.subs(:, m));
0651                         <span class="keyword">end</span>
0652                     <span class="keyword">end</span>
0653                     
0654                     this.siz = siz;
0655                     this.subs = [this.subs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 1), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhsSubs, 2) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 2));
0656                         rhsSubs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhsSubs, 1), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 2)-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(rhsSubs, 2))];
0657                     this.vals = [this.vals;
0658                         rhs.vals];
0659                 <span class="keyword">end</span>
0660                 
0661                 this = this.normalize(true, false, true, orginalDims);
0662             <span class="keyword">end</span>
0663         <span class="keyword">end</span>
0664         
0665         <span class="comment">%Supports three syntaxes</span>
0666         <span class="comment">%1. Dot reference is referred to the super class subsref method.</span>
0667         <span class="comment">%2. Subscripts of elements, eg.</span>
0668         <span class="comment">%   y=x([r11, r21, ..., rN1; r21, r22, ..., rN2; ...]). This returns a</span>
0669         <span class="comment">%   matrix of type equal to that of the type of the vals property (that</span>
0670         <span class="comment">%   is a matrix of one of MATLAB's builtin types).</span>
0671         <span class="comment">%3. Subscripts ranges, eg. y=x(R1,R2,...,RN) where Rn are ranges. This</span>
0672         <span class="comment">%   returns an object of SparseMat type</span>
0673         <a name="_sub17" href="#_subfunctions" class="code">function value = subsref(this, s)</a>
0674             import edu.stanford.covert.util.SparseMat;
0675             
0676             <span class="comment">%Case 1: Dot reference to properties</span>
0677             <span class="keyword">if</span> strcmp(s.type,<span class="string">'.'</span>) || strcmp(s.type, <span class="string">'{}'</span>)
0678                 value = builtin(<span class="string">'subsref'</span>, this, s);
0679                 <span class="keyword">return</span>;
0680             <span class="keyword">end</span>
0681             
0682             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(s.subs) == 1
0683                 <span class="comment">%Case 2: Subscripts of elements</span>
0684                 subs = s.subs{1};
0685                 
0686                 <span class="comment">%check that subscripts have 2 dimensions</span>
0687                 <span class="keyword">if</span> <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(subs) ~= 2 || <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,2) ~= this.ndims
0688                     throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Subscripts must have 2 dimensions.'</span>));
0689                 <span class="keyword">end</span>
0690                 
0691                 <span class="comment">%check that subscripts are real positive integers</span>
0692                 validateattributes(subs, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>, <span class="string">'positive'</span>, <span class="string">'integer'</span>});
0693                 
0694                 <span class="comment">%check that subscripts are in range</span>
0695                 <span class="keyword">if</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(subs) &amp;&amp; <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(<a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(subs,[],1) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; this.siz)
0696                     throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Index exceeds matrix dimensions.'</span>));
0697                 <span class="keyword">end</span>
0698                 
0699                 <span class="comment">%extract</span>
0700                 [tfs, idxs] = this.ismember_subs(subs, this.subs, this.siz);
0701                 <span class="keyword">switch</span> class(this.vals)
0702                     <span class="keyword">case</span> <span class="string">'logical'</span>
0703                         value = false(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1),1);
0704                     <span class="keyword">case</span> <span class="string">'char'</span>
0705                         value = <a href="#_sub91" class="code" title="subfunction val = char(this)">char</a>(zeros(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1),1));
0706                     <span class="keyword">otherwise</span>
0707                         value = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1),1), class(this.vals));
0708                 <span class="keyword">end</span>
0709                 
0710                 value(tfs) = this.vals(idxs(tfs),:);
0711             <span class="keyword">else</span>
0712                 <span class="comment">%Case 3: Subscript ranges</span>
0713                 subs = s.subs;
0714                 
0715                 <span class="comment">%Do all short circuting and error checking before extraction to</span>
0716                 <span class="comment">%avoid doing the work of extraction if isn't going to be</span>
0717                 <span class="comment">%necessary</span>
0718                 <span class="comment">%1. check that subcripts of dimensions beyond that of the matrix</span>
0719                 <span class="comment">%   are either : or 1.</span>
0720                 <span class="comment">%2. check if any subs{n} is empty</span>
0721                 <span class="comment">%3. check that subscripts are vectors, are within range, and are</span>
0722                 <span class="comment">%   real positive integers</span>
0723                 <span class="comment">%4. if fewer subscripts provided than dimensions of matrix, assume</span>
0724                 <span class="comment">%   all missing subscripts are 1</span>
0725                 
0726                 <span class="comment">%check that subcripts of dimensions beyond that of the matrix</span>
0727                 <span class="comment">%are either : or 1.</span>
0728                 <span class="keyword">for</span> n = this.ndims+1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0729                     <span class="keyword">if</span> ~((ischar(subs{n}) &amp;&amp; (subs{n} == <span class="string">':'</span>)) || (isnumeric(subs{n}) &amp;&amp; <a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(subs{n}(:)==1)))
0730                         throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Index exceeds matrix dimensions.'</span>));
0731                     <span class="keyword">end</span>
0732                 <span class="keyword">end</span>
0733                 subs = subs(1:<a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs),this.ndims));
0734                 
0735                 <span class="comment">%compute size of return value</span>
0736                 originalDims = zeros(1, this.ndims);
0737                 newsiz = zeros(1, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs));
0738                 <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0739                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0740                         newsiz(n) = this.siz(n);
0741                         originalDims(n) = n;
0742                     <span class="keyword">else</span>
0743                         newsiz(n) = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs{n});
0744                     <span class="keyword">end</span>
0745                 <span class="keyword">end</span>
0746                 
0747                 <span class="comment">%check if any subs{n} is empty</span>
0748                 <span class="keyword">if</span> ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(newsiz)
0749                     value = this;
0750                     value.subs = zeros(0, this.ndims);
0751                     value.vals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(0, 1), class(this.vals));
0752                     value.siz = [newsiz ones(1, this.ndims - <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(newsiz))];
0753                     value = value.normalize(true, false, false, [originalDims zeros(1, this.ndims - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(originalDims,2))]);
0754                     <span class="keyword">return</span>;
0755                 <span class="keyword">end</span>
0756                 
0757                 <span class="comment">% check that subscripts are vectors, are within range, and are</span>
0758                 <span class="comment">% real positive integers</span>
0759                 <span class="keyword">for</span> n = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0760                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0761                         <span class="keyword">continue</span>;
0762                     <span class="keyword">end</span>
0763                     
0764                     <span class="comment">%check that subs{n} is vector</span>
0765                     validateattributes(subs, {<span class="string">'cell'</span>}, {<span class="string">'vector'</span>});
0766                     subs{n} = subs{n}(:);
0767                     
0768                     <span class="comment">%check that subscripts are real positive integers in range</span>
0769                     validateattributes(subs{n}, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>, <span class="string">'positive'</span>, <span class="string">'integer'</span>, <span class="string">'&lt;='</span>, this.siz(n)});
0770                 <span class="keyword">end</span>
0771                 
0772                 <span class="comment">% if fewer subscripts provided than dimensions of matrix, assume</span>
0773                 <span class="comment">% all missing subscripts are 1</span>
0774                 <span class="keyword">for</span> n = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs) + 1:this.ndims
0775                     subs{n} = ones(1, 1);
0776                     newsiz(n) = 1;
0777                 <span class="keyword">end</span>
0778                 
0779                 <span class="comment">%extract in order of new lengths of dimensions</span>
0780                 [~, order] = sort(newsiz);
0781                 newsubs = this.subs;
0782                 newvals = this.vals;
0783                 <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(subs)
0784                     n = order(i);
0785                     
0786                     <span class="keyword">if</span> ischar(subs{n}) &amp;&amp; subs{n} == <span class="string">':'</span>
0787                         <span class="keyword">continue</span>;
0788                     <span class="keyword">elseif</span> isscalar(subs{n})
0789                         tfs = subs{n} == newsubs(:, n);
0790                         newsubs = [newsubs(tfs, 1:n-1) ones(<a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(tfs), 1) newsubs(tfs, n+1:end)];
0791                         newvals = newvals(tfs, :);
0792                     <span class="keyword">elseif</span> <a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(diff(subs{n}(:)))
0793                         tmpsubs = zeros(0, this.ndims);
0794                         tmpvals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(0, 1), class(this.vals));
0795                         tmp = subs{n};
0796                         <span class="keyword">for</span> j = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(tmp)
0797                             tfs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(newsubs(:, n) == tmp(j));
0798                             tmpsubs = [tmpsubs; newsubs(tfs, 1:n-1) j(ones(<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(tfs), 1)) newsubs(tfs, n+1:end)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0799                             tmpvals = [tmpvals; newvals(tfs, :)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0800                         <span class="keyword">end</span>
0801                         
0802                         newsubs = tmpsubs;
0803                         newvals = tmpvals;
0804                     <span class="keyword">else</span>
0805                         [tmp, ~, idxs] = this.unique_subs(subs{n}, this.siz(n));
0806                         tmpsubs = zeros(0, this.ndims);
0807                         tmpvals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(0, 1), class(this.vals));
0808                         <span class="keyword">for</span> j = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(tmp)
0809                             idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(idxs == j);
0810                             m = <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(idxs1);
0811                             idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(tmp(j) == newsubs(:, n));
0812                             idxs1 = idxs1(:)';
0813                             idxs2 = idxs2(:);
0814                             idxs1 = idxs1(ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(idxs2)), :);
0815                             idxs2 = idxs2(:, ones(m));
0816                             idxs1 = idxs1(:);
0817                             idxs2 = idxs2(:);
0818                             tmpsubs = [tmpsubs; newsubs(idxs2, 1:n-1) idxs1 newsubs(idxs2, n+1:end)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0819                             tmpvals = [tmpvals; newvals(idxs2, :)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0820                         <span class="keyword">end</span>
0821                         
0822                         newsubs = tmpsubs;
0823                         newvals = tmpvals;
0824                     <span class="keyword">end</span>
0825                 <span class="keyword">end</span>
0826                 
0827                 value = this;
0828                 value.subs = newsubs;
0829                 value.vals = newvals;
0830                 value.siz = newsiz;
0831                 value = value.normalize(true, false, true, [originalDims zeros(1, this.ndims - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(originalDims,2))]);
0832             <span class="keyword">end</span>
0833         <span class="keyword">end</span>
0834         
0835         <a name="_sub18" href="#_subfunctions" class="code">function inds = subsindex(this) </a><span class="comment">%#ok&lt;STOUT,MANU&gt;</span>
0836             throw(MException(<span class="string">'SparseMat:unsupportedSyntax'</span>, <span class="string">'Function not implemented'</span>));
0837         <span class="keyword">end</span>
0838         
0839         <a name="_sub19" href="#_subfunctions" class="code">function e = end(this, k, ~)</a>
0840             e = this.siz(k);
0841         <span class="keyword">end</span>
0842         
0843         <a name="_sub20" href="#_subfunctions" class="code">function this = normalize(this, reSize, reFind, reSort, ~) </a><span class="comment">%last argument is oldDims and is used by CircularSparseMat</span>
0844             <span class="keyword">if</span> reSize
0845                 <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(this.subs)
0846                     this.subs = zeros(0, this.ndims);
0847                     this.vals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(0, 1), class(this.vals));
0848                 <span class="keyword">end</span>
0849                 
0850                 <span class="comment">%pad size</span>
0851                 <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(this.siz)
0852                     this.siz = [0 0];
0853                     <span class="keyword">if</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(this.subs) || ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(this.vals)
0854                         throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Index exceeds matrix dimensions.'</span>))
0855                     <span class="keyword">end</span>
0856                     this.subs = zeros(0, 0);
0857                     this.vals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(zeros(0, 1), class(this.vals));
0858                 <span class="keyword">elseif</span> <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.siz, 2) == 1
0859                     this.siz = [this.siz 1];
0860                     this.subs = [this.subs ones(this.nnz, 1)];
0861                 <span class="keyword">end</span>
0862                 
0863                 <span class="comment">%squeeze trailing singleton dimensions</span>
0864                 <span class="keyword">if</span> this.siz(end) == 1
0865                     idx = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(2, <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(this.siz ~= 1, 1, <span class="string">'last'</span>));
0866                     <span class="keyword">if</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(idx)
0867                         <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(this.subs(:, idx + 1:end) ~= 1)
0868                             throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>, <span class="string">'Index exceeds matrix dimensions.'</span>))
0869                         <span class="keyword">end</span>
0870                         this.siz = this.siz(1, 1:idx);
0871                         this.subs = this.subs(:, 1:idx);
0872                     <span class="keyword">end</span>
0873                 <span class="keyword">end</span>
0874             <span class="keyword">end</span>
0875             
0876             <span class="comment">%remove zeros</span>
0877             <span class="keyword">if</span> reFind &amp;&amp; ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(this.vals)
0878                 tfs = this.vals ~= 0;
0879                 this.subs = this.subs(tfs, :);
0880                 this.vals = this.vals(tfs, 1);
0881             <span class="keyword">end</span>
0882             
0883             <span class="comment">%sort rows</span>
0884             <span class="keyword">if</span> reSort &amp;&amp; ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(this.subs)
0885                 [this.subs, order] = this.sort_subs(this.subs, this.siz);
0886                 this.vals = this.vals(order, :);
0887             <span class="keyword">end</span>
0888         <span class="keyword">end</span>
0889     <span class="keyword">end</span>
0890     
0891     <span class="comment">%concatenation</span>
0892     methods
0893         <a name="_sub21" href="#_subfunctions" class="code">function this = cat(dim, varargin)</a>
0894             import edu.stanford.covert.util.SparseMat;
0895             
0896             validateattributes(dim, {<span class="string">'numeric'</span>}, {<span class="string">'scalar'</span>, <span class="string">'real'</span>, <span class="string">'positive'</span>, <span class="string">'integer'</span>});
0897             
0898             <span class="keyword">if</span> nargin &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 2
0899                 <span class="keyword">return</span>;
0900             <span class="keyword">end</span>
0901 
0902             this = varargin{1};
0903             <span class="keyword">if</span> ~isa(this, <span class="string">'SparseMat'</span>)
0904                 this = <a href="SparseMat.html" class="code" title="">SparseMat</a>(this);
0905             <span class="keyword">end</span>
0906             
0907             nRows = 0;
0908             edges = zeros(<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin) + 1, 1);
0909             <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin)
0910                 B = varargin{i};
0911                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
0912                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
0913                     varargin{i} = B;
0914                 <span class="keyword">end</span>
0915                 edges(i) = nRows + 1;
0916                 nRows = nRows + <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B.vals, 1);
0917             <span class="keyword">end</span>
0918             edges(end) = nRows + 1;
0919             
0920             siz  = this.siz;
0921             subs = zeros(nRows, <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs, 2), dim));
0922             vals = zeros(nRows, 1);
0923             
0924             <span class="keyword">if</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; this.ndims
0925                 siz = [siz ones(1, dim - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2))];
0926             <span class="keyword">end</span>
0927             siz(dim) = 0;
0928             
0929             <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(varargin)
0930                 B = varargin{i};
0931                 
0932                 Bsiz  = B.siz;
0933                 Bsubs = B.subs;
0934                 Bvals = B.vals;
0935                 
0936                 <span class="keyword">if</span> <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(dim, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsiz, 2)) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2)
0937                     siz = [siz ones(1, <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(dim, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsiz, 2)) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2))]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0938                     subs = [subs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(dim, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsiz, 2)) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 2))]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0939                 <span class="keyword">end</span>
0940                 
0941                 <span class="keyword">if</span> <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(dim, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2)) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsiz, 2)
0942                     Bsiz = [Bsiz ones(1, <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(dim, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2)) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsiz, 2))]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0943                     Bsubs = [Bsubs ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsubs, 1), <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(dim, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz, 2)) - <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bsubs, 2))]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0944                 <span class="keyword">end</span>
0945                 
0946                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(siz([1:dim-1 dim+1:end]), Bsiz([1:dim-1 dim+1:end]))
0947                     throw(MException(<span class="string">'SparseMat:cat'</span>, <span class="string">'Inconsistent dimensions'</span>));
0948                 <span class="keyword">end</span>
0949                 
0950                 Bsubs(:, dim) = Bsubs(:, dim) + siz(dim);
0951                 
0952                 subs(edges(i):edges(i+1) - 1, :) = Bsubs;
0953                 vals(edges(i):edges(i+1) - 1, :) = Bvals;
0954                 
0955                 siz(dim) = siz(dim) + Bsiz(dim);
0956             <span class="keyword">end</span>
0957             
0958             this.subs = subs;
0959             this.vals = vals;
0960             this.siz = siz;
0961             oldDims = 1:this.ndims;
0962             oldDims(dim) = 0;
0963             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; this.ndims
0964                 this = this.normalize(true, true, true, oldDims);
0965             <span class="keyword">else</span>
0966                 this = this.normalize(true, false, false, oldDims);
0967             <span class="keyword">end</span>
0968         <span class="keyword">end</span>
0969         
0970         <a name="_sub22" href="#_subfunctions" class="code">function this = horzcat(this, varargin)</a>
0971             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(2, this, varargin{:});
0972         <span class="keyword">end</span>
0973         
0974         <a name="_sub23" href="#_subfunctions" class="code">function this = vertcat(this, varargin)</a>
0975             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(1, this, varargin{:});
0976         <span class="keyword">end</span>
0977         
0978         <a name="_sub24" href="#_subfunctions" class="code">function this = padarray(this, padsize, padval, direction)</a>
0979             import edu.stanford.covert.util.SparseMat;
0980             
0981             <span class="comment">%padsize</span>
0982             <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(padsize &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0) || ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(padsize, ceil(<a href="#_sub37" class="code" title="subfunction this = real(this)">real</a>(padsize))) || ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(<a href="#_sub85" class="code" title="subfunction this = isfinite(this)">isfinite</a>(padsize)) || ~isvector(padsize)
0983                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'padsize must be vector of non-negative real integers'</span>));
0984             <span class="keyword">end</span>
0985             idx = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(padsize~=0,1,<span class="string">'last'</span>);
0986             <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(idx)
0987                 <span class="keyword">return</span>
0988             <span class="keyword">end</span>
0989             padsize = [padsize(1:idx) zeros(1, this.ndims-idx)];
0990             <span class="keyword">if</span> this.ndims &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
0991                 this.siz = [this.siz ones(1, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.siz,2))];
0992                 this.subs = [this.subs ones(this.nnz, <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,2))];
0993             <span class="keyword">end</span>
0994             
0995             <span class="comment">%padval</span>
0996             <span class="keyword">if</span> ~exist(<span class="string">'padval'</span>,<span class="string">'var'</span>)
0997                 padval = 0;
0998             <span class="keyword">elseif</span> ~isnumeric(padval) &amp;&amp; ~(ischar(padval) &amp;&amp; ismember(padval, {<span class="string">'circular'</span>,<span class="string">'replicate'</span>,<span class="string">'symmetric'</span>}))
0999                 throw(MException(<span class="string">'SparseMat:invalidValue'</span>,<span class="string">'padval must be numeric of one of the strings ''circular'', ''replicate'', or ''symmetric'''</span>));
1000             <span class="keyword">end</span>
1001             
1002             <span class="comment">%direction</span>
1003             <span class="keyword">if</span> ~exist(<span class="string">'direction'</span>,<span class="string">'var'</span>)
1004                 direction=<span class="string">'both'</span>;
1005             <span class="keyword">end</span>
1006             
1007             <span class="comment">%pad</span>
1008             <span class="keyword">switch</span> direction
1009                 <span class="keyword">case</span> <span class="string">'both'</span>
1010                     <span class="keyword">if</span> isnumeric(padval) &amp;&amp; padval==0
1011                         this.siz = this.siz + 2*padsize;
1012                         this.subs = this.subs + padsize(ones(this.nnz, 1), :);
1013                     <span class="keyword">elseif</span> isnumeric(padval)
1014                         <span class="keyword">for</span> i=1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
1015                             tmpsiz = this.siz;
1016                             tmpsiz(i)=padsize(i);
1017                             tmp = <a href="SparseMat.html" class="code" title="">SparseMat</a>([],[],tmpsiz);
1018                             tmp.subs = tmp.ind2sub(1:tmp.numel);
1019                             tmp.vals = padval(ones(tmp.numel, 1), 1);
1020                             
1021                             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(i, tmp, this, tmp);
1022                         <span class="keyword">end</span>
1023                     <span class="keyword">else</span>
1024                         <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
1025                             sref = struct(<span class="string">'type'</span>, <span class="string">'()'</span>, <span class="string">'subs'</span>, []);
1026                             tmp  = {<span class="string">':'</span>};
1027                             sref.subs = tmp(1, ones(<a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(this), 1));
1028                             preref=sref;
1029                             postref=sref;
1030                             
1031                             <span class="keyword">switch</span> padval
1032                                 <span class="keyword">case</span> <span class="string">'circular'</span>
1033                                     preref.subs{i} = mod(this.siz(i)-padsize(i)+(1:padsize(i))-1,this.siz(i))+1;
1034                                     postref.subs{i} = mod((1:padsize(i))-1,this.siz(i))+1;
1035                                 <span class="keyword">case</span> <span class="string">'replicate'</span>
1036                                     preref.subs{i} = ones(padsize(i),1);
1037                                     postref.subs{i} = this.siz(i * ones(padsize(i), 1));
1038                                 <span class="keyword">case</span> <span class="string">'symmetric'</span>
1039                                     preref.subs{i} = mod((padsize(i):-1:1)-1,this.siz(i))+1;
1040                                     postref.subs{i} = mod(this.siz(i)-(0:padsize(i)-1)-1,this.siz(i))+1;
1041                             <span class="keyword">end</span>
1042                             
1043                             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(i, this.subsref(preref), this, this.subsref(postref));
1044                         <span class="keyword">end</span>
1045                     <span class="keyword">end</span>
1046                 <span class="keyword">case</span> <span class="string">'post'</span>
1047                     <span class="keyword">if</span> isnumeric(padval) &amp;&amp; padval==0
1048                         this.siz = this.siz + padsize;
1049                     <span class="keyword">elseif</span> isnumeric(padval)
1050                         <span class="keyword">for</span> i=1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
1051                             tmpsiz = this.siz;
1052                             tmpsiz(i)=padsize(i);
1053                             
1054                             tmp = <a href="SparseMat.html" class="code" title="">SparseMat</a>([],[],tmpsiz);
1055                             tmp.subs = tmp.ind2sub(1:tmp.numel);
1056                             tmp.vals = padval(ones(tmp.numel,1),1);
1057                             
1058                             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(i, this, tmp);
1059                         <span class="keyword">end</span>
1060                     <span class="keyword">else</span>
1061                         <span class="keyword">for</span> i=1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
1062                             sref = struct(<span class="string">'type'</span>, <span class="string">'()'</span>, <span class="string">'subs'</span>, []);
1063                             tmp  = {<span class="string">':'</span>};
1064                             sref.subs = tmp(1, ones(<a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(this), 1));
1065                             
1066                             <span class="keyword">switch</span> padval
1067                                 <span class="keyword">case</span> <span class="string">'circular'</span>
1068                                     sref.subs{i} = mod((1:padsize(i))-1,this.siz(i))+1;
1069                                 <span class="keyword">case</span> <span class="string">'replicate'</span>
1070                                     sref.subs{i} = this.siz(i * ones(padsize(i), 1));
1071                                 <span class="keyword">case</span> <span class="string">'symmetric'</span>
1072                                     sref.subs{i} = mod(this.siz(i)-(0:padsize(i)-1)-1,this.siz(i))+1;
1073                             <span class="keyword">end</span>
1074                             
1075                             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(i, this, this.subsref(sref));
1076                         <span class="keyword">end</span>
1077                     <span class="keyword">end</span>
1078                 <span class="keyword">case</span> <span class="string">'pre'</span>
1079                     <span class="keyword">if</span> isnumeric(padval) &amp;&amp; padval==0
1080                         this.siz = this.siz + padsize;
1081                         this.subs = this.subs + padsize(ones(this.nnz,1), :);
1082                     <span class="keyword">elseif</span> isnumeric(padval)
1083                         <span class="keyword">for</span> i=1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
1084                             tmpsiz = this.siz;
1085                             tmpsiz(i)=padsize(i);
1086                             
1087                             tmp = <a href="SparseMat.html" class="code" title="">SparseMat</a>([],[],tmpsiz);
1088                             tmp.subs = tmp.ind2sub(1:tmp.numel);
1089                             tmp.vals = padval(ones(tmp.numel,1),1);
1090                             
1091                             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(i, tmp, this);
1092                         <span class="keyword">end</span>
1093                     <span class="keyword">else</span>
1094                         <span class="keyword">for</span> i = 1:<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(padsize)
1095                             sref = struct(<span class="string">'type'</span>, <span class="string">'()'</span>, <span class="string">'subs'</span>, []);
1096                             tmp  = {<span class="string">':'</span>};
1097                             sref.subs = tmp(1, ones(<a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(this), 1));
1098                             
1099                             <span class="keyword">switch</span> padval
1100                                 <span class="keyword">case</span> <span class="string">'circular'</span>
1101                                     sref.subs{i} = mod(this.siz(i)-padsize(i)+(1:padsize(i))-1, this.siz(i)) + 1;
1102                                 <span class="keyword">case</span> <span class="string">'replicate'</span>
1103                                     sref.subs{i} = ones(1, padsize(i), 1);
1104                                 <span class="keyword">case</span> <span class="string">'symmetric'</span>
1105                                     sref.subs{i} = mod((padsize(i):-1:1)-1, this.siz(i)) + 1;
1106                             <span class="keyword">end</span>
1107                             
1108                             this = <a href="#_sub22" class="code" title="subfunction this = cat(dim, varargin)">cat</a>(i, this.subsref(sref), this);
1109                         <span class="keyword">end</span>
1110                     <span class="keyword">end</span>
1111             <span class="keyword">end</span>
1112         <span class="keyword">end</span>
1113     <span class="keyword">end</span>
1114     
1115     <span class="comment">%scalar functions</span>
1116     methods
1117         <a name="_sub25" href="#_subfunctions" class="code">function this = abs(this)</a>
1118             this.vals = <a href="#_sub26" class="code" title="subfunction this = abs(this)">abs</a>(this.vals);
1119         <span class="keyword">end</span>
1120         
1121         <a name="_sub26" href="#_subfunctions" class="code">function this = sign(this)</a>
1122             this.vals = <a href="#_sub27" class="code" title="subfunction this = sign(this)">sign</a>(this.vals);
1123         <span class="keyword">end</span>
1124         
1125         <a name="_sub27" href="#_subfunctions" class="code">function C = sqrt(A)</a>
1126             C = A;
1127             C.vals = <a href="#_sub28" class="code" title="subfunction C = sqrt(A)">sqrt</a>(A.vals);
1128         <span class="keyword">end</span>
1129         
1130         <a name="_sub28" href="#_subfunctions" class="code">function C = realsqrt(A)</a>
1131             C = A;
1132             C.vals = <a href="#_sub29" class="code" title="subfunction C = realsqrt(A)">realsqrt</a>(A.vals);
1133         <span class="keyword">end</span>
1134         
1135         <a name="_sub29" href="#_subfunctions" class="code">function C = exp(A)</a>
1136             C = A;
1137             
1138             C.subs = A.ind2sub(1:A.numel);
1139             C.vals = ones(A.numel, 1);
1140             
1141             C.vals(A.inds) = <a href="#_sub30" class="code" title="subfunction C = exp(A)">exp</a>(A.vals);
1142             C.subs(A.inds(A.vals==-Inf),:)=[];
1143             C.vals(A.inds(A.vals==-Inf),:)=[];
1144         <span class="keyword">end</span>
1145         
1146         <a name="_sub30" href="#_subfunctions" class="code">function C = expm1(A)</a>
1147             C = A;
1148             
1149             C.vals = <a href="#_sub31" class="code" title="subfunction C = expm1(A)">expm1</a>(A.vals);
1150         <span class="keyword">end</span>
1151         
1152         <a name="_sub31" href="#_subfunctions" class="code">function C = log(A)</a>
1153             C = A;
1154             
1155             C.subs = A.ind2sub(1:A.numel);
1156             C.vals = -Inf(A.numel, 1);
1157             
1158             C.vals(A.inds) = <a href="#_sub32" class="code" title="subfunction C = log(A)">log</a>(A.vals);
1159             C.subs(A.inds(A.vals==1),:)=[];
1160             C.vals(A.inds(A.vals==1),:)=[];
1161         <span class="keyword">end</span>
1162         
1163         <a name="_sub32" href="#_subfunctions" class="code">function C = log2(A)</a>
1164             C = A;
1165             
1166             C.subs = A.ind2sub(1:A.numel);
1167             C.vals = -Inf(A.numel, 1);
1168             
1169             C.vals(A.inds) = <a href="#_sub33" class="code" title="subfunction C = log2(A)">log2</a>(A.vals);
1170             C.subs(A.inds(A.vals==1),:)=[];
1171             C.vals(A.inds(A.vals==1),:)=[];
1172         <span class="keyword">end</span>
1173         
1174         <a name="_sub33" href="#_subfunctions" class="code">function C = log10(A)</a>
1175             C = A;
1176             
1177             C.subs = A.ind2sub(1:A.numel);
1178             C.vals = -Inf(A.numel, 1);
1179             
1180             C.vals(A.inds) = <a href="#_sub34" class="code" title="subfunction C = log10(A)">log10</a>(A.vals);
1181             C.subs(A.inds(A.vals==1),:)=[];
1182             C.vals(A.inds(A.vals==1),:)=[];
1183         <span class="keyword">end</span>
1184         
1185         <a name="_sub34" href="#_subfunctions" class="code">function C = log1p(A)</a>
1186             C = A;
1187             
1188             C.vals = <a href="#_sub35" class="code" title="subfunction C = log1p(A)">log1p</a>(A.vals);
1189         <span class="keyword">end</span>
1190         
1191         <a name="_sub35" href="#_subfunctions" class="code">function C = reallog(A)</a>
1192             C = A;
1193             
1194             C.subs = A.ind2sub(1:A.numel);
1195             C.vals = -Inf(A.numel, 1);
1196             
1197             C.vals(A.inds) = <a href="#_sub36" class="code" title="subfunction C = reallog(A)">reallog</a>(A.vals);
1198             C.subs(A.inds(A.vals==1),:)=[];
1199             C.vals(A.inds(A.vals==1),:)=[];
1200         <span class="keyword">end</span>
1201         
1202         <span class="comment">%         function C = sqrtm(A); end;</span>
1203         <span class="comment">%         function C = expm(A); end;</span>
1204         <span class="comment">%         function C = logm(A); end;</span>
1205         <span class="comment">%         function C = funm(A); end;</span>
1206     <span class="keyword">end</span>
1207     
1208     <span class="comment">%complex numbers</span>
1209     methods
1210         <a name="_sub36" href="#_subfunctions" class="code">function this = real(this)</a>
1211             this.vals = <a href="#_sub37" class="code" title="subfunction this = real(this)">real</a>(this.vals);
1212             
1213             this = this.normalize(false, true, false, 1:this.ndims);
1214         <span class="keyword">end</span>
1215         
1216         <a name="_sub37" href="#_subfunctions" class="code">function this = imag(this)</a>
1217             this.vals = <a href="#_sub38" class="code" title="subfunction this = imag(this)">imag</a>(this.vals);
1218             
1219             this = this.normalize(false, true, false, 1:this.ndims);
1220         <span class="keyword">end</span>
1221         
1222         <a name="_sub38" href="#_subfunctions" class="code">function this = angle(this)</a>
1223             this.vals = <a href="#_sub39" class="code" title="subfunction this = angle(this)">angle</a>(this.vals);
1224             
1225             this = this.normalize(false, true, false, 1:this.ndims);
1226         <span class="keyword">end</span>
1227         
1228         <a name="_sub39" href="#_subfunctions" class="code">function this = conj(this)</a>
1229             this.vals = <a href="#_sub40" class="code" title="subfunction this = conj(this)">conj</a>(this.vals);
1230         <span class="keyword">end</span>
1231         
1232         <a name="_sub40" href="#_subfunctions" class="code">function this = isreal(this)</a>
1233             import edu.stanford.covert.util.SparseMat;
1234             
1235             <span class="keyword">if</span> <a href="#_sub41" class="code" title="subfunction this = isreal(this)">isreal</a>(this.vals)
1236                 this.subs = [1 1];
1237                 this.vals = true;
1238             <span class="keyword">else</span>
1239                 this.subs = zeros(0,2);
1240                 this.vals = false(0,1);
1241             <span class="keyword">end</span>
1242             this.siz = [1 1];
1243             
1244             this = this.normalize(true, false, false, zeros(1, 2));
1245         <span class="keyword">end</span>
1246     <span class="keyword">end</span>
1247     
1248     <span class="comment">%logic</span>
1249     methods
1250         <a name="_sub41" href="#_subfunctions" class="code">function this = not(this)</a>
1251             warning(<span class="string">'SparseMat:inefficient'</span>, <span class="string">'Negating sparse matrices can be very inefficient. Consider refactoring your code to avoid negation.'</span>)
1252             this.subs = this.ind2sub(setdiff(1:this.numel, this.inds));
1253             this.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1), 1);
1254         <span class="keyword">end</span>
1255         
1256         <a name="_sub42" href="#_subfunctions" class="code">function C = or(A, B)</a>
1257             import edu.stanford.covert.util.SparseMat;
1258             
1259             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1260                 tmp = B;
1261                 B = A;
1262                 A = tmp;
1263             <span class="keyword">end</span>
1264             
1265             <span class="comment">%B is scalar</span>
1266             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1267                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1268                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1269                 <span class="keyword">end</span>
1270                 
1271                 <span class="keyword">if</span> B
1272                     subs = A.ind2sub(1:A.numel);
1273                 <span class="keyword">else</span>
1274                     subs = A.subs;
1275                 <span class="keyword">end</span>
1276             <span class="keyword">else</span>
1277                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1278                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1279                 <span class="keyword">end</span>
1280                 
1281                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1282                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1283                 <span class="keyword">end</span>
1284                 
1285                 subs = A.unique_subs([A.subs; B.subs], A.siz);
1286             <span class="keyword">end</span>
1287             
1288             C = A;
1289             C.subs = subs;
1290             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1291             C = C.normalize(true, true, true, 1:A.ndims);
1292         <span class="keyword">end</span>
1293         
1294         <a name="_sub43" href="#_subfunctions" class="code">function C = and(A, B)</a>
1295             import edu.stanford.covert.util.SparseMat;
1296             
1297             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1298                 tmp = B;
1299                 B = A;
1300                 A = tmp;
1301             <span class="keyword">end</span>
1302             
1303             <span class="comment">%B is scalar</span>
1304             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1305                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1306                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1307                 <span class="keyword">end</span>
1308                 
1309                 <span class="keyword">if</span> B
1310                     subs = A.subs;
1311                 <span class="keyword">else</span>
1312                     subs = zeros(0,2);
1313                 <span class="keyword">end</span>
1314             <span class="keyword">else</span>
1315                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1316                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1317                 <span class="keyword">end</span>
1318                 
1319                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1320                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1321                 <span class="keyword">end</span>
1322                 
1323                 subs = A.intersect_subs(A.subs, B.subs, A.siz);
1324             <span class="keyword">end</span>
1325             
1326             C = A;
1327             C.subs = subs;
1328             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1329             C = C.normalize(true, true, true, 1:A.ndims);
1330         <span class="keyword">end</span>
1331         
1332         <a name="_sub44" href="#_subfunctions" class="code">function C = xor(A, B)</a>
1333             import edu.stanford.covert.util.SparseMat;
1334             
1335             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1336                 tmp = B;
1337                 B = A;
1338                 A = tmp;
1339             <span class="keyword">end</span>
1340             
1341             <span class="comment">%B is scalar</span>
1342             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1343                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1344                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1345                 <span class="keyword">end</span>
1346                 
1347                 <span class="keyword">if</span> B
1348                     subs = A.ind2sub(setdiff(1:A.numel, A.inds));
1349                 <span class="keyword">else</span>
1350                     subs = A.subs;
1351                 <span class="keyword">end</span>
1352             <span class="keyword">else</span>
1353                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1354                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1355                 <span class="keyword">end</span>
1356                 
1357                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1358                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1359                 <span class="keyword">end</span>
1360                 
1361                 subs = setxor(A.subs, B.subs, <span class="string">'rows'</span>);
1362             <span class="keyword">end</span>
1363             
1364             C = A;
1365             C.subs = subs;
1366             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1367             C = C.normalize(true, true, true, 1:A.ndims);
1368         <span class="keyword">end</span>
1369         
1370         <a name="_sub45" href="#_subfunctions" class="code">function C = nor(A, B)</a>
1371             import edu.stanford.covert.util.SparseMat;
1372             
1373             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1374                 tmp = B;
1375                 B = A;
1376                 A = tmp;
1377             <span class="keyword">end</span>
1378             
1379             <span class="comment">%B is scalar</span>
1380             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1381                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1382                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1383                 <span class="keyword">end</span>
1384                 
1385                 <span class="keyword">if</span> B
1386                     subs = zeros(0,1);
1387                 <span class="keyword">else</span>
1388                     subs = A.ind2sub(setdiff(1:A.numel, A.inds));
1389                 <span class="keyword">end</span>
1390             <span class="keyword">else</span>
1391                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1392                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1393                 <span class="keyword">end</span>
1394                 
1395                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1396                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1397                 <span class="keyword">end</span>
1398                 
1399                 subs = A.ind2sub(intersect(setdiff(1:A.numel, A.inds), setdiff(1:B.numel, B.inds)));
1400             <span class="keyword">end</span>
1401             
1402             C = A;
1403             C.subs = subs;
1404             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1405             C = C.normalize(true, true, true, 1:A.ndims);
1406         <span class="keyword">end</span>
1407         
1408         <a name="_sub46" href="#_subfunctions" class="code">function C = nand(A, B)</a>
1409             import edu.stanford.covert.util.SparseMat;
1410             
1411             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1412                 tmp = B;
1413                 B = A;
1414                 A = tmp;
1415             <span class="keyword">end</span>
1416             
1417             <span class="comment">%B is scalar</span>
1418             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1419                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1420                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1421                 <span class="keyword">end</span>
1422                 
1423                 <span class="keyword">if</span> B
1424                     subs = A.ind2sub(setdiff(1:A.numel, A.inds));
1425                 <span class="keyword">else</span>
1426                     subs = A.ind2sub(1:A.numel);
1427                 <span class="keyword">end</span>
1428             <span class="keyword">else</span>
1429                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1430                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1431                 <span class="keyword">end</span>
1432                 
1433                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1434                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1435                 <span class="keyword">end</span>
1436                 
1437                 subs = A.ind2sub(setdiff(1:A.numel, intersect(A.inds, B.inds)));
1438             <span class="keyword">end</span>
1439             
1440             C = A;
1441             C.subs = subs;
1442             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1443             C = C.normalize(true, true, true, 1:A.ndims);
1444         <span class="keyword">end</span>
1445     <span class="keyword">end</span>
1446     
1447     <span class="comment">%operators</span>
1448     methods
1449         <a name="_sub47" href="#_subfunctions" class="code">function this = uminus(this)</a>
1450             this.vals = -this.vals;
1451         <span class="keyword">end</span>
1452         
1453         <a name="_sub48" href="#_subfunctions" class="code">function this = uplus(this)</a>
1454         <span class="keyword">end</span>
1455         
1456         <a name="_sub49" href="#_subfunctions" class="code">function C = plus(A, B)</a>
1457             import edu.stanford.covert.util.SparseMat;
1458             
1459             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1460                 tmp = B;
1461                 B = A;
1462                 A = tmp;
1463             <span class="keyword">end</span>
1464             
1465             <span class="comment">%B is scalar</span>
1466             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1467                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1468                     B=<a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1469                 <span class="keyword">end</span>
1470                 
1471                 <span class="keyword">if</span> B==0
1472                     subs = A.subs;
1473                     vals = A.vals;
1474                 <span class="keyword">else</span>
1475                     subs = [A.subs;
1476                         A.ind2sub(setdiff(1:A.numel,A.inds))];
1477                     vals = [A.vals + B;
1478                         B(ones(A.numel-A.nnz, 1),1)];
1479                 <span class="keyword">end</span>
1480             <span class="keyword">else</span>
1481                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1482                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1483                 <span class="keyword">end</span>
1484                 
1485                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1486                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1487                 <span class="keyword">end</span>
1488                 
1489                 subs = A.subs;
1490                 vals = A.vals;
1491                 
1492                 [tfs, idxs] = B.ismember_subs(B.subs, A.subs, B.siz);
1493                 vals(idxs(tfs)) = vals(idxs(tfs)) + B.vals(tfs);
1494                 
1495                 subs = [subs; B.subs(~tfs,:)];
1496                 vals = [vals; B.vals(~tfs,:)];
1497             <span class="keyword">end</span>
1498             
1499             C = A;
1500             C.subs = subs;
1501             C.vals = vals;
1502             C = C.normalize(true, true, true, 1:A.ndims);
1503         <span class="keyword">end</span>
1504         
1505         <a name="_sub50" href="#_subfunctions" class="code">function C = minus(A,B)</a>
1506             C = A + -B;
1507         <span class="keyword">end</span>
1508         
1509         <a name="_sub51" href="#_subfunctions" class="code">function C = times(A,B)</a>
1510             import edu.stanford.covert.util.SparseMat;
1511             
1512             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1513                 tmp = B;
1514                 B = A;
1515                 A = tmp;
1516             <span class="keyword">end</span>
1517             
1518             <span class="comment">%B is scalar</span>
1519             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1520                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1521                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1522                 <span class="keyword">end</span>
1523                 
1524                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
1525                     subs = A.ind2sub(1:A.numel);
1526                     vals = B(ones(A.numel, 1),1);
1527                 <span class="keyword">elseif</span> <a href="#_sub84" class="code" title="subfunction this = isinf(this)">isinf</a>(B)
1528                     subs = [
1529                         A.subs;
1530                         A.ind2sub(setdiff(1:A.numel, A.inds))];
1531                     vals = [
1532                         A.vals * B;
1533                         NaN(A.numel - A.nnz, 1)];
1534                 <span class="keyword">else</span>
1535                     subs = A.subs;
1536                     vals = A.vals * B;
1537                 <span class="keyword">end</span>
1538             <span class="keyword">else</span>
1539                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1540                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1541                 <span class="keyword">end</span>
1542                 
1543                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1544                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1545                 <span class="keyword">end</span>
1546                 
1547                 [~, idxs1, idxs2] = intersect(A.inds, B.inds);
1548                 subs = A.subs(idxs1, :);
1549                 vals = A.vals(idxs1, :).*B.vals(idxs2, :);
1550                 
1551                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
1552                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
1553                 subs = [subs;
1554                     A.subs(~tfs1, :);
1555                     B.subs(~tfs2, :)];
1556                 vals = [vals;
1557                     A.vals(~tfs1, :) * 0;
1558                     B.vals(~tfs2, :) * 0];
1559             <span class="keyword">end</span>
1560             
1561             C = A;
1562             C.subs = subs;
1563             C.vals = vals;
1564             C = C.normalize(true, true, true, 1:A.ndims);
1565         <span class="keyword">end</span>
1566         
1567         <a name="_sub52" href="#_subfunctions" class="code">function C = rdivide(A, B)</a>
1568             import edu.stanford.covert.util.SparseMat;
1569             
1570             <span class="keyword">if</span> isa(B,<span class="string">'SparseMat'</span>)
1571                 subs = [
1572                     B.subs;
1573                     B.ind2sub(setdiff(1:B.numel,B.inds))];
1574                 vals = [
1575                     1./B.vals;
1576                     Inf(B.numel-B.nnz, 1)];                
1577                 B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(subs, vals, B.siz);
1578             <span class="keyword">else</span>
1579                 B = 1./B;
1580             <span class="keyword">end</span>
1581             C = A .* B;
1582         <span class="keyword">end</span>
1583         
1584         <a name="_sub53" href="#_subfunctions" class="code">function C = ldivide(A, B)</a>
1585             C = B ./ A;
1586         <span class="keyword">end</span>
1587         
1588         <a name="_sub54" href="#_subfunctions" class="code">function C = mtimes(A, B)</a>
1589             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A)==1 || <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B)==1
1590                 C = A.*B;
1591             <span class="keyword">elseif</span> <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(A)&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;=2 &amp;&amp; <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(B)&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;=2
1592                 C = <a href="#_sub56" class="code" title="subfunction C = tprod(A, B, Aid, Bid)">tprod</a>(A, B, 2, 1);
1593             <span class="keyword">else</span>
1594                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'Inputs must be 2-D, or at least one input must be scalar'</span>));
1595             <span class="keyword">end</span>
1596         <span class="keyword">end</span>
1597         
1598         <a name="_sub55" href="#_subfunctions" class="code">function C = tprod(A, B, Aid, Bid)</a>
1599             import edu.stanford.covert.util.SparseMat;
1600             
1601             <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(Aid&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;1) || ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(Aid, ceil(<a href="#_sub37" class="code" title="subfunction this = real(this)">real</a>(Aid))) || <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(Aid &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(A)) || ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(diff(sort(Aid)))
1602                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'inner dimensions must be unique positive real integers'</span>));
1603             <span class="keyword">end</span>
1604             <span class="keyword">if</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(Bid&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;1) || ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(Bid, ceil(<a href="#_sub37" class="code" title="subfunction this = real(this)">real</a>(Bid))) || <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(Bid &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub8" class="code" title="subfunction n = ndims(this)">ndims</a>(B)) || ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(diff(sort(Bid)))
1605                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'inner dimensions must be unique positive real integers'</span>));
1606             <span class="keyword">end</span>
1607             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(Aid) ~= <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(Bid)
1608                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'inner dimensions must have same size'</span>));
1609             <span class="keyword">end</span>
1610             
1611             <span class="comment">%convert to SparseMat type</span>
1612             <span class="keyword">if</span> ~isa(A, <span class="string">'SparseMat'</span>)
1613                 A = <a href="SparseMat.html" class="code" title="">SparseMat</a>(A);
1614             <span class="keyword">end</span>
1615             
1616             <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1617                 B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1618             <span class="keyword">end</span>
1619             
1620             <span class="comment">%compute size of result</span>
1621             Aod = setdiff(1:A.ndims, Aid);
1622             Bod = setdiff(1:B.ndims, Bid);
1623             siz = [<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A, Aod) <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B, Bod)];
1624             
1625             <span class="comment">%compute tensor product</span>
1626             Anansubs = A.subs(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals),:);
1627             Bnansubs = B.subs(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B.vals),:);
1628             A.subs(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals),:)=[];
1629             B.subs(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B.vals),:)=[];
1630             A.vals(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals),:)=[];
1631             B.vals(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B.vals),:)=[];
1632             
1633             Ainfsubs = A.subs(<a href="#_sub84" class="code" title="subfunction this = isinf(this)">isinf</a>(A.vals),:);
1634             Binfsubs = B.subs(<a href="#_sub84" class="code" title="subfunction this = isinf(this)">isinf</a>(B.vals),:);
1635             Azrosubs = A.ind2sub(setdiff(1:A.numel, A.inds));
1636             Bzrosubs = B.ind2sub(setdiff(1:B.numel, B.inds));
1637             
1638             subs = [<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(A.subs, B.nnz, 1) B.sort_subs(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(B.subs, A.nnz, 1), B.siz)
1639                 <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(Ainfsubs, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bzrosubs,1), 1) B.sort_subs(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(Bzrosubs, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Ainfsubs,1), 1), B.siz);
1640                 A.sort_subs(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(Azrosubs, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Binfsubs,1), 1), A.siz) <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(Binfsubs, <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Azrosubs,1), 1)];
1641             vals = [<a href="#_sub9" class="code" title="subfunction this = reshape(this, varargin)">reshape</a>(A.vals*B.vals',[],1);
1642                 NaN(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Ainfsubs,1)*<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bzrosubs,1),1)
1643                 NaN(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Binfsubs,1)*<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Azrosubs,1),1)];
1644             
1645             badIdxs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(subs(:,Aid)~=subs(:,A.ndims + Bid));
1646             subs(badIdxs, :)=[];
1647             vals(badIdxs, :)=[];
1648             subs(:, [Aid A.ndims + Bid])=[];
1649             
1650             subs = [subs;
1651                 <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(Anansubs(:,Aod),prod(B.siz(Bod)),1) B.ind2sub(sort(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(1:prod(B.siz(Bod)), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Anansubs,1), 1)), B.siz(Bod));
1652                 A.ind2sub(sort(<a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(1:prod(A.siz(Aod)), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bnansubs,1), 1)), A.siz(Aod)) <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(Bnansubs(:,Bod),prod(A.siz(Aod)),1)];
1653             vals = [vals;
1654                 NaN(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Anansubs,1) * prod(B.siz(Bod)),1);
1655                 NaN(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(Bnansubs,1) * prod(A.siz(Aod)),1)];
1656             
1657             [subs, order] = A.sort_subs(subs, siz);
1658             sums = vals(order,:);
1659             <span class="keyword">for</span> i=2:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1)
1660                 <span class="keyword">if</span> <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subs(i-1,:),subs(i,:))
1661                     sums(i) = sums(i-1)+sums(i);
1662                     sums(i-1)=0;
1663                 <span class="keyword">end</span>
1664             <span class="keyword">end</span>
1665             
1666             idxs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(sums);
1667             subs = subs(idxs,:);
1668             vals = sums(idxs,:);
1669             
1670             subs(vals==0,:)=[];
1671             vals(vals==0,:)=[];
1672             
1673             <span class="comment">%return as SparseMat</span>
1674             <span class="keyword">if</span> ~isa(A,<span class="string">'SparseMat'</span>) || (isa(B,<span class="string">'SparseMat'</span>) &amp;&amp; ~strcmp(class(B),<span class="string">'edu.stanford.covert.util.SparseMat'</span>))
1675                 C = B;
1676             <span class="keyword">else</span>
1677                 C = A;
1678             <span class="keyword">end</span>
1679             C.subs = subs;
1680             C.vals = vals;
1681             C.siz = siz;
1682             C = C.normalize(true, true, true, zeros(1, C.ndims));
1683         <span class="keyword">end</span>
1684         
1685         <a name="_sub56" href="#_subfunctions" class="code">function C = mrdivide(A, B)</a>
1686             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A)==1 || <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B)==1
1687                 C = A./B;
1688             <span class="keyword">else</span>
1689                 throw(MException(<span class="string">'SparseMat:undefined'</span>,<span class="string">'operation not yet implemented'</span>));
1690             <span class="keyword">end</span>
1691         <span class="keyword">end</span>
1692         
1693         <a name="_sub57" href="#_subfunctions" class="code">function C = mldivide(A, B)</a>
1694             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A)==1 || <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B)==1
1695                 C = A.\B;
1696             <span class="keyword">else</span>
1697                 throw(MException(<span class="string">'SparseMat:undefined'</span>,<span class="string">'operation not yet implemented'</span>));
1698             <span class="keyword">end</span>
1699         <span class="keyword">end</span>
1700         
1701         <a name="_sub58" href="#_subfunctions" class="code">function C = power(A, B)</a>
1702             import edu.stanford.covert.util.SparseMat;
1703             
1704             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1
1705                 <span class="comment">%A is scalar</span>
1706                 
1707                 <span class="keyword">if</span> isa(A,<span class="string">'SparseMat'</span>)
1708                     A=<a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(A);
1709                 <span class="keyword">end</span>
1710                 
1711                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A)
1712                     subs = B.ind2sub(1:B.numel);
1713                     vals = A(ones(B.numel, 1),1);
1714                 <span class="keyword">elseif</span> <a href="#_sub84" class="code" title="subfunction this = isinf(this)">isinf</a>(A)
1715                     subs = [
1716                         B.subs;
1717                         B.ind2sub(setdiff(1:B.numel, B.inds))];
1718                     vals = [
1719                         A.^ B.vals;
1720                         <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(A.^0, B.numel-B.nnz, 1)];
1721                 <span class="keyword">else</span>
1722                     subs = B.ind2sub(1:B.numel);
1723                     vals = ones(B.numel,1);
1724                     vals(B.inds)=A.^B.vals;
1725                 <span class="keyword">end</span>
1726             <span class="keyword">elseif</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1727                 <span class="comment">%B is a scalar</span>
1728                 
1729                 <span class="keyword">if</span> isa(B,<span class="string">'SparseMat'</span>)
1730                     B=<a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1731                 <span class="keyword">end</span>
1732                 
1733                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
1734                     subs = A.ind2sub(1:A.numel);
1735                     vals = B(ones(A.numel, 1), 1);
1736                 <span class="keyword">elseif</span> <a href="#_sub84" class="code" title="subfunction this = isinf(this)">isinf</a>(B)
1737                     subs = [
1738                         A.subs;
1739                         A.ind2sub(setdiff(1:A.numel, A.inds))];
1740                     vals = [
1741                         A.vals .^ B;
1742                         <a href="#_sub10" class="code" title="subfunction this = repmat(this, varargin)">repmat</a>(0.^B, A.numel-A.nnz, 1)];
1743                 <span class="keyword">elseif</span> B==0
1744                     subs = A.ind2sub(1:A.numel);
1745                     vals = ones(A.numel,1);
1746                     vals(A.inds)=A.vals.^0;
1747                 <span class="keyword">else</span>
1748                     subs = A.subs;
1749                     vals = A.vals .^ B;
1750                 <span class="keyword">end</span>
1751             <span class="keyword">else</span>
1752                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1753                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>,<span class="string">'size RHS must equal that of LHS'</span>))
1754                 <span class="keyword">end</span>
1755                 
1756                 <span class="keyword">if</span> ~isa(A, <span class="string">'SparseMat'</span>)
1757                     A = <a href="SparseMat.html" class="code" title="">SparseMat</a>(A);
1758                 <span class="keyword">end</span>
1759                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1760                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1761                 <span class="keyword">end</span>
1762                 
1763                 [~,idxs1,idxs2]=intersect(A.inds, B.inds);
1764                 subs = A.subs(idxs1,:);
1765                 vals = A.vals(idxs1,:).^B.vals(idxs2,:);
1766                 
1767                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
1768                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
1769                 subs = [subs;
1770                     A.subs(~tfs1,:);
1771                     B.subs(~tfs2,:)];
1772                 vals = [vals;
1773                     A.vals(~tfs1,:).^0;
1774                     0.^B.vals(~tfs2,:)];
1775                 
1776                 subs = [subs;
1777                     A.ind2sub(setdiff(1:A.numel,[A.inds;B.inds]))];
1778                 vals = [vals;
1779                     ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1)-<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals,1),1)];
1780             <span class="keyword">end</span>
1781             
1782             subs(vals==0,:)=[];
1783             vals(vals==0,:)=[];
1784             
1785             <span class="keyword">if</span> ~isa(A,<span class="string">'SparseMat'</span>) || (isa(B,<span class="string">'SparseMat'</span>) &amp;&amp; ~strcmp(class(B),<span class="string">'edu.stanford.covert.util.SparseMat'</span>))
1786                 C = B;
1787             <span class="keyword">else</span>
1788                 C = A;
1789             <span class="keyword">end</span>
1790             C.subs = subs;
1791             C.vals = vals;
1792             C = C.normalize(true, true, true, 1:C.ndims);
1793         <span class="keyword">end</span>
1794         
1795         <a name="_sub59" href="#_subfunctions" class="code">function C = mpower(A, B)</a>
1796             throw(MException(<span class="string">'SparseMat:undefined'</span>,<span class="string">'operation not yet implemented'</span>));
1797         <span class="keyword">end</span>
1798     <span class="keyword">end</span>
1799     
1800     <span class="comment">%comparison</span>
1801     methods
1802         <a name="_sub60" href="#_subfunctions" class="code">function val = isequal(A, B)</a>
1803             import edu.stanford.covert.util.SparseMat;
1804             
1805             val = isa(A, <span class="string">'SparseMat'</span>) &amp;&amp; <span class="keyword">...</span>
1806                 <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(class(A), class(B)) &amp;&amp; <span class="keyword">...</span>
1807                 <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(A.siz, B.siz) &amp;&amp; <span class="keyword">...</span>
1808                 <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(A.subs, B.subs) &amp;&amp; <span class="keyword">...</span>
1809                 <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(A.vals, B.vals);
1810         <span class="keyword">end</span>
1811         
1812         <a name="_sub61" href="#_subfunctions" class="code">function assertElementsAlmostEqual(A, B, varargin)</a>
1813             import edu.stanford.covert.util.SparseMat;
1814             
1815             assertEqual(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B));
1816             
1817             <span class="keyword">if</span> ~isa(A, <span class="string">'SparseMat'</span>)
1818                 A = <a href="SparseMat.html" class="code" title="">SparseMat</a>(A);
1819             <span class="keyword">end</span>
1820             <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1821                 B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1822             <span class="keyword">end</span>
1823             
1824             assertEqual(A.subs, B.subs);
1825             <a href="#_sub62" class="code" title="subfunction assertElementsAlmostEqual(A, B, varargin)">assertElementsAlmostEqual</a>(A.vals, B.vals, varargin{:});
1826         <span class="keyword">end</span>
1827         
1828         <a name="_sub62" href="#_subfunctions" class="code">function C = eq(A, B)</a>
1829             import edu.stanford.covert.util.SparseMat;
1830             
1831             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1832                 tmp = B;
1833                 B = A;
1834                 A = tmp;
1835             <span class="keyword">end</span>
1836             
1837             <span class="comment">%B is scalar</span>
1838             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1839                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1840                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1841                 <span class="keyword">end</span>
1842                 
1843                 <span class="keyword">if</span> B == 0
1844                     subs = A.ind2sub(setdiff(1:A.numel, A.inds));
1845                 <span class="keyword">else</span>
1846                     subs = A.subs(A.vals == B, :);
1847                 <span class="keyword">end</span>
1848             <span class="keyword">else</span>
1849                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1850                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1851                 <span class="keyword">end</span>
1852                 
1853                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1854                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1855                 <span class="keyword">end</span>
1856                 
1857                 <span class="comment">%non-zeros</span>
1858                 [~, idxs] = intersect([A.inds A.vals], [B.inds B.vals], <span class="string">'rows'</span>);
1859                 subs = A.subs(idxs,:);
1860                 
1861                 <span class="comment">%zeros</span>
1862                 subs = [subs;
1863                     A.ind2sub(setdiff(1:A.numel,[A.inds; B.inds]))];
1864             <span class="keyword">end</span>
1865             
1866             C = A;
1867             C.subs = subs;
1868             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1869             C = C.normalize(true, true, true, 1:A.ndims);
1870         <span class="keyword">end</span>
1871         
1872         <a name="_sub63" href="#_subfunctions" class="code">function C = ne(A,B)</a>
1873             import edu.stanford.covert.util.SparseMat;
1874             
1875             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
1876                 tmp = B;
1877                 B = A;
1878                 A = tmp;
1879             <span class="keyword">end</span>
1880             
1881             <span class="comment">%B is scalar</span>
1882             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1883                 <span class="keyword">if</span> isa(B,<span class="string">'SparseMat'</span>)
1884                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1885                 <span class="keyword">end</span>
1886                 
1887                 <span class="keyword">if</span> B == 0
1888                     subs = A.subs;
1889                 <span class="keyword">else</span>
1890                     subs = [
1891                         A.ind2sub(setdiff(1:A.numel, A.inds));
1892                         A.subs(A.vals ~= B, :)];
1893                 <span class="keyword">end</span>
1894             <span class="keyword">else</span>
1895                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1896                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1897                 <span class="keyword">end</span>
1898                 
1899                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1900                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1901                 <span class="keyword">end</span>
1902                 
1903                 [~, idxs1, idxs2] = intersect(A.inds, B.inds);
1904                 
1905                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
1906                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
1907                 
1908                 subs = [
1909                     A.subs(idxs1(A.vals(idxs1, :) ~= B.vals(idxs2, :)), :);
1910                     A.subs(~tfs1, :);
1911                     B.subs(~tfs2, :)];
1912             <span class="keyword">end</span>
1913             
1914             C = A;
1915             C.subs = subs;
1916             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1917             C = C.normalize(true, true, true, 1:A.ndims);
1918         <span class="keyword">end</span>
1919         
1920         <a name="_sub64" href="#_subfunctions" class="code">function C = ge(A,B)</a>
1921             import edu.stanford.covert.util.SparseMat;
1922             
1923             <span class="keyword">if</span> ~isa(A, <span class="string">'SparseMat'</span>)
1924                 C = B &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= A;
1925                 <span class="keyword">return</span>;
1926             <span class="keyword">end</span>
1927             
1928             <span class="comment">%B is scalar</span>
1929             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1930                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1931                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1932                 <span class="keyword">end</span>
1933                 
1934                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
1935                     subs = zeros(0,2);
1936                 <span class="keyword">elseif</span> B &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 0
1937                     subs = A.subs(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= B, :);
1938                 <span class="keyword">else</span>
1939                     subs = [
1940                         A.subs(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= B, :);
1941                         A.ind2sub(setdiff(1:A.numel, A.inds))];
1942                 <span class="keyword">end</span>
1943             <span class="keyword">else</span>
1944                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1945                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
1946                 <span class="keyword">end</span>
1947                 
1948                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
1949                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
1950                 <span class="keyword">end</span>
1951                 
1952                 [~, idxs1, idxs2] = intersect(A.inds, B.inds);
1953                 subs = A.subs(idxs1(A.vals(idxs1, :) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= B.vals(idxs2, :)), :);
1954                 
1955                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
1956                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
1957                 idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs1);
1958                 idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs2);
1959                 
1960                 subs = [subs;
1961                     A.subs(idxs1(A.vals(idxs1, :) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= 0), :);
1962                     B.subs(idxs2(B.vals(idxs2, :) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= 0), :)
1963                     A.ind2sub(intersect(setdiff(1:A.numel, A.inds), setdiff(1:B.numel, B.inds)))];
1964             <span class="keyword">end</span>
1965             
1966             C = A;
1967             C.subs = subs;
1968             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
1969             C = C.normalize(true, true, true, 1:A.ndims);
1970         <span class="keyword">end</span>
1971         
1972         <a name="_sub65" href="#_subfunctions" class="code">function C = gt(A,B)</a>
1973             import edu.stanford.covert.util.SparseMat;
1974             
1975             <span class="keyword">if</span> ~isa(A,<span class="string">'SparseMat'</span>)
1976                 C = B &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; A;
1977                 <span class="keyword">return</span>;
1978             <span class="keyword">end</span>
1979             
1980             <span class="comment">%B is scalar</span>
1981             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
1982                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
1983                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
1984                 <span class="keyword">end</span>
1985                 
1986                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
1987                     subs = zeros(0,2);
1988                 <span class="keyword">elseif</span> B&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;=0
1989                     subs = A.subs(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; B, :);
1990                 <span class="keyword">else</span>
1991                     subs = [
1992                         A.subs(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; B, :);
1993                         A.ind2sub(setdiff(1:A.numel, A.inds))];
1994                 <span class="keyword">end</span>
1995             <span class="keyword">else</span>
1996                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
1997                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>,<span class="string">'size RHS must equal that of LHS'</span>))
1998                 <span class="keyword">end</span>
1999                 
2000                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
2001                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
2002                 <span class="keyword">end</span>
2003                 
2004                 [~, idxs1, idxs2] = intersect(A.inds, B.inds);
2005                 subs = A.subs(idxs1(A.vals(idxs1,:) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; B.vals(idxs2,:)),:);
2006                 
2007                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
2008                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
2009                 idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs1);
2010                 idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs2);
2011                 
2012                 subs = [subs;
2013                     A.subs(idxs1(A.vals(idxs1,:)&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;0),:);
2014                     B.subs(idxs2(B.vals(idxs2,:)&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;0),:)];
2015             <span class="keyword">end</span>
2016             
2017             C = A;
2018             C.subs = subs;
2019             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
2020             C = C.normalize(true, true, true, 1:A.ndims);
2021         <span class="keyword">end</span>
2022         
2023         <a name="_sub66" href="#_subfunctions" class="code">function C = le(A,B)</a>
2024             import edu.stanford.covert.util.SparseMat;
2025             
2026             <span class="keyword">if</span> ~isa(A,<span class="string">'SparseMat'</span>)
2027                 C = B &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= A;
2028                 <span class="keyword">return</span>;
2029             <span class="keyword">end</span>
2030             
2031             <span class="comment">%B is scalar</span>
2032             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
2033                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
2034                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
2035                 <span class="keyword">end</span>
2036                 
2037                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
2038                     subs = zeros(0,2);
2039                 <span class="keyword">elseif</span> B &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0
2040                     subs = A.subs(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= B, :);
2041                 <span class="keyword">else</span>
2042                     subs = [
2043                         A.subs(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= B, :);
2044                         A.ind2sub(setdiff(1:A.numel, A.inds))];
2045                 <span class="keyword">end</span>
2046             <span class="keyword">else</span>
2047                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
2048                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>,<span class="string">'size RHS must equal that of LHS'</span>))
2049                 <span class="keyword">end</span>
2050                 
2051                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
2052                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
2053                 <span class="keyword">end</span>
2054                 
2055                 [~, idxs1, idxs2] = intersect(A.inds, B.inds);
2056                 subs = A.subs(idxs1(A.vals(idxs1,:) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= B.vals(idxs2,:)),:);
2057                 
2058                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
2059                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
2060                 idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs1);
2061                 idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs2);
2062                 
2063                 subs = [subs;
2064                     A.subs(idxs1(A.vals(idxs1,:)&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;=0),:);
2065                     B.subs(idxs2(B.vals(idxs2,:)&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;=0),:);
2066                     A.ind2sub(intersect(setdiff(1:A.numel,A.inds), setdiff(1:B.numel, B.inds)))];
2067             <span class="keyword">end</span>
2068             
2069             C = A;
2070             C.subs = subs;
2071             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
2072             C = C.normalize(true, true, true, 1:A.ndims);
2073         <span class="keyword">end</span>
2074         
2075         <a name="_sub67" href="#_subfunctions" class="code">function C = lt(A,B)</a>
2076             import edu.stanford.covert.util.SparseMat;
2077             
2078             <span class="keyword">if</span> ~isa(A,<span class="string">'SparseMat'</span>)
2079                 C = B &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A;
2080                 <span class="keyword">return</span>;
2081             <span class="keyword">end</span>
2082             
2083             <span class="comment">%B is scalar</span>
2084             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
2085                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
2086                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
2087                 <span class="keyword">end</span>
2088                 
2089                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
2090                     subs = zeros(0,2);
2091                 <span class="keyword">elseif</span> B &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= 0
2092                     subs = A.subs(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; B, :);
2093                 <span class="keyword">else</span>
2094                     subs = [
2095                         A.subs(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; B, :);
2096                         A.ind2sub(setdiff(1:A.numel, A.inds))];
2097                 <span class="keyword">end</span>
2098             <span class="keyword">else</span>
2099                 <span class="keyword">if</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
2100                     throw(MException(<span class="string">'SparseMat:invalidSizes'</span>, <span class="string">'size RHS must equal that of LHS'</span>))
2101                 <span class="keyword">end</span>
2102                 
2103                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
2104                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
2105                 <span class="keyword">end</span>
2106                 
2107                 [~, idxs1, idxs2] = intersect(A.inds, B.inds);
2108                 subs = A.subs(idxs1(A.vals(idxs1,:) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; B.vals(idxs2,:)),:);
2109                 
2110                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
2111                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
2112                 idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs1);
2113                 idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs2);
2114                 
2115                 subs = [subs;
2116                     A.subs(idxs1(A.vals(idxs1,:)&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;0),:);
2117                     B.subs(idxs2(B.vals(idxs2,:)&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;0),:)];
2118             <span class="keyword">end</span>
2119             
2120             C = A;
2121             C.subs = subs;
2122             C.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1), 1);
2123             C = C.normalize(true, true, true, 1:A.ndims);
2124         <span class="keyword">end</span>
2125     <span class="keyword">end</span>
2126     
2127     <span class="comment">%set operators</span>
2128     methods
2129         <a name="_sub68" href="#_subfunctions" class="code">function val = unique(this)</a>
2130             import edu.stanford.covert.util.SparseMat;
2131             
2132             vals = <a href="#_sub69" class="code" title="subfunction val = unique(this)">unique</a>(this.vals);
2133             
2134             <span class="keyword">if</span> this.nnz &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; this.numel
2135                 vals = sort([vals;0]);
2136             <span class="keyword">end</span>
2137             
2138             subs = [(1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals,1))' ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals))];
2139             
2140             <span class="keyword">if</span> ~<a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(this.siz)
2141                 siz = [0 0];
2142             <span class="keyword">elseif</span> this.ndims==2 &amp;&amp; this.siz(1)==1 &amp;&amp; ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(vals)
2143                 siz = [1 <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals,1)];
2144             <span class="keyword">else</span>
2145                 siz = [<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(vals,1) 1];
2146             <span class="keyword">end</span>
2147             
2148             val = this;
2149             val.subs = subs;
2150             val.vals = vals;
2151             val.siz = siz;
2152             val = val.normalize(true, true, true, zeros(1, 2));
2153         <span class="keyword">end</span>
2154         
2155         <span class="comment">%function C = union(A, B, varargin); end</span>
2156         <span class="comment">%function C = intersect(A, B, varargin); end</span>
2157         <span class="comment">%function C = setdiff((A, B, varargin); end</span>
2158         <span class="comment">%function C = setxor(A, B, varargin); end</span>
2159         <span class="comment">%function C = ismember(A, B, varargin); end</span>
2160     <span class="keyword">end</span>
2161     
2162     <span class="comment">%reduction</span>
2163     methods
2164         <a name="_sub69" href="#_subfunctions" class="code">function B = all(A, dim)</a>
2165             import edu.stanford.covert.util.SparseMat;
2166             
2167             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2168                 dim = 1;
2169             <span class="keyword">end</span>
2170             
2171             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2172                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2173             <span class="keyword">elseif</span> dim&<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A.siz, 2)
2174                 B = A;
2175                 B.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A.vals));
2176                 B = B.normalize(true, true, true, 1:A.ndims);
2177                 <span class="keyword">return</span>;
2178             <span class="keyword">end</span>
2179             
2180             siz = A.siz;
2181             siz(dim) = 1;
2182             
2183             subs = A.sort_subs(A.subs(:,[1:dim-1 dim+1:end]), A.siz(1,[1:dim-1 dim+1:end]));
2184             
2185             <span class="keyword">if</span> ~A.isunique_subs(subs, A.siz([1:dim-1 dim+1:end]))
2186                 [~, first, ~]     = <a href="#_sub69" class="code" title="subfunction val = unique(this)">unique</a>(subs, <span class="string">'rows'</span>, <span class="string">'first'</span>);
2187                 [subs, last, ind] = <a href="#_sub69" class="code" title="subfunction val = unique(this)">unique</a>(subs, <span class="string">'rows'</span>, <span class="string">'last'</span>);
2188                 subs = subs(ind(last-first+1 == A.siz(dim)), :);
2189             <span class="keyword">end</span>
2190             subs = [subs(:, 1:dim-1) ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1) subs(:, dim:end)];
2191             
2192             vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1);
2193             
2194             B = A;
2195             B.subs = subs;
2196             B.vals = vals;
2197             B.siz = siz;
2198             oldDims = 1:A.ndims;
2199             oldDims(dim) = 0;
2200             B = B.normalize(true, true, true, oldDims);
2201         <span class="keyword">end</span>
2202         
2203         <a name="_sub70" href="#_subfunctions" class="code">function B = any(A, dim)</a>
2204             import edu.stanford.covert.util.SparseMat;
2205             
2206             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2207                 dim = 1;
2208             <span class="keyword">end</span>
2209             
2210             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2211                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>,<span class="string">'invalid dimension'</span>));
2212             <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A.ndims
2213                 B = A;
2214                 B.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A.vals));
2215                 B = B.normalize(false, false, false, 1:A.ndims);
2216                 <span class="keyword">return</span>;
2217             <span class="keyword">end</span>
2218             
2219             siz = A.siz;
2220             siz(dim) = 1;
2221             
2222             subs = A.unique_subs(A.subs(:, [1:dim-1 dim+1:end]), A.siz(1, [1:dim-1 dim+1:end]));
2223             subs = [subs(:, 1:dim-1) ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1) subs(:, dim:end)];
2224             
2225             vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1);
2226             
2227             B = A;
2228             B.subs = subs;
2229             B.vals = vals;
2230             B.siz = siz;
2231             oldDims = 1:A.ndims;
2232             oldDims(dim) = 0;
2233             B = B.normalize(true, true, true, oldDims);
2234         <span class="keyword">end</span>
2235         
2236         <a name="_sub71" href="#_subfunctions" class="code">function C = min(A, B, dim)</a>
2237             import edu.stanford.covert.util.SparseMat;
2238             
2239             <span class="keyword">if</span> ~exist(<span class="string">'B'</span>, <span class="string">'var'</span>)
2240                 B = [];
2241                 dim = 1;
2242             <span class="keyword">end</span>
2243             
2244             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
2245                 tmp = B;
2246                 B = A;
2247                 A = tmp;
2248             <span class="keyword">end</span>
2249             
2250             <span class="keyword">if</span> exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2251                 <span class="keyword">if</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(B)
2252                     throw(MException(<span class="string">'SparseMat:unsupportedSyntax'</span>, <span class="string">'MIN with two matrices to compare and a working dimension is not supported.'</span>))
2253                 <span class="keyword">end</span>
2254                 
2255                 <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2256                     throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2257                 <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A.siz, 2)
2258                     C = A;
2259                     <span class="keyword">return</span>
2260                 <span class="keyword">else</span>
2261                     subsNaNVals = sortrows([A.vals ~<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals) A.subs(:,[1:dim-1 dim+1:end])], A.ndims+1:-1:1);
2262                     subsVals = subsNaNVals(:, [1 3:end]);
2263                     mins = true(A.nnz, 1);
2264                     nnzs = zeros(A.nnz, 1);
2265                     mins(1) = true;
2266                     nnzs(1) = 1;
2267                     <span class="keyword">for</span> i = 2:A.nnz
2268                         <span class="keyword">if</span> <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subsVals(i-1, 2:end),subsVals(i, 2:end))
2269                             nnzs(i) = nnzs(i-1);
2270                             nnzs(i-1) = 0;
2271                             
2272                             <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(subsVals(i-1,1))
2273                                 mins(i-1) = false;
2274                             <span class="keyword">else</span>
2275                                 mins(i) = false;
2276                             <span class="keyword">end</span>
2277                         <span class="keyword">end</span>
2278                         nnzs(i) = nnzs(i) + 1;
2279                     <span class="keyword">end</span>
2280                     
2281                     mins = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(mins);
2282                     [~, ~, nnzs] = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(nnzs);
2283                     mins(nnzs &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; A.siz(dim) &amp; (subsVals(mins, 1) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 0 | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(subsVals(mins, 1)))) = [];
2284                     
2285                     C = A;
2286                     C.vals = subsVals(mins, 1);
2287                     oldDims = 1:A.ndims;
2288                     <span class="keyword">if</span> dim == A.ndims &amp;&amp; dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 2
2289                         C.subs = subsVals(mins, 2:dim);
2290                         C.siz(dim) = [];
2291                         oldDims(dim) = [];
2292                     <span class="keyword">else</span>
2293                         C.subs = [subsVals(mins,2:dim) ones(<a href="#_sub6" class="code" title="subfunction l = length(this)">length</a>(mins), 1) subsVals(mins, dim+1:end)];
2294                         C.siz(dim) = 1;
2295                         oldDims(dim) = 0;
2296                     <span class="keyword">end</span>
2297                     
2298                     C = C.normalize(true, false, false, oldDims);
2299                 <span class="keyword">end</span>
2300             <span class="keyword">elseif</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
2301                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
2302                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
2303                 <span class="keyword">end</span>
2304                 
2305                 C = A;
2306                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
2307                 <span class="keyword">elseif</span> B &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 0
2308                     C.vals(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; B | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals)) = B;
2309                 <span class="keyword">elseif</span> B == 0
2310                     C.subs(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; B | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals), :) = [];
2311                     C.vals(A.vals &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; B | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals), :) = [];
2312                 <span class="keyword">else</span>
2313                     C.subs = A.ind2sub(1:A.numel);
2314                     C.vals = B(ones(A.numel, 1), 1);
2315                     C.vals(A.inds) = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(A.vals, B);
2316                 <span class="keyword">end</span>
2317             <span class="keyword">elseif</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
2318                 throw(MException(<span class="string">'SparseMat:invalidInput'</span>, <span class="string">'Matrix dimensions must agree.'</span>));
2319             <span class="keyword">else</span>
2320                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
2321                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
2322                 <span class="keyword">end</span>
2323                 
2324                 [subs, idxs1, idxs2] = A.intersect_subs(A.subs, B.subs, A.siz);
2325                 vals = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(A.vals(idxs1, :), B.vals(idxs2, :));
2326                 
2327                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
2328                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
2329                 idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs1);
2330                 idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs2);
2331                 idxs1 = idxs1(A.vals(idxs1) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0);
2332                 idxs2 = idxs2(B.vals(idxs2) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0);
2333                 
2334                 subs = [subs;
2335                     A.subs(idxs1, :);
2336                     B.subs(idxs2, :)];
2337                 vals = [vals;
2338                     A.vals(idxs1, :);
2339                     B.vals(idxs2, :)];
2340                 
2341                 C = A;
2342                 C.subs = subs;
2343                 C.vals = vals;
2344                 C = C.normalize(true, true, true, 1:A.ndims);
2345             <span class="keyword">end</span>
2346         <span class="keyword">end</span>
2347         
2348         <a name="_sub72" href="#_subfunctions" class="code">function C = max(A, B, dim)</a>
2349             import edu.stanford.covert.util.SparseMat;
2350             
2351             <span class="keyword">if</span> ~exist(<span class="string">'B'</span>, <span class="string">'var'</span>)
2352                 B = [];
2353                 dim = 1;
2354             <span class="keyword">end</span>
2355             
2356             <span class="keyword">if</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(A) == 1 || ~isa(A, <span class="string">'SparseMat'</span>)
2357                 tmp = B;
2358                 B = A;
2359                 A = tmp;
2360             <span class="keyword">end</span>
2361             
2362             <span class="keyword">if</span> exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2363                 <span class="keyword">if</span> ~<a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(B)
2364                     throw(MException(<span class="string">'SparseMat:unsupportedSyntax'</span>, <span class="string">'MIN with two matrices to compare and a working dimension is not supported.'</span>))
2365                 <span class="keyword">end</span>
2366                 
2367                 <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2368                     throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2369                 <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A.siz, 2)
2370                     C = A;
2371                     <span class="keyword">return</span>
2372                 <span class="keyword">else</span>
2373                     subsNaNVals = sortrows([A.vals ~<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals) A.subs(:,[1:dim-1 dim+1:end])], A.ndims+1:-1:1);
2374                     subsVals = subsNaNVals(:, [1 3:end]);
2375                     maxs = false(A.nnz, 1);
2376                     nnzs = zeros(A.nnz, 1);
2377                     maxs(1) = true;
2378                     nnzs(1) = 1;
2379                     <span class="keyword">for</span> i = 2:A.nnz
2380                         <span class="keyword">if</span> <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subsVals(i-1, 2:end), subsVals(i, 2:end))
2381                             nnzs(i) = nnzs(i-1);
2382                             nnzs(i-1) = 0;
2383                             
2384                             maxs(i) = true;
2385                             maxs(i-1) = false;
2386                         <span class="keyword">else</span>
2387                             maxs(i) = true;
2388                         <span class="keyword">end</span>
2389                         nnzs(i) = nnzs(i) + 1;
2390                     <span class="keyword">end</span>
2391                     
2392                     maxs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(maxs);
2393                     [~, ~, nnzs] = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(nnzs);
2394                     maxs(nnzs &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; A.siz(dim) &amp; (subsVals(maxs, 1) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0 | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(subsVals(maxs, 1)))) = [];
2395                     
2396                     C = A;
2397                     C.vals = subsVals(maxs, 1);
2398                     oldDims = 1:A.ndims;
2399                     <span class="keyword">if</span> dim == A.ndims &amp;&amp; dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 2
2400                         C.subs = subsVals(maxs, 2:dim);
2401                         C.siz(dim) = [];
2402                         oldDims(dim) = [];
2403                     <span class="keyword">else</span>
2404                         C.subs = [subsVals(maxs, 2:dim) ones(<a href="#_sub6" class="code" title="subfunction l = length(this)">length</a>(maxs), 1) subsVals(maxs, dim + 1:end)];
2405                         C.siz(dim) = 1;
2406                         oldDims(dim) = 0;
2407                     <span class="keyword">end</span>
2408                     
2409                     C = C.normalize(true, false, false, oldDims);
2410                 <span class="keyword">end</span>
2411             <span class="keyword">elseif</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(B) == 1
2412                 <span class="keyword">if</span> isa(B, <span class="string">'SparseMat'</span>)
2413                     B = <a href="#_sub87" class="code" title="subfunction val = full(this)">full</a>(B);
2414                 <span class="keyword">end</span>
2415                 
2416                 C = A;
2417                 <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(B)
2418                 <span class="keyword">elseif</span> B &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0
2419                     C.vals(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; B | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals)) = B;
2420                 <span class="keyword">elseif</span> B == 0
2421                     C.subs(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; B | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals), :) = [];
2422                     C.vals(A.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; B | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals), :) = [];
2423                 <span class="keyword">else</span>
2424                     C.subs = A.ind2sub(1:A.numel);
2425                     C.vals = B(ones(A.numel, 1),1);
2426                     C.vals(A.inds) = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(A.vals, B);
2427                 <span class="keyword">end</span>
2428             <span class="keyword">elseif</span> ~<a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(A), <a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(B))
2429                 throw(MException(<span class="string">'SparseMat:invalidInput'</span>,<span class="string">'Matrix dimensions must agree.'</span>));
2430             <span class="keyword">else</span>
2431                 <span class="keyword">if</span> ~isa(B, <span class="string">'SparseMat'</span>)
2432                     B = <a href="SparseMat.html" class="code" title="">SparseMat</a>(B);
2433                 <span class="keyword">end</span>
2434                 
2435                 [subs, idxs1, idxs2] = A.intersect_subs(A.subs, B.subs, A.siz);
2436                 vals = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(A.vals(idxs1,:), B.vals(idxs2, :));
2437                 
2438                 tfs1 = A.ismember_subs(A.subs, B.subs, A.siz);
2439                 tfs2 = B.ismember_subs(B.subs, A.subs, B.siz);
2440                 idxs1 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs1);
2441                 idxs2 = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(~tfs2);
2442                 idxs1 = idxs1(A.vals(idxs1) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 0);
2443                 idxs2 = idxs2(B.vals(idxs2) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 0);
2444                 
2445                 subs = [subs;
2446                     A.subs(idxs1, :);
2447                     B.subs(idxs2, :)];
2448                 vals = [vals;
2449                     A.vals(idxs1, :);
2450                     B.vals(idxs2, :)];
2451                 
2452                 C = A;
2453                 C.subs = subs;
2454                 C.vals = vals;
2455                 C = C.normalize(true, true, true, 1:A.ndims);
2456             <span class="keyword">end</span>
2457         <span class="keyword">end</span>
2458         
2459         <a name="_sub73" href="#_subfunctions" class="code">function C = range(A, dim)</a>
2460             import edu.stanford.covert.util.SparseMat;
2461             
2462             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2463                 dim = 1;
2464             <span class="keyword">end</span>
2465             
2466             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2467                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2468             <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A.ndims
2469                 C = A;
2470                 C.subs(<a href="#_sub85" class="code" title="subfunction this = isfinite(this)">isfinite</a>(C.vals), :) = [];
2471                 C.vals = NaN(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(C.subs, 1), 1);
2472                 <span class="keyword">return</span>;
2473             <span class="keyword">end</span>
2474             
2475             subsNaNVals = sortrows([A.vals ~<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(A.vals) A.subs(:,[1:dim-1 dim+1:end])], A.ndims+1:-1:1);
2476             subsVals = subsNaNVals(:, [1 3:end]);
2477             mins = true(A.nnz, 1);
2478             maxs = false(A.nnz, 1);
2479             nnzs = zeros(A.nnz, 1);
2480             mins(1) = true;
2481             maxs(1) = true;
2482             nnzs(1) = 1;
2483             <span class="keyword">for</span> i = 2:A.nnz
2484                 <span class="keyword">if</span> <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subsVals(i-1, 2:end),subsVals(i, 2:end))
2485                     nnzs(i) = nnzs(i-1);
2486                     nnzs(i-1) = 0;
2487                     
2488                     <span class="keyword">if</span> <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(subsVals(i-1,1))
2489                         mins(i-1) = false;
2490                     <span class="keyword">else</span>
2491                         mins(i) = false;
2492                     <span class="keyword">end</span>
2493                     
2494                     maxs(i) = true;
2495                     maxs(i-1) = false;
2496                 <span class="keyword">else</span>
2497                     maxs(i) = true;
2498                 <span class="keyword">end</span>
2499                 nnzs(i) = nnzs(i) + 1;
2500             <span class="keyword">end</span>
2501             
2502             [~, ~, nnzs] = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(nnzs);
2503             mins = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(mins);
2504             maxs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(maxs);
2505             mins(nnzs &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; A.siz(dim) &amp; (subsVals(mins, 1) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 0 | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(subsVals(mins, 1)))) = [];
2506             maxs(nnzs &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; A.siz(dim) &amp; (subsVals(maxs, 1) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0 | <a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(subsVals(maxs, 1)))) = [];
2507             
2508             minSubs = subsVals(mins, 2:end);
2509             maxSubs = subsVals(maxs, 2:end);
2510             minVals = subsVals(mins, 1);
2511             maxVals = subsVals(maxs, 1);
2512             
2513             [subs, idxs1, idxs2] = intersect(maxSubs, minSubs, <span class="string">'rows'</span>);
2514             vals = maxVals(idxs1, :) - minVals(idxs2, :);
2515             subs(vals == 0, :) = [];
2516             vals(vals == 0, :) = [];
2517             
2518             subs = [subs;
2519                 minSubs(setdiff(1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(minSubs, 1), idxs2), :);
2520                 maxSubs(setdiff(1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(maxSubs, 1), idxs1), :)];
2521             vals = [vals;
2522                 -minVals(setdiff(1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(minSubs, 1), idxs2), :);
2523                 maxVals(setdiff(1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(maxSubs, 1), idxs1), :)];
2524             
2525             [subs, order] = sortrows(subs, A.ndims-1:-1:1);
2526             vals = vals(order, :);
2527             
2528             C = A;
2529             C.vals = vals;
2530             oldDims = 1:A.ndims;
2531             <span class="keyword">if</span> dim == A.ndims &amp;&amp; dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 2
2532                 C.subs = subs;
2533                 C.siz(dim) = [];
2534                 oldDims(dim) = [];
2535             <span class="keyword">else</span>
2536                 C.subs = [subs(:, 1:dim-1) ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1) subs(:, dim:end)];
2537                 C.siz(dim) = 1;
2538                 oldDims(dim) = 0;
2539             <span class="keyword">end</span>
2540             
2541             C = C.normalize(true, false, false, oldDims);
2542         <span class="keyword">end</span>
2543         
2544         <a name="_sub74" href="#_subfunctions" class="code">function C = sum(A, dim)</a>
2545             import edu.stanford.covert.util.CircularSparseMat;
2546             import edu.stanford.covert.util.SparseMat;
2547             
2548             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2549                 dim = 1;
2550             <span class="keyword">end</span>
2551             
2552             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2553                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2554             <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A.ndims
2555                 C = A;
2556                 <span class="keyword">return</span>;
2557             <span class="keyword">end</span>
2558             
2559             subs = A.subs;
2560             subs(:, dim) = 1;
2561             siz = A.siz;
2562             siz(dim) = 1;
2563             
2564             [subs, ~, J] = A.unique_subs(subs, siz);
2565             vals = accumarray(J, A.vals, [<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1) 1]);
2566             
2567             <span class="keyword">if</span> isa(A, <span class="string">'edu.stanford.covert.util.CircularSparseMat'</span>)
2568                 oldDims = 1:A.ndims;
2569                 oldDims(dim) = [];
2570                 C = <a href="CircularSparseMat.html" class="code" title="">CircularSparseMat</a>(subs, vals, siz, oldDims);
2571             <span class="keyword">else</span>
2572                 C = <a href="SparseMat.html" class="code" title="">SparseMat</a>(subs, vals, siz);
2573             <span class="keyword">end</span>
2574         <span class="keyword">end</span>
2575         
2576         <a name="_sub75" href="#_subfunctions" class="code">function C = mean(A, dim)</a>
2577             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2578                 dim = 1;
2579             <span class="keyword">end</span>
2580             
2581             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2582                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2583             <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A.ndims
2584                 C = A;
2585                 <span class="keyword">return</span>;
2586             <span class="keyword">end</span>
2587             
2588             C = <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(A, dim);
2589             C.vals = C.vals / A.siz(dim);
2590         <span class="keyword">end</span>
2591         
2592         <a name="_sub76" href="#_subfunctions" class="code">function C = var(A, flag, dim)</a>
2593             import edu.stanford.covert.util.SparseMat;
2594             
2595             <span class="keyword">if</span> ~exist(<span class="string">'flag'</span>, <span class="string">'var'</span>) || flag == 0
2596                 <a href="#_sub80" class="code" title="subfunction C = norm(A, option)">norm</a> = 2;
2597             <span class="keyword">else</span>
2598                 <a href="#_sub80" class="code" title="subfunction C = norm(A, option)">norm</a> = 0;
2599             <span class="keyword">end</span>
2600             
2601             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2602                 dim = 1;
2603             <span class="keyword">elseif</span> flag == 0 &amp;&amp; dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
2604                 throw(MException(<span class="string">'SparseMat:unsupportedSyntax'</span>, <span class="string">'unsupported syntax'</span>))
2605             <span class="keyword">end</span>
2606             
2607             <span class="keyword">if</span> dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 1 || dim ~= ceil(dim)
2608                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2609             <span class="keyword">elseif</span> dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A.ndims
2610                 C = A;
2611                 C.subs(<a href="#_sub85" class="code" title="subfunction this = isfinite(this)">isfinite</a>(C.vals), :) = [];
2612                 C.vals = NaN(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(C.subs, 1), 1);
2613                 <span class="keyword">return</span>;
2614             <span class="keyword">end</span>
2615             
2616             [subs, order] = A.sort_subs(A.subs(:, [1:dim-1 dim+1:end]), A.siz(1, [1:dim-1 dim+1:end]));
2617             
2618             sums = A.vals(order,:);
2619             sumSquares = A.vals(order, :) .^ 2;
2620             <span class="keyword">for</span> i=2:A.nnz
2621                 <span class="keyword">if</span> <a href="#_sub61" class="code" title="subfunction val = isequal(A, B)">isequal</a>(subs(i-1, :), subs(i, :))
2622                     sums(i) = sums(i-1) + sums(i);
2623                     sums(i - 1) = 0;
2624                     
2625                     sumSquares(i) = sumSquares(i - 1) + sumSquares(i);
2626                     sumSquares(i - 1) = 0;
2627                 <span class="keyword">end</span>
2628             <span class="keyword">end</span>
2629             
2630             idxs = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(sumSquares);
2631             subs = subs(idxs, :);
2632             vals = sumSquares(idxs, :) / (A.siz(dim) - <a href="#_sub80" class="code" title="subfunction C = norm(A, option)">norm</a>) - (sums(idxs, :) / (A.siz(dim) - <a href="#_sub80" class="code" title="subfunction C = norm(A, option)">norm</a>)) .^ 2;
2633             
2634             subs(vals == 0, :) = [];
2635             vals(vals == 0, :) = [];
2636             
2637             C = A;
2638             C.vals = vals;
2639             oldDims = 1:A.ndims;
2640             <span class="keyword">if</span> dim == A.ndims &amp;&amp; dim &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 2
2641                 C.subs = subs;
2642                 C.siz(dim) = [];
2643                 oldDims(dim) = [];
2644             <span class="keyword">else</span>
2645                 C.subs = [subs(:, 1:dim-1) ones(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1), 1) subs(:, dim:end)];
2646                 C.siz(dim) = 1;
2647                 oldDims(dim) = 0;
2648             <span class="keyword">end</span>
2649             
2650             C = C.normalize(true, false, false, oldDims);
2651         <span class="keyword">end</span>
2652         
2653         <a name="_sub77" href="#_subfunctions" class="code">function C = std(A, flag, dim)</a>
2654             <span class="keyword">if</span> ~exist(<span class="string">'flag'</span>, <span class="string">'var'</span>)
2655                 flag = 0;
2656             <span class="keyword">end</span>
2657             
2658             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2659                 dim = 1;
2660             <span class="keyword">end</span>
2661             
2662             C = <a href="#_sub77" class="code" title="subfunction C = var(A, flag, dim)">var</a>(A, flag, dim);
2663             C.vals(~<a href="#_sub85" class="code" title="subfunction this = isfinite(this)">isfinite</a>(C.vals), :) = NaN;
2664             
2665             C.subs(C.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0, :) = [];
2666             C.vals(C.vals &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0, :) = [];
2667             
2668             C.vals = <a href="#_sub28" class="code" title="subfunction C = sqrt(A)">sqrt</a>(C.vals);
2669         <span class="keyword">end</span>
2670         
2671         <span class="comment">%         function value = prod(this); end</span>
2672         <span class="comment">%         function value = cumsum(this); end</span>
2673         <span class="comment">%         function value = diff(this); end</span>
2674         <span class="comment">%         function value = cumprod(this); end</span>
2675         <span class="comment">%         function value = mode(this); end</span>
2676         <span class="comment">%         function value = median(this); end</span>
2677         <span class="comment">%         function value = cov(this); end</span>
2678         
2679         <span class="comment">% Similar to sum, but returns a collapsed object of builtin MATLAB type.</span>
2680         <span class="comment">% Also if dim is negative, it sums over all but the specified</span>
2681         <span class="comment">% dimensions.</span>
2682         <a name="_sub78" href="#_subfunctions" class="code">function C = collapse(A, dim)</a>
2683             <span class="keyword">if</span> ~exist(<span class="string">'dim'</span>, <span class="string">'var'</span>)
2684                 C = <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(A.vals);
2685                 <span class="keyword">return</span>;
2686             <span class="keyword">end</span>
2687             
2688             validateattributes(dim, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>, <span class="string">'integer'</span>})
2689             validateattributes(<a href="#_sub26" class="code" title="subfunction this = abs(this)">abs</a>(dim), {<span class="string">'numeric'</span>}, {<span class="string">'positive'</span>, <span class="string">'&lt;='</span> A.ndims});
2690             <span class="keyword">if</span> ~<a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(diff(sort(dim)))
2691                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2692             <span class="keyword">end</span>
2693             
2694             <span class="keyword">if</span> <a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0)
2695                 dim = setdiff(1:A.ndims, -dim);
2696             <span class="keyword">elseif</span> <a href="#_sub71" class="code" title="subfunction B = any(A, dim)">any</a>(dim &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 0)
2697                 throw(MException(<span class="string">'SparseMat:invalidDimension'</span>, <span class="string">'invalid dimension'</span>));
2698             <span class="keyword">end</span>
2699             
2700             <span class="keyword">if</span> <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(ismembc(dim, 1:A.ndims)) == A.ndims
2701                 C = <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(A.vals);
2702                 <span class="keyword">return</span>
2703             <span class="keyword">end</span>
2704             
2705             C = A;
2706             <span class="keyword">for</span> i = 1:<a href="#_sub6" class="code" title="subfunction l = length(this)">length</a>(dim)
2707                 C = <a href="#_sub75" class="code" title="subfunction C = sum(A, dim)">sum</a>(C, dim(i));
2708             <span class="keyword">end</span>
2709             
2710             C = <a href="#_sub102" class="code" title="subfunction val = double(this)">double</a>(<a href="#_sub14" class="code" title="subfunction this = squeeze(this)">squeeze</a>(C));
2711         <span class="keyword">end</span>
2712         
2713         <a name="_sub79" href="#_subfunctions" class="code">function C = norm(A, option)</a>
2714             import edu.stanford.covert.util.SparseMat;
2715             
2716             <span class="keyword">if</span> ~exist(<span class="string">'option'</span>, <span class="string">'var'</span>)
2717                 option = 2;
2718             <span class="keyword">end</span>
2719             
2720             vals = <a href="#_sub80" class="code" title="subfunction C = norm(A, option)">norm</a>(A.vals, option);
2721             
2722             <span class="keyword">if</span> A.numel &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; A.nnz &amp;&amp; ~<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(vals)
2723                 <span class="keyword">if</span> option == Inf
2724                     vals = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(0, vals);
2725                 <span class="keyword">elseif</span> option == -Inf
2726                     vals = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(0, vals);
2727                 <span class="keyword">end</span>
2728             <span class="keyword">end</span>
2729             
2730             C = A;
2731             C.subs = ones(<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(vals), 2);
2732             C.vals = vals;
2733             C.siz = [1 1];
2734             C = C.normalize(false, true, false, zeros(1, 2));
2735         <span class="keyword">end</span>
2736     <span class="keyword">end</span>
2737     
2738     <span class="comment">%find</span>
2739     methods
2740         <a name="_sub80" href="#_subfunctions" class="code">function [subs, vals] = find(this)</a>
2741             subs = this.subs;
2742             vals = this.vals;
2743         <span class="keyword">end</span>
2744         
2745         <span class="comment">%if n&gt;=1, randomly select n zero entries of a sparse tensor</span>
2746         <span class="comment">%if n&lt; 1, randomly select each entry with probability n, return only zero entries</span>
2747         <a name="_sub81" href="#_subfunctions" class="code">function subs = randomlySelectZeros(this, n, randStream)</a>
2748             <span class="keyword">if</span> n&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;1
2749                 <span class="keyword">if</span> exist(<span class="string">'randStream'</span>,<span class="string">'var'</span>)
2750                     inds = randStream.randi(this.numel, [randStream.random(<span class="string">'poiss'</span>, n*this.numel) 1]);
2751                 <span class="keyword">else</span>
2752                     inds = randi(this.numel, [random(<span class="string">'poiss'</span>, n*this.numel) 1]);
2753                 <span class="keyword">end</span>
2754                 subs = this.ind2sub(setdiff(inds, this.inds));
2755             <span class="keyword">else</span>
2756                 n = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(this.numel-this.nnz, n);
2757                 selectedInds = [];
2758                 <span class="keyword">while</span> <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(selectedInds)&<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;n
2759                     <span class="keyword">if</span> exist(<span class="string">'randStream'</span>,<span class="string">'var'</span>)
2760                         testInds = randStream.randi(this.numel, [n-<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(selectedInds) 1]);
2761                     <span class="keyword">else</span>
2762                         testInds = randi(this.numel, [n-<a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(selectedInds) 1]);
2763                     <span class="keyword">end</span>
2764                     selectedInds = [selectedInds; testInds]; <span class="comment">%#ok&lt;AGROW&gt;</span>
2765                 <span class="keyword">end</span>
2766                 
2767                 subs = this.ind2sub(selectedInds);
2768             <span class="keyword">end</span>
2769         <span class="keyword">end</span>
2770     <span class="keyword">end</span>
2771     
2772     <span class="comment">%iss</span>
2773     methods
2774         <a name="_sub82" href="#_subfunctions" class="code">function this = isnan(this)</a>
2775             this.subs = this.subs(<a href="#_sub83" class="code" title="subfunction this = isnan(this)">isnan</a>(this.vals), :);
2776             this.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1),1);
2777         <span class="keyword">end</span>
2778         
2779         <a name="_sub83" href="#_subfunctions" class="code">function this = isinf(this)</a>
2780             this.subs = this.subs(<a href="#_sub84" class="code" title="subfunction this = isinf(this)">isinf</a>(this.vals), :);
2781             this.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1),1);
2782         <span class="keyword">end</span>
2783         
2784         <a name="_sub84" href="#_subfunctions" class="code">function this = isfinite(this)</a>
2785             this.subs = this.sort_subs([
2786                 this.ind2sub(setdiff(1:this.numel, this.inds));
2787                 this.subs(<a href="#_sub85" class="code" title="subfunction this = isfinite(this)">isfinite</a>(this.vals), :)], <span class="keyword">...</span>
2788                 this.siz);
2789             this.vals = true(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(this.subs,1),1);
2790         <span class="keyword">end</span>
2791     <span class="keyword">end</span>
2792     
2793     <span class="comment">%type casting</span>
2794     methods
2795         <a name="_sub85" href="#_subfunctions" class="code">function type = valueClass(this)</a>
2796             type = class(this.vals);
2797         <span class="keyword">end</span>
2798         
2799         <a name="_sub86" href="#_subfunctions" class="code">function val = full(this)</a>
2800             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <a href="#_sub86" class="code" title="subfunction type = valueClass(this)">valueClass</a>(this));
2801         <span class="keyword">end</span>
2802         
2803         <a name="_sub87" href="#_subfunctions" class="code">function val = sparse(this)</a>
2804             <span class="keyword">if</span> this.ndims &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 2
2805                 throw(MException(<span class="string">'SparseMat:invalidDimensions'</span>,<span class="string">'cannot convert to MATLAB builtin sparse with greater than 2 dimensions'</span>))
2806             <span class="keyword">elseif</span> ~isa(this.vals,<span class="string">'double'</span>)
2807                 warning(<span class="string">'SparseMat:invalidType'</span>,<span class="string">'converting from SparseMat of type ''%s'' to MATLAB builtin sparse of type ''double'''</span>, <a href="#_sub86" class="code" title="subfunction type = valueClass(this)">valueClass</a>(this))
2808             <span class="keyword">end</span>
2809             val = <a href="#_sub88" class="code" title="subfunction val = sparse(this)">sparse</a>(this.subs(:,1), this.subs(:,2), this.vals,this.siz(1),this.siz(2));
2810         <span class="keyword">end</span>
2811         
2812         <a name="_sub88" href="#_subfunctions" class="code">function val = cast(this, newclass)</a>
2813             import edu.stanford.covert.util.CircularSparseMat;
2814             import edu.stanford.covert.util.SparseMat;
2815             
2816             <span class="keyword">switch</span> newclass
2817                 <span class="keyword">case</span> <span class="string">'sptensor'</span>,           val = <a href="#_sub103" class="code" title="subfunction val = sptensor(this)">sptensor</a>(this);
2818                 <span class="keyword">case</span> <span class="string">'CircularSparseMat'</span>,  val = <a href="CircularSparseMat.html" class="code" title="">CircularSparseMat</a>(this);
2819                 <span class="keyword">case</span> <span class="string">'SparseMat'</span>        ,  val = <a href="SparseMat.html" class="code" title="">SparseMat</a>(this);
2820                 <span class="keyword">case</span> <span class="string">'logical'</span>
2821                     val = false(this.siz);
2822                     val(this.inds) = this.vals;
2823                 <span class="keyword">otherwise</span>
2824                     val = zeros(this.siz, newclass);
2825                     val(this.inds) = this.vals;
2826             <span class="keyword">end</span>
2827         <span class="keyword">end</span>
2828         
2829         <a name="_sub89" href="#_subfunctions" class="code">function this = valueCast(this, newclass)</a>
2830             this.vals = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this.vals, newclass);
2831         <span class="keyword">end</span>
2832         
2833         <a name="_sub90" href="#_subfunctions" class="code">function val = char(this)</a>
2834             val = <a href="#_sub91" class="code" title="subfunction val = char(this)">char</a>(zeros(this.siz));
2835             val(this.inds) = this.vals;
2836         <span class="keyword">end</span>
2837         
2838         <a name="_sub91" href="#_subfunctions" class="code">function val = logical(this)</a>
2839             val = false(this.siz);
2840             val(this.inds) = this.vals;
2841         <span class="keyword">end</span>
2842         
2843         <a name="_sub92" href="#_subfunctions" class="code">function val = int8(this)</a>
2844             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'int8'</span>);
2845         <span class="keyword">end</span>
2846         
2847         <a name="_sub93" href="#_subfunctions" class="code">function val = int16(this)</a>
2848             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'int16'</span>);
2849         <span class="keyword">end</span>
2850         
2851         <a name="_sub94" href="#_subfunctions" class="code">function val = int32(this)</a>
2852             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'int32'</span>);
2853         <span class="keyword">end</span>
2854         
2855         <a name="_sub95" href="#_subfunctions" class="code">function val = int64(this)</a>
2856             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'int64'</span>);
2857         <span class="keyword">end</span>
2858         
2859         <a name="_sub96" href="#_subfunctions" class="code">function val = uint8(this)</a>
2860             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'uint8'</span>);
2861         <span class="keyword">end</span>
2862         
2863         <a name="_sub97" href="#_subfunctions" class="code">function val = uint16(this)</a>
2864             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'uint16'</span>);
2865         <span class="keyword">end</span>
2866         
2867         <a name="_sub98" href="#_subfunctions" class="code">function val = uint32(this)</a>
2868             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'uint32'</span>);
2869         <span class="keyword">end</span>
2870         
2871         <a name="_sub99" href="#_subfunctions" class="code">function val = uint64(this)</a>
2872             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'uint64'</span>);
2873         <span class="keyword">end</span>
2874         
2875         <a name="_sub100" href="#_subfunctions" class="code">function val = single(this)</a>
2876             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'single'</span>);
2877         <span class="keyword">end</span>
2878         
2879         <a name="_sub101" href="#_subfunctions" class="code">function val = double(this)</a>
2880             val = <a href="#_sub89" class="code" title="subfunction val = cast(this, newclass)">cast</a>(this, <span class="string">'double'</span>);
2881         <span class="keyword">end</span>
2882         
2883         <a name="_sub102" href="#_subfunctions" class="code">function val = sptensor(this)</a>
2884             val = <a href="#_sub103" class="code" title="subfunction val = sptensor(this)">sptensor</a>(this.subs, this.vals, this.siz);
2885         <span class="keyword">end</span>
2886     <span class="keyword">end</span>
2887     
2888     methods (Static)
2889         <a name="_sub103" href="#_subfunctions" class="code">function [subs2, I, J] = unique_subs(subs, siz)</a>
2890             <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(subs)
2891                 I = zeros(0, 1);
2892                 J = zeros(0, 1);
2893                 subs2 = subs;
2894                 <span class="keyword">return</span>;
2895             <span class="keyword">end</span>
2896             
2897             [inds, order] = sort( (subs-1)*[1 cumprod(siz(1:end-1))]' );
2898             subs2 = subs(order, :);
2899             subs2 = subs2([diff(inds) ~= 0; true], :);
2900             
2901             <span class="keyword">if</span> nargout &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= 2
2902                 I = order([diff(inds) ~= 0; true]);
2903             <span class="keyword">end</span>
2904             <span class="keyword">if</span> nargout &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>;= 3
2905                 [~, J] = edu.stanford.covert.util.SparseMat.ismember_subs(subs, subs2, siz);
2906             <span class="keyword">end</span>
2907         <span class="keyword">end</span>
2908         
2909         <a name="_sub104" href="#_subfunctions" class="code">function tf = isunique_subs(subs, siz)</a>
2910             <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction val = isempty(this)">isempty</a>(subs)
2911                 tf = true;
2912                 <span class="keyword">return</span>;
2913             <span class="keyword">end</span>
2914             tf = <a href="#_sub70" class="code" title="subfunction B = all(A, dim)">all</a>(diff(sort(  (subs-1)*[1 cumprod(siz(1:end-1))]'  )));
2915         <span class="keyword">end</span>
2916         
2917         <a name="_sub105" href="#_subfunctions" class="code">function [subs, order] = sort_subs(subs, siz, colSortOrder)</a>
2918             <span class="keyword">if</span> nargin &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; 3
2919                 colSortOrder = <a href="#_sub4" class="code" title="subfunction n = numel(this)">numel</a>(siz):-1:1;
2920             <span class="keyword">end</span>
2921             tmp = zeros(<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(siz));
2922             tmp(colSortOrder(end)) = 1;
2923             tmp(colSortOrder(end-1:-1:1)) = cumprod(siz(colSortOrder(end:-1:2)));
2924             
2925             <span class="comment">%optimized for memory</span>
2926             <span class="keyword">if</span> nargin == 3
2927                 [~, order] = sort((subs-1)*tmp');
2928                 subs = subs(order, :);
2929                 <span class="keyword">return</span>;
2930             <span class="keyword">end</span>
2931             
2932             <span class="comment">%optimized for run time</span>
2933             inds = (subs-1)*tmp';            
2934             <span class="keyword">if</span>  ~issorted(inds)
2935                 [~, order] = sort(inds);
2936                 subs = subs(order, :);
2937             <span class="keyword">elseif</span> nargout &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; 1
2938                 order = (1:<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs, 1))';
2939             <span class="keyword">end</span>
2940         <span class="keyword">end</span>
2941         
2942         <a name="_sub106" href="#_subfunctions" class="code">function [tfs, idxs] = ismember_subs(subs1, subs2, siz)</a>
2943             [tfs, idxs] = ismember(  (subs1-1)*[1 cumprod(siz(1:end-1))]',  (subs2-1)*[1 cumprod(siz(1:end-1))]'  );
2944         <span class="keyword">end</span>
2945         
2946         <a name="_sub107" href="#_subfunctions" class="code">function [C,IA,IB] = intersect_subs(subs1, subs2, siz)</a>
2947             [~,IA,IB] = intersect(  (subs1-1)*[1 cumprod(siz(1:end-1))]',  (subs2-1)*[1 cumprod(siz(1:end-1))]'  );
2948             C = subs1(IA, :);
2949         <span class="keyword">end</span>
2950         
2951         <a name="_sub108" href="#_subfunctions" class="code">function val = issorted_subs(subs, siz)</a>
2952             val = issorted((subs-1)*[1 cumprod(siz(1:end-1))]');
2953         <span class="keyword">end</span>
2954     <span class="keyword">end</span>
2955     
2956     <span class="comment">%mapped to disk</span>
2957     methods (Static)
2958         <a name="_sub109" href="#_subfunctions" class="code">function toDisk(spmat, fileName)</a>
2959             import edu.stanford.covert.util.SparseMat;
2960             
2961             fid = fopen(fileName, <span class="string">'w+'</span>);
2962             [subs vals] = <a href="#_sub81" class="code" title="subfunction [subs, vals] = find(this)">find</a>(spmat);
2963             c = 0;
2964             c = c + 8*fwrite(fid,<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,1),<span class="string">'uint64'</span>); <span class="comment">% number of elements</span>
2965             c = c + 8*fwrite(fid,<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(subs,2),<span class="string">'uint64'</span>); <span class="comment">% number of dimensions</span>
2966             fwrite(fid,zeros(1,128-c));
2967             matrix = SparseMat.sort_subs([subs vals],[<a href="#_sub7" class="code" title="subfunction siz = size(this, k)">size</a>(spmat) NaN],[1 2 3]);
2968             <span class="comment">%             matrix = sortrows([subs vals],1);</span>
2969             fwrite(fid,matrix(:, 1),<span class="string">'uint32'</span>);
2970             fwrite(fid,matrix(:, 2),<span class="string">'uint8'</span>);
2971             fwrite(fid,matrix(:, 3),<span class="string">'uint32'</span>);
2972             fwrite(fid,matrix(:, 4),<span class="string">'single'</span>);
2973             fclose(fid);
2974         <span class="keyword">end</span>
2975         
2976         <a name="_sub110" href="#_subfunctions" class="code">function ret = fromDisk(fileName, dim1, dim2, dim3)</a>
2977             import edu.stanford.covert.util.SparseMat;
2978             fid = fopen(fileName, <span class="string">'r'</span>);
2979             out = fread(fid,2,<span class="string">'uint64'</span>);
2980             nElem = out(1);
2981             nDim = out(2);
2982             fclose(fid);
2983             m = memmapfile(fileName,<span class="string">'Offset'</span>,128*1,<span class="string">'Format'</span>, <span class="keyword">...</span>
2984                 {<span class="string">'uint32'</span>, [nElem 1], <span class="string">'c1'</span>
2985                 <span class="string">'uint8'</span>, [nElem 1], <span class="string">'c2'</span>
2986                 <span class="string">'uint32'</span>, [nElem 1], <span class="string">'c3'</span>
2987                 <span class="string">'single'</span>, [nElem 1], <span class="string">'c4'</span>
2988                 }<span class="keyword">...</span>
2989                 );
2990             dim1L = dim1(1);
2991             dim1U = dim1(2);
2992             dim2L = dim2(1);
2993             dim2U = dim2(2);
2994             dim3L = dim3(1);
2995             dim3U = dim3(2);
2996             
2997             subs = [];
2998             vals = [];
2999             <span class="comment">% TODO: handle trivial case of dim1L == dim1U (is this actually</span>
3000             <span class="comment">% trivial?)</span>
3001             L1 = SparseMat.binSearch(m, dim1L, 1, nElem, 1, true);
3002             U1 = SparseMat.binSearch(m, dim1U, 1, nElem, 1, false);
3003             
3004             absLowerInd_d1 = L1.indL1;
3005             absUpperInd_d1 = U1.indU1;
3006             
3007             dim1_lb = absLowerInd_d1;
3008             <span class="keyword">while</span> (dim1_lb &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= absUpperInd_d1)
3009                 tmp1 = SparseMat.binSearch(m, m.Data(1).c1(dim1_lb), dim1_lb, absUpperInd_d1, 1, false);
3010                 dim1_ub = tmp1.indU1;
3011                 
3012                 <span class="comment">% ==========</span>
3013                 <span class="comment">% Second Dimension (second column)</span>
3014                 <span class="comment">% TODO: handle trivial case of dim1_lb == dim1_ub</span>
3015                 L2 = SparseMat.binSearch(m, dim2L, dim1_lb, dim1_ub, 2, true);
3016                 U2 = SparseMat.binSearch(m, dim2U, dim1_lb, dim1_ub, 2, false);
3017                 
3018                 absLowerInd_d2 = L2.indL2;
3019                 absUpperInd_d2 = U2.indU2;
3020                 
3021                 dim2_lb = absLowerInd_d2;
3022                 <span class="keyword">while</span>(dim2_lb &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= absUpperInd_d2)
3023                     tmp2 = SparseMat.binSearch(m, m.Data(1).c2(dim2_lb), dim2_lb, absUpperInd_d2, 2, false);
3024                     dim2_ub = tmp2.indU2;
3025                     
3026                     <span class="comment">% =====</span>
3027                     <span class="comment">% Third Dimension (third column)</span>
3028                     <span class="comment">% TODO: handle trivial case of dim2_lb == dim2_ub</span>
3029                     L3 = SparseMat.binSearch(m, dim3L, dim2_lb, dim2_ub, 3, true);
3030                     U3 = SparseMat.binSearch(m, dim3U, dim2_lb, dim2_ub, 3, false);
3031                     
3032                     absLowerInd_d3 = L3.indL3;
3033                     absUpperInd_d3 = U3.indU3;
3034                     
3035                     dim3_lb = absLowerInd_d3;
3036                     <span class="keyword">while</span>(dim3_lb &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>;= absUpperInd_d3)
3037                         tmp3 = SparseMat.binSearch(m, m.Data(1).c3(dim3_lb), dim3_lb, absUpperInd_d3, 3, false);
3038                         dim3_ub = tmp3.indU3;
3039                         <span class="comment">%%% Do real stuff here!%%%</span>
3040                         <span class="keyword">if</span>(tmp3.found)
3041                             subs = [subs; <span class="keyword">...</span>
3042                                 <a href="#_sub102" class="code" title="subfunction val = double(this)">double</a>(m.Data(1).c1(dim3_lb)) - dim1L + 1, <span class="keyword">...</span>
3043                                 <a href="#_sub102" class="code" title="subfunction val = double(this)">double</a>(m.Data(1).c2(dim3_lb)) - dim2L + 1, <span class="keyword">...</span>
3044                                 <a href="#_sub102" class="code" title="subfunction val = double(this)">double</a>(m.Data(1).c3(dim3_lb)) - dim3L + 1]; <span class="comment">%#ok&lt;AGROW&gt;</span>
3045                             vals = [vals; <a href="#_sub102" class="code" title="subfunction val = double(this)">double</a>(m.Data(1).c4(dim3_lb))]; <span class="comment">%#ok&lt;AGROW&gt;</span>
3046                         <span class="keyword">end</span>
3047                         dim3_lb = dim3_ub + 1;
3048                     <span class="keyword">end</span>
3049                     
3050                     <span class="comment">% =====</span>
3051                     dim2_lb = dim2_ub + 1;
3052                 <span class="keyword">end</span>
3053                 
3054                 <span class="comment">% ==========</span>
3055                 dim1_lb = dim1_ub + 1;
3056             <span class="keyword">end</span>
3057 <span class="comment">%             ret = struct;</span>
3058 <span class="comment">%</span>
3059 <span class="comment">%             ret.subs = subs;</span>
3060 <span class="comment">%             ret.vals = vals;</span>
3061             ret = <a href="SparseMat.html" class="code" title="">SparseMat</a>(subs, vals, [dim1U - dim1L + 1 dim2U - dim2L + 1 dim3U - dim3L + 1]);
3062         <span class="keyword">end</span>
3063         
3064         <a name="_sub111" href="#_subfunctions" class="code">function ret = binSearch(m, value, low, high, col, lowerend)</a>
3065             plow = low;
3066             phigh = high;
3067             pguess = floor(<a href="#_sub76" class="code" title="subfunction C = mean(A, dim)">mean</a>([plow,phigh]));
3068             colVec = m.Data(1).(sprintf(<span class="string">'c%d'</span>,col));
3069             <span class="keyword">if</span>(lowerend)
3070                 prev = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(pguess-1,1);
3071                 <span class="keyword">while</span> phigh &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; plow &amp;&amp; (colVec(pguess) ~= value || colVec(prev) == value) 
3072                     <span class="keyword">if</span>(colVec(pguess) &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; value || colVec(prev) == value)
3073                         phigh = pguess - 1;
3074                     <span class="keyword">else</span>
3075                         plow = pguess + 1;
3076                     <span class="keyword">end</span>
3077                     pguess = floor(<a href="#_sub76" class="code" title="subfunction C = mean(A, dim)">mean</a>([plow,phigh]));
3078                     pguess = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(pguess, low);
3079                     pguess = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(pguess, high);
3080                     prev = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(pguess-1, 1);
3081                 <span class="keyword">end</span>
3082             <span class="keyword">else</span>
3083                 next = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(pguess+1,high);
3084                 <span class="keyword">while</span> phigh &<a href="#_sub66" class="code" title="subfunction C = gt(A,B)">gt</a>; plow &amp;&amp; (colVec(pguess) ~= value || colVec(next) == value)
3085                     <span class="keyword">if</span>(colVec(pguess) &<a href="#_sub68" class="code" title="subfunction C = lt(A,B)">lt</a>; value || colVec(next) == value)
3086                         plow = pguess + 1;
3087                     <span class="keyword">else</span>
3088                         phigh = pguess - 1;
3089                     <span class="keyword">end</span>
3090                     pguess = floor(<a href="#_sub76" class="code" title="subfunction C = mean(A, dim)">mean</a>([plow,phigh]));
3091                     pguess = <a href="#_sub73" class="code" title="subfunction C = max(A, B, dim)">max</a>(pguess, low);
3092                     pguess = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(pguess, high);
3093                     next = <a href="#_sub72" class="code" title="subfunction C = min(A, B, dim)">min</a>(pguess+1, high);
3094                 <span class="keyword">end</span>
3095             <span class="keyword">end</span>
3096            
3097             ret = struct;
3098             <span class="keyword">if</span> colVec(pguess) == value
3099 <span class="comment">%             if phigh &gt; plow</span>
3100                 ret.found = true;
3101             <span class="keyword">else</span>
3102                 ret.found = false;
3103             <span class="keyword">end</span>
3104             <span class="keyword">if</span>(lowerend)
3105                 c = <span class="string">'L'</span>;
3106             <span class="keyword">else</span>
3107                 c = <span class="string">'U'</span>;
3108             <span class="keyword">end</span>
3109             ret.(sprintf(<span class="string">'ind%c%d'</span>,c,col)) = pguess;
3110         <span class="keyword">end</span>
3111     <span class="keyword">end</span>
3112     
3113     <span class="comment">%display</span>
3114     methods
3115         <a name="_sub112" href="#_subfunctions" class="code">function disp(this)</a>
3116             this.display();
3117         <span class="keyword">end</span>
3118         
3119         <a name="_sub113" href="#_subfunctions" class="code">function display(this)</a>
3120             fprintf(<span class="string">'%d'</span>,this.siz(1));
3121             fprintf(<span class="string">'x%d'</span>,this.siz(2:end));
3122             fprintf(<span class="string">' %s of type %s with %d non-zeros\n'</span>, class(this), <a href="#_sub86" class="code" title="subfunction type = valueClass(this)">valueClass</a>(this), this.nnz);
3123             <span class="keyword">for</span> i=1:this.nnz
3124                 fprintf(<span class="string">'(%d'</span>,this.subs(i,1));
3125                 fprintf(<span class="string">',%d'</span>,this.subs(i,2:end));
3126                 fprintf(<span class="string">')\t\t%.4f\n'</span>,this.vals(i));
3127             <span class="keyword">end</span>
3128         <span class="keyword">end</span>
3129     <span class="keyword">end</span>
3130 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 19-Jul-2012 18:32:13 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>